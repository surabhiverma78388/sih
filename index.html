<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ASHA-PHC Health Portal</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
      /* Base Reset */

/* Hero background pattern enhancement */
svg path {
  stroke: #94a3b8;
}

/* Footer */
footer {
  background: #0f172a;
  color: #e5e7eb;
  font-size: 0.95rem;
  line-height: 1.6;
}
footer p {
  color: #9ca3af;
}
footer h3 {
  color: #f9fafb;
}
footer .border-t {
  border-color: #1e293b;
}

/* Small UI polish: consistent cards and buttons */
:root {
    --card-bg: rgba(255,255,255,0.95);
    --muted: #6b7280;
    --accent: #0f766e;
}

/* Primary color tokens for buttons */
:root {
    --primary: #0f766e;
    --primary-dark: #065f46;
}

.primary-btn {
    background: linear-gradient(180deg, var(--primary) 0%, var(--primary-dark) 100%);
    color: white;
    padding: .6rem .9rem;
    border-radius: 10px;
    box-shadow: 0 8px 20px rgba(15,118,110,0.12);
    border: none;
}
.primary-btn:hover { transform: translateY(-2px); }

/* softer, consistent card look */
.group, .bg-white, .bg-white\/60, .rounded-xl {
    background: var(--card-bg) !important;
    box-shadow: 0 8px 20px rgba(15, 23, 42, 0.06);
    border-radius: 12px !important;
}

/* buttons */
button, .btn {
    border-radius: 10px !important;
    transition: transform 0.12s ease, box-shadow 0.12s ease;
}
button:active { transform: translateY(1px); }

/* Subtle header blur for a more professional feel */
header { backdrop-filter: blur(6px); }

/* PHC connectivity toggle */
.connectivity-toggle {
    display: inline-flex;
    align-items: center;
    gap: .5rem;
    padding: .35rem .6rem;
    background: rgba(255,255,255,0.12);
    color: white;
    border-radius: 9999px;
    font-size: .9rem;
}
.connectivity-dot { width: 10px; height: 10px; border-radius: 9999px; display:inline-block; }
.connectivity-online { background: #34d399; }
.connectivity-offline { background: #f87171; }

/* Animations */
@keyframes pulseGlow {
  0% { box-shadow: 0 0 0 0 rgba(34, 197, 94, 0.5); }
  70% { box-shadow: 0 0 0 10px rgba(34, 197, 94, 0); }
  100% { box-shadow: 0 0 0 0 rgba(34, 197, 94, 0); }
}
.pulse-dot {
  animation: pulseGlow 2s infinite;
}

/* Mobile responsiveness */
@media (max-width: 768px) {
  h1 {
    font-size: 2rem !important;
  }
  .group {
    padding: 1.5rem !important;
  }
  .grid {
    gap: 1.25rem !important;
  }
  .text-xl {
    font-size: 1.1rem !important;
  }
}

/* Additional responsive improvements for PHC dashboard */
@media (max-width: 900px) {
    .grid-cols-4, .lg\:grid-cols-4 { grid-template-columns: repeat(2, minmax(0, 1fr)) !important; }
    .grid-cols-3, .lg\:grid-cols-3 { grid-template-columns: repeat(2, minmax(0, 1fr)) !important; }
    .max-w-6xl { padding-left: 1rem; padding-right: 1rem; }
    header .text-right { display: none; }
    .nav-item span { display: none; }
}

@media (max-width: 480px) {
    .grid-cols-2, .lg\:grid-cols-2 { grid-template-columns: 1fr !important; }
    .text-4xl { font-size: 1.6rem !important; }
    .primary-btn { padding: .5rem .75rem; }
    .notification { right: 8px; left: 8px; top: 60px; }
    .connectivity-toggle { padding: .25rem .4rem; font-size: .8rem; }
}

/* Optional subtle shadow for illustration */
.w-64.h-48 {
  box-shadow: 0 10px 30px rgba(0, 0, 0, 0.05);
  transition: transform 0.3s ease;
}
.w-64.h-48:hover {
  transform: scale(1.02);
}

/* Notification Toasts */
.notification {
  position: fixed;
  top: 80px;
  right: 20px;
  background: #16a34a;
  color: white;
  padding: 14px 22px;
  border-radius: 10px;
  font-weight: 500;
  box-shadow: 0 8px 20px rgba(0, 0, 0, 0.2);
  transform: translateX(120%);
  transition: transform 0.4s ease;
}
.notification.show {
  transform: translateX(0);
}
.notification.error {
  background: #ef4444;
}
.notification.warning {
  background: #f59e0b;
}

/* Extra smooth hover for icons */
.w-16.h-16 {
  transition: transform 0.3s ease, background 0.3s ease;
}
.w-16.h-16:hover {
  transform: scale(1.1);
}

/* Modal backdrop and card (appear from top, card rises) */
.modal-backdrop {
    position: fixed;
    inset: 0;
    background: rgba(15, 23, 42, 0.45);
    display: flex;
    align-items: flex-start; /* align items from top */
    justify-content: center;
    padding-top: 3.5rem; /* space from top */
    z-index: 60;
    overflow-y: auto;
}
.modal-card {
    background: white;
    border-radius: 12px;
    box-shadow: 0 20px 50px rgba(2,6,23,0.3);
    max-width: 90%;
    width: 900px;
    transform: translateY(-30px) scale(0.98);
    opacity: 0;
    transition: transform 300ms ease, opacity 300ms ease;
}
.modal-backdrop.show .modal-card {
    transform: translateY(0) scale(1);
    opacity: 1;
}

/* smaller on mobile */
@media (max-width: 640px) {
    .modal-card { width: calc(100% - 2rem); margin: 0 1rem; }
    .modal-backdrop { padding-top: 1.5rem; }
}

/* support existing modal API (toggle .active on element id) */
.modal-backdrop { display: none; }
.modal-backdrop.active { display: flex; }

/* Extra mobile improvements for PHC pages */
@media (max-width: 640px) {
    /* Allow header content to wrap and make right-side controls stack */
    #phc-dashboard header .flex.items-center.justify-between,
    #phc-dashboard header > div {
        flex-wrap: wrap;
        gap: .5rem;
    }

    #phc-dashboard header .flex.items-center > div:last-child {
        min-width: 0;
    }

    /* Reduce header paddings on small screens */
    #phc-dashboard header { padding: .6rem; }

    /* Hide less-important header text to save horizontal space */
    #phc-dashboard #phcSyncStatus span:last-child,
    #phc-dashboard header p.text-xs { display: none; }

    /* Make metric grids single-column on small phones */
    #phc-dashboard .grid.grid-cols-2,
    #phc-villages .grid.grid-cols-2,
    #phc-sync .grid.grid-cols-1,
    #phc-dashboard .grid.grid-cols-2.lg\:grid-cols-4 {
        grid-template-columns: 1fr !important;
    }

    /* Ensure cards have comfortable padding and full width */
    #phc-dashboard .bg-white.rounded-xl,
    #phc-villages .village-card,
    #phc-dashboard .bg-gradient-to-r,
    #phc-dashboard .bg-white.rounded-xl.p-4 { width: 100% !important; }

    /* Make village-card header content wrap on very small screens to avoid overlap */
    #phc-villages .village-card .flex.items-center.justify-between,
    #phc-villages .village-card .flex.items-center.space-x-3 {
        flex-wrap: wrap;
        gap: .5rem;
    }

    #phc-villages .village-card .flex.items-center.space-x-2 {
        min-width: 0;
    }

    /* Prevent bottom nav from overlapping content */
    body { padding-bottom: 88px; }

    /* Make floating action buttons slightly smaller and farther from edges */
    #villageActionsPanel, #alertActionsPanel { right: 8px; bottom: 90px; }

    /* Improve tappable areas */
    button, .primary-btn { min-height: 44px; }
}

/* Small tweak for very narrow phones */
@media (max-width: 420px) {
    .text-4xl { font-size: 1.4rem !important; }
    .w-64.h-48 { width: 12rem; height: 8rem; }
}

/* Improve contrast for dashboard/village labels so they are readable on small screens */
#phc-dashboard .bg-white.rounded-xl p.text-sm,
#phc-dashboard .bg-white.rounded-xl p.text-xs,
#phc-villages .village-card h3,
#phc-villages .village-card p.text-sm,
#phc-villages .village-card p.text-xs,
#phc-villages .village-card .text-center p {
    color: #111827 !important; /* Tailwind slate-900 / very dark gray */
    font-weight: 600;
}

/* Slightly increase contrast for metric numbers on very small screens */
@media (max-width: 420px) {
    #phc-dashboard .bg-white.rounded-xl p.text-2xl,
    #phc-villages .village-card p.text-lg,
    #phc-villages .village-card p.text-2xl {
        color: #0f172a !important;
    }
}

/* Darken metric gradient cards only on the PHC Villages overview so text stays readable */
#phc-villages .bg-gradient-to-r.text-white {
    filter: brightness(0.78) contrast(0.98);
    box-shadow: 0 8px 26px rgba(2,6,23,0.22);
}

@media (max-width: 420px) {
    #phc-villages .bg-gradient-to-r.text-white {
        filter: brightness(0.72) contrast(0.98);
    }
}

/* PHC villages - darken only the small label text under key metrics (keep card backgrounds intact) */
/* make labels dark so they are readable on the tiles */
#activeVillagesCount + p,
#onlineAshaCount + p,
#todayVisitsCount + p {
    color: #0f172a !important; /* dark slate */
    font-weight: 600 !important;
}

/* Force all text inside those gradient metric cards to dark for better legibility */
#phc-villages .bg-gradient-to-r.text-white,
#phc-villages .bg-gradient-to-r.text-white * {
    color: #0f172a !important;
}

        </style>
</head>
<body class="bg-gray-50">
    <!-- Main Content -->
    <main class="min-h-screen">
        <!-- Homepage -->
        <div id="homepage" class="page-content">
            <!-- Hero Section -->
            <div class="relative min-h-screen bg-gradient-to-br from-slate-50 to-blue-50">
                <!-- Background Pattern -->
                <div class="absolute inset-0 opacity-5">
                    <svg class="w-full h-full" viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg">
                        <defs>
                            <pattern id="grid" width="10" height="10" patternUnits="userSpaceOnUse">
                                <path d="M 10 0 L 0 0 0 10" fill="none" stroke="currentColor" stroke-width="0.5"/>
                            </pattern>
                        </defs>
                        <rect width="100" height="100" fill="url(#grid)" />
                    </svg>
                </div>

                <!-- Header -->
                <header class="relative z-10 bg-white/80 backdrop-blur-sm border-b border-gray-200">
                    <div class="max-w-6xl mx-auto px-4 py-4">
                        <div class="flex items-center justify-between">
                            <div class="flex items-center space-x-3">
                                <div class="w-10 h-10 bg-blue-600 rounded-lg flex items-center justify-center shadow-sm">
                                    <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"/>
                                    </svg>
                                </div>
                                <div>
                                    <h1 class="text-xl font-bold text-gray-900">Health Portal</h1>
                                    <p class="text-sm text-gray-600">National Health Mission</p>
                                </div>
                            </div>
                            <div class="text-right">
                                <p class="text-sm text-gray-600">Serving India's Communities</p>
                                <p class="text-xs text-gray-500">‡§≠‡§æ‡§∞‡§§ ‡§ï‡•Ä ‡§∏‡•á‡§µ‡§æ ‡§Æ‡•á‡§Ç</p>
                            </div>
                        </div>
                    </div>
                </header>

                <!-- Hero Content -->
                        <div class="relative z-10 max-w-6xl mx-auto px-4 py-12">
                    <!-- Main Title -->
                    <div class="text-center mb-16">
                        <h1 class="text-4xl md:text-5xl font-extrabold text-gray-900 mb-3">
                            Welcome to the
                            <span class="text-blue-600">ASHA‚ÄìPHC Health Portal</span>
                        </h1>
                        <p class="text-xl text-gray-600 max-w-2xl mx-auto">
                            Empowering India's frontline healthcare heroes
                        </p>
                    </div>

                    <!-- Healthcare Worker Illustration -->
                    <div class="flex justify-center mb-16">
                        <div class="relative">
                            <!-- Simple Healthcare Illustration -->
                            <div class="w-64 h-48 bg-gradient-to-br from-blue-100 to-green-100 rounded-2xl flex items-center justify-center relative overflow-hidden">
                                <!-- Background Elements -->
                                <div class="absolute top-4 left-4 w-8 h-8 bg-white/50 rounded-full"></div>
                                <div class="absolute bottom-4 right-4 w-6 h-6 bg-white/30 rounded-full"></div>
                                <div class="absolute top-8 right-8 w-4 h-4 bg-blue-200/50 rounded-full"></div>
                                
                                <!-- Healthcare Icons -->
                                <div class="flex items-center space-x-8">
                                    <div class="text-center">
                                        <div class="w-16 h-16 bg-white rounded-full flex items-center justify-center mb-2 shadow-sm">
                                            <span class="text-2xl">üë©‚Äç‚öïÔ∏è</span>
                                        </div>
                                        <p class="text-xs text-gray-600">ASHA</p>
                                    </div>
                                    <div class="text-center">
                                        <div class="w-16 h-16 bg-white rounded-full flex items-center justify-center mb-2 shadow-sm">
                                            <span class="text-2xl">üè•</span>
                                        </div>
                                        <p class="text-xs text-gray-600">PHC</p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Worker Type Selection -->
                    <div class="max-w-2xl mx-auto mb-16">
                        <div class="grid md:grid-cols-2 gap-6">
                            <!-- PHC Worker Card -->
                            <div onclick="showPHCWorker()" class="group bg-white rounded-2xl p-6 shadow-sm border border-gray-200 hover:shadow-md hover:border-blue-200 transition-all duration-300 cursor-pointer">
                                <div class="text-center">
                                    <div class="w-16 h-16 bg-blue-50 rounded-2xl flex items-center justify-center mx-auto mb-4 group-hover:bg-blue-100 transition-colors">
                                        <svg class="w-8 h-8 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"/>
                                        </svg>
                                    </div>
                                    <h3 class="text-xl font-semibold text-gray-900 mb-2">üè• PHC Worker</h3>
                                    <p class="text-gray-600 text-sm mb-4">Access PHC Dashboard</p>
                                    <p class="text-xs text-gray-500">Manage facility operations and patient records</p>
                                </div>
                            </div>

                            <!-- ASHA Worker Card -->
                            <div onclick="window.location.href='index2.html'" class="group bg-white rounded-2xl p-6 shadow-sm border border-gray-200 hover:shadow-md hover:border-green-200 transition-all duration-300 cursor-pointer">
                                <div class="text-center">
                                    <div class="w-16 h-16 bg-green-50 rounded-2xl flex items-center justify-center mx-auto mb-4 group-hover:bg-green-100 transition-colors">
                                        <svg class="w-8 h-8 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z"/>
                                        </svg>
                                    </div>
                                    <h3 class="text-xl font-semibold text-gray-900 mb-2">üë©‚Äç‚öïÔ∏è ASHA Worker</h3>
                                    <p class="text-gray-600 text-sm mb-4">Track Community Visits</p>
                                    <p class="text-xs text-gray-500">Monitor maternal & child health in villages</p>
                                </div>
                            </div>
                        </div>
                    </div>
                    <!-- Education Button -->

                <div class="text-center mt-8 mb-12">
                    <button onclick="window.location.href='index5.html'" class="px-6 py-3 bg-blue-600 text-white font-semibold rounded-lg shadow-md hover:bg-teal-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2">
                        Education
                    </button>
                </div>

                    <!-- About Section -->
                    <div class="max-w-4xl mx-auto mb-16">
                       <div class="bg-white/60 backdrop-blur-sm rounded-2xl p-8 border border-gray-200">
                            <h2 class="text-2xl font-semibold text-gray-900 text-center mb-6">About This Portal</h2>
                            <p class="text-gray-700 text-center text-lg leading-relaxed mb-8">
                                This platform connects ASHA and PHC workers to streamline healthcare activities, record patient data, track maternal and child health progress, and ensure efficient communication between community health workers and primary health centers.
                            </p>
                            
                            <!-- Feature Highlights -->
                            <div class="grid md:grid-cols-3 gap-6">
                                <div class="text-center">
                                    <div class="w-12 h-12 bg-blue-50 rounded-xl flex items-center justify-center mx-auto mb-3">
                                        <svg class="w-6 h-6 text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v6a2 2 0 002 2h6a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"/>
                                        </svg>
                                    </div>
                                    <h3 class="font-semibold text-gray-900 mb-2">üìã Daily Task Tracking</h3>
                                    <p class="text-sm text-gray-600">Organize and monitor daily healthcare activities</p>
                                </div>
                                
                                <div class="text-center">
                                    <div class="w-12 h-12 bg-green-50 rounded-xl flex items-center justify-center mx-auto mb-3">
                                        <svg class="w-6 h-6 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 12h.01M12 12h.01M16 12h.01M21 12c0 4.418-4.03 8-9 8a9.863 9.863 0 01-4.255-.949L3 20l1.395-3.72C3.512 15.042 3 13.574 3 12c0-4.418 4.03-8 9-8s9 3.582 9 8z"/>
                                        </svg>
                                    </div>
                                    <h3 class="font-semibold text-gray-900 mb-2">üí¨ Community Reports</h3>
                                    <p class="text-sm text-gray-600">Generate and share health status reports</p>
                                </div>
                                
                                <div class="text-center">
                                    <div class="w-12 h-12 bg-purple-50 rounded-xl flex items-center justify-center mx-auto mb-3">
                                        <svg class="w-6 h-6 text-purple-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"/>
                                        </svg>
                                    </div>
                                    <h3 class="font-semibold text-gray-900 mb-2">üìà Health Progress Insights</h3>
                                    <p class="text-sm text-gray-600">Track immunization and maternal health metrics</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <!-- Footer -->
                <footer class="relative z-10 bg-gray-900 text-white">
                    <div class="max-w-6xl mx-auto px-4 py-8">
                        <div class="text-center">
                            <div class="flex items-center justify-center space-x-3 mb-4">
                                <div class="w-8 h-8 bg-blue-600 rounded-lg flex items-center justify-center">
                                    <svg class="w-5 h-5 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"/>
                                    </svg>
                                </div>
                                <h3 class="text-lg font-semibold">ASHA-PHC Health Portal</h3>
                            </div>
                            <p class="text-gray-400 mb-2">Developed under National Health Mission</p>
                            <p class="text-gray-500 text-sm">Ministry of Health & Family Welfare, Government of India</p>
                            <div class="mt-6 pt-6 border-t border-gray-800">
                                <p class="text-gray-500 text-sm">¬© 2025  National Health Mission. Empowering healthcare workers across India.</p>
                            </div>
                        </div>
                    </div>
                </footer>
            </div>
        </div>

        <!-- PHC Dashboard -->
        <div id="phc-dashboard" class="page-content hidden pb-20">
            <!-- Header -->
            <header class="bg-gradient-to-r from-blue-600 to-blue-700 text-white p-4 sticky top-0 z-40">
                <div class="flex items-center justify-between">
                    <div class="flex items-center">
                        <button onclick="showHomepage()" class="mr-3 p-2 hover:bg-white/20 rounded-lg">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"/>
                            </svg>
                        </button>
                        <div class="w-10 h-10 bg-white/20 rounded-lg flex items-center justify-center mr-3">
                            <span class="text-xl font-bold">P</span>
                        </div>
                        <div>
                            <h1 class="text-lg font-bold">PHC Management Portal</h1>
                            <p class="text-xs text-blue-100">Dr. Rajesh Kumar - PHC Officer</p>
                        </div>
                    </div>
                    <div class="flex items-center space-x-3">
                        <!-- Sync Status -->
                                <div id="phcSyncStatus" class="flex items-center space-x-2 bg-white/20 px-3 py-1 rounded-full text-sm">
                                    <span class="w-2 h-2 bg-green-400 rounded-full pulse-dot"></span>
                                    <span>Synced</span>
                                </div>
                                <!-- PHC connectivity toggle -->
                                <button id="phcConnectivityToggle" class="connectivity-toggle ml-2" title="Toggle PHC connectivity">
                                    <span id="phcConnectivityDot" class="connectivity-dot connectivity-online"></span>
                                    <span id="phcConnectivityText">Online</span>
                                </button>
                        <button onclick="showPHCNotifications()" class="p-2 bg-white/20 rounded-lg relative">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 17h5l-5 5v-5z"/>
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 7H4l5-5v5z"/>
                            </svg>
                            <span class="absolute -top-1 -right-1 w-4 h-4 bg-red-500 text-white text-xs rounded-full flex items-center justify-center">8</span>
                        </button>
                    </div>
                </div>
            </header>

            <!-- Dashboard Overview -->
            <div class="p-4">
                <!-- Key Metrics -->
                <div class="grid grid-cols-2 lg:grid-cols-4 gap-4 mb-6">
                    <div class="bg-white rounded-xl p-4 shadow-sm">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-2xl font-bold text-blue-600">12</p>
                                <p class="text-sm text-gray-600">Villages</p>
                            </div>
                            <div class="w-10 h-10 bg-blue-100 rounded-lg flex items-center justify-center">
                                <span class="text-blue-600">üèòÔ∏è</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="bg-white rounded-xl p-4 shadow-sm">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-2xl font-bold text-green-600">18</p>
                                <p class="text-sm text-gray-600">ASHA Workers</p>
                            </div>
                            <div class="w-10 h-10 bg-green-100 rounded-lg flex items-center justify-center">
                                <span class="text-green-600">üë©‚Äç‚öïÔ∏è</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="bg-white rounded-xl p-4 shadow-sm">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-2xl font-bold text-orange-600">247</p>
                                <p class="text-sm text-gray-600">Active Cases</p>
                            </div>
                            <div class="w-10 h-10 bg-orange-100 rounded-lg flex items-center justify-center">
                                <span class="text-orange-600">üìã</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="bg-white rounded-xl p-4 shadow-sm">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-2xl font-bold text-red-600">23</p>
                                <p class="text-sm text-gray-600">High Priority</p>
                            </div>
                            <div class="w-10 h-10 bg-red-100 rounded-lg flex items-center justify-center">
                                <span class="text-red-600">üö®</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Task Review Module -->
                <div class="bg-white rounded-xl p-4 shadow-sm mb-6">
                    <div class="flex items-center justify-between mb-4">
                        <h3 class="text-lg font-semibold">Task Review</h3>
                        <button onclick="showTaskReview()" class="primary-btn text-sm">
                            Review Tasks
                        </button>
                    </div>
                    <div class="grid grid-cols-2 lg:grid-cols-4 gap-4">
                        <div class="text-center p-3 bg-red-50 rounded-lg" onclick="openHighPriorityTasks()" style="cursor:pointer">
                            <p class="text-xl font-bold text-red-600">8</p>
                            <p class="text-xs text-red-600">High Priority</p>
                        </div>
                        <div class="text-center p-3 bg-yellow-50 rounded-lg">
                            <p class="text-xl font-bold text-yellow-600">15</p>
                            <p class="text-xs text-yellow-600">Medium Priority</p>
                        </div>
                        <div class="text-center p-3 bg-green-50 rounded-lg">
                            <p class="text-xl font-bold text-green-600">32</p>
                            <p class="text-xs text-green-600">Low Priority</p>
                        </div>
                        <div class="text-center p-3 bg-gray-50 rounded-lg">
                            <p class="text-xl font-bold text-gray-600">192</p>
                            <p class="text-xs text-gray-600">Completed</p>
                        </div>
                    </div>
                </div>

                <!-- Village Reports & Performance -->
                <div class="bg-white rounded-xl p-4 shadow-sm mb-6">
                    <h3 class="text-lg font-semibold mb-4">Village Performance Overview</h3>
                    <div class="grid grid-cols-1 lg:grid-cols-3 gap-4">
                        <div class="bg-gradient-to-r from-green-500 to-green-600 text-white p-4 rounded-lg">
                            <h4 class="font-semibold mb-2">Immunization Coverage</h4>
                            <p class="text-2xl font-bold">87%</p>
                            <p class="text-sm text-green-100">Target: 90%</p>
                        </div>
                        <div class="bg-gradient-to-r from-blue-500 to-blue-600 text-white p-4 rounded-lg">
                            <h4 class="font-semibold mb-2">ANC Coverage</h4>
                            <p class="text-2xl font-bold">92%</p>
                            <p class="text-sm text-blue-100">Target: 95%</p>
                        </div>
                        <div class="bg-gradient-to-r from-purple-500 to-purple-600 text-white p-4 rounded-lg">
                            <h4 class="font-semibold mb-2">High-Risk Cases</h4>
                            <p class="text-2xl font-bold">23</p>
                            <p class="text-sm text-purple-100">Needs attention</p>
                        </div>
                    </div>
                </div>

                <!-- Error Logs -->
                <div class="bg-white rounded-xl p-4 shadow-sm mb-6">
                    <div class="flex items-center justify-between mb-4">
                        <h3 class="text-lg font-semibold">System Status</h3>
                        <button onclick="showErrorLogs()" class="px-4 py-2 bg-gray-600 text-white rounded-lg text-sm hover:bg-gray-700">
                            View Logs
                        </button>
                    </div>
                    <div class="grid grid-cols-1 lg:grid-cols-3 gap-4">
                        <div class="flex items-center justify-between p-3 bg-red-50 rounded-lg">
                            <div>
                                <p class="font-semibold text-red-800">Sync Errors</p>
                                <p class="text-sm text-red-600">3 pending</p>
                            </div>
                            <span class="text-red-600">‚ö†Ô∏è</span>
                        </div>
                        <div class="flex items-center justify-between p-3 bg-yellow-50 rounded-lg">
                            <div>
                                <p class="font-semibold text-yellow-800">Validation Errors</p>
                                <p class="text-sm text-yellow-600">7 forms</p>
                            </div>
                            <span class="text-yellow-600">‚ö†Ô∏è</span>
                        </div>
                        <div class="flex items-center justify-between p-3 bg-green-50 rounded-lg">
                            <div>
                                <p class="font-semibold text-green-800">All Systems</p>
                                <p class="text-sm text-green-600">Operational</p>
                            </div>
                            <span class="text-green-600">‚úÖ</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Dashboard -->
        <div id="dashboard" class="page-content hidden pb-20">
         
            <header class="bg-gradient-to-r from-teal-600 to-teal-700 text-white p-4 sticky top-0 z-40">
                <div class="flex items-center justify-between">
                    <div class="flex items-center">
                        <button onclick="showHomepage()" class="mr-3 p-2 hover:bg-white/20 rounded-lg">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"/>
                            </svg>
                        </button>
                        <div class="w-10 h-10 bg-white/20 rounded-lg flex items-center justify-center mr-3">
                            <span class="text-xl font-bold">A</span>
                        </div>
                        <div>
                            <h1 class="text-lg font-bold">ASHA Mobile EHR</h1>
                            <p class="text-xs text-teal-100">Sunita Devi - ASHA Worker</p>
                        </div>
                    </div>
                    <div class="flex items-center space-x-3">
                        <!-- Language Selector -->
                        <select id="languageSelector" class="bg-white/20 text-white text-sm px-2 py-1 rounded border-none outline-none">
                            <option value="en" class="text-gray-800">English</option>
                            <option value="hi" class="text-gray-800">‡§π‡§ø‡§Ç‡§¶‡•Ä</option>
                            <option value="kn" class="text-gray-800">‡≤ï‡≤®‡≥ç‡≤®‡≤°</option>
                            <option value="te" class="text-gray-800">‡∞§‡±Ü‡∞≤‡±Å‡∞ó‡±Å</option>
                        </select>
                        <!-- Offline/Online Toggle -->
                        <button id="connectivityToggle" class="flex items-center space-x-2 bg-white/20 px-3 py-1 rounded-full text-sm">
                            <span id="connectivityDot" class="w-2 h-2 bg-green-400 rounded-full pulse-dot"></span>
                            <span id="connectivityText">Online</span>
                        </button>
                        <button onclick="showNotifications()" class="p-2 bg-white/20 rounded-lg relative">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 17h5l-5 5v-5z"/>
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 7H4l5-5v5z"/>
                            </svg>
                            <span id="notificationBadge" class="absolute -top-1 -right-1 w-4 h-4 bg-red-500 text-white text-xs rounded-full flex items-center justify-center">3</span>
                        </button>
                    </div>
                </div>
            </header>

            <!-- Welcome Banner -->
            <div class="bg-gradient-to-r from-blue-500 to-purple-600 text-white p-6 m-4 rounded-xl">
                <h2 class="text-xl font-bold mb-2">Good Morning, Sunita!</h2>
                <p class="text-blue-100">Today is a great day to serve your community</p>
                <div class="mt-4 flex items-center space-x-4 text-sm">
                    <div class="flex items-center">
                        <span class="w-2 h-2 bg-green-400 rounded-full mr-2"></span>
                        <span>Village: Rampur</span>
                    </div>
                    <div class="flex items-center">
                        <span class="w-2 h-2 bg-yellow-400 rounded-full mr-2"></span>
                        <span>Weather: 28¬∞C</span>
                    </div>
                </div>
            </div>

            <!-- Quick Stats -->
            <div class="grid grid-cols-1 sm:grid-cols-2 gap-3 sm:gap-4 p-4">
                <div onclick="showTodaysVisits()" class="bg-white rounded-xl p-4 shadow-sm cursor-pointer hover:shadow-md transition-shadow">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-xl sm:text-2xl font-bold text-teal-600" id="todayVisitsCount">2/8</p>
                            <p class="text-xs sm:text-sm text-gray-600">Today's Visits</p>
                        </div>
                        <div class="w-8 h-8 sm:w-10 sm:h-10 bg-teal-100 rounded-lg flex items-center justify-center">
                            <span class="text-teal-600 text-sm sm:text-base">üë•</span>
                        </div>
                    </div>
                </div>
                <div onclick="showPendingTasks()" class="bg-white rounded-xl p-4 shadow-sm cursor-pointer hover:shadow-md transition-shadow">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-xl sm:text-2xl font-bold text-orange-600" id="pendingTasksCount">6</p>
                            <p class="text-xs sm:text-sm text-gray-600">Pending Tasks</p>
                        </div>
                        <div class="w-8 h-8 sm:w-10 sm:h-10 bg-orange-100 rounded-lg flex items-center justify-center">
                            <span class="text-orange-600 text-sm sm:text-base">üìã</span>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Quick Actions -->
            <div class="p-4">
                <h3 class="text-base sm:text-lg font-semibold mb-3">Quick Actions</h3>
                <div class="grid grid-cols-1 sm:grid-cols-2 gap-3">
                    <button onclick="showPage('patient-registration')" class="bg-white rounded-xl p-3 sm:p-4 shadow-sm text-left hover:shadow-md transition-shadow">
                        <div class="w-10 h-10 sm:w-12 sm:h-12 bg-blue-100 rounded-lg flex items-center justify-center mb-2 sm:mb-3">
                            <span class="text-blue-600 text-lg sm:text-xl">üë§</span>
                        </div>
                        <p class="font-semibold text-gray-900 text-sm sm:text-base">Register Patient</p>
                        <p class="text-xs text-gray-600">Add new patient</p>
                    </button>
                    <button onclick="showOCRScanner()" class="bg-white rounded-xl p-3 sm:p-4 shadow-sm text-left hover:shadow-md transition-shadow">
                        <div class="w-10 h-10 sm:w-12 sm:h-12 bg-green-100 rounded-lg flex items-center justify-center mb-2 sm:mb-3">
                            <span class="text-green-600 text-lg sm:text-xl">üìÑ</span>
                        </div>
                        <p class="font-semibold text-gray-900 text-sm sm:text-base">Scan Form</p>
                        <p class="text-xs text-gray-600">OCR capture</p>
                    </button>
                </div>
            </div>

            <!-- Priority Tasks -->
            <div class="p-4">
                <h3 class="text-base sm:text-lg font-semibold mb-3">Priority Tasks</h3>
                <div id="priorityTasksList" class="space-y-2 sm:space-y-3">
                    <!-- Tasks will be populated by JavaScript -->
                </div>
            </div>
        </div>

        <!-- Today's Work Plan -->
        <div id="todays-work-plan" class="page-content hidden pb-20">
            <div class="p-4">
                <div class="flex items-center mb-6">
                    <button onclick="showPage('dashboard')" class="mr-3 p-2 hover:bg-gray-100 rounded-lg">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"/>
                        </svg>
                    </button>
                    <h2 class="text-xl font-bold">Today's Work Plan</h2>
                </div>

                <!-- Progress Overview -->
                <div class="bg-gradient-to-r from-green-500 to-blue-600 text-white p-6 rounded-xl mb-6">
                    <h3 class="text-lg font-bold mb-2">Daily Progress</h3>
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="text-3xl font-bold">2/8</p>
                            <p class="text-green-100">Visits Completed</p>
                        </div>
                        <div class="text-right">
                            <p class="text-xl font-semibold">25%</p>
                            <p class="text-green-100">Progress</p>
                        </div>
                    </div>
                    <div class="w-full bg-white/20 rounded-full h-2 mt-4">
                        <div class="bg-white h-2 rounded-full" style="width: 25%"></div>
                    </div>
                </div>

                <!-- Village-wise Work Plan -->
                <div class="space-y-4">
                    <!-- Rampur Village - Completed -->
                    <div class="bg-white rounded-xl p-4 shadow-sm border-l-4 border-green-500">
                        <div class="flex items-center justify-between mb-3">
                            <h3 class="font-semibold text-gray-900">Village: Rampur</h3>
                            <span class="px-3 py-1 bg-green-100 text-green-800 rounded-full text-sm">‚úÖ Completed</span>
                        </div>
                        <div class="space-y-2">
                            <div class="flex items-center justify-between py-2 border-b border-gray-100">
                                <div>
                                    <p class="font-medium text-gray-900">Baby Raj Kumar - DPT-3 Vaccination</p>
                                    <p class="text-sm text-gray-600">9:00 AM ‚Ä¢ Mother: Sunita Devi</p>
                                </div>
                                <span class="text-green-600 text-sm">‚úÖ Done</span>
                            </div>
                            <div class="flex items-center justify-between py-2">
                                <div>
                                    <p class="font-medium text-gray-900">Priya Sharma - ANC-2 Visit</p>
                                    <p class="text-sm text-gray-600">10:30 AM ‚Ä¢ 20 weeks pregnant</p>
                                </div>
                                <span class="text-green-600 text-sm">‚úÖ Done</span>
                            </div>
                        </div>
                    </div>

                    <!-- Krishnapur Village - Pending -->
                    <div class="bg-white rounded-xl p-4 shadow-sm border-l-4 border-yellow-500">
                        <div class="flex items-center justify-between mb-3">
                            <h3 class="font-semibold text-gray-900">Village: Krishnapur</h3>
                            <span class="px-3 py-1 bg-yellow-100 text-yellow-800 rounded-full text-sm">‚è≥ Pending</span>
                        </div>
                        <div class="space-y-2">
                            <div class="flex items-center justify-between py-2 border-b border-gray-100">
                                <div>
                                    <p class="font-medium text-gray-900">Baby Anita Sharma - Measles Vaccine</p>
                                    <p class="text-sm text-gray-600">2:00 PM ‚Ä¢ 9 months old</p>
                                </div>
                                <span class="text-yellow-600 text-sm">‚è≥ Scheduled</span>
                            </div>
                            <div class="flex items-center justify-between py-2 border-b border-gray-100">
                                <div>
                                    <p class="font-medium text-gray-900">Meera Devi - PNC-1 Visit</p>
                                    <p class="text-sm text-gray-600">2:30 PM ‚Ä¢ Delivered 3 days ago</p>
                                </div>
                                <span class="text-yellow-600 text-sm">‚è≥ Scheduled</span>
                            </div>
                            <div class="flex items-center justify-between py-2">
                                <div>
                                    <p class="font-medium text-gray-900">Baby Kavita - Growth Monitoring</p>
                                    <p class="text-sm text-gray-600">3:00 PM ‚Ä¢ 6 months old</p>
                                </div>
                                <span class="text-yellow-600 text-sm">‚è≥ Scheduled</span>
                            </div>
                        </div>
                        <button onclick="startVillageVisits('krishnapur')" class="w-full mt-3 px-4 py-2 bg-yellow-600 text-white rounded-lg hover:bg-yellow-700">
                            Start Village Visits
                        </button>
                    </div>

                    <!-- Govindpur Village - Pending -->
                    <div class="bg-white rounded-xl p-4 shadow-sm border-l-4 border-orange-500">
                        <div class="flex items-center justify-between mb-3">
                            <h3 class="font-semibold text-gray-900">Village: Govindpur</h3>
                            <span class="px-3 py-1 bg-orange-100 text-orange-800 rounded-full text-sm">‚è≥ Pending</span>
                        </div>
                        <div class="space-y-2">
                            <div class="flex items-center justify-between py-2 border-b border-gray-100">
                                <div>
                                    <p class="font-medium text-gray-900">Sunita Devi - High-Risk Follow-up</p>
                                    <p class="text-sm text-gray-600">4:00 PM ‚Ä¢ Anemia + Hypertension</p>
                                </div>
                                <span class="text-red-600 text-sm">üî¥ High Priority</span>
                            </div>
                            <div class="flex items-center justify-between py-2 border-b border-gray-100">
                                <div>
                                    <p class="font-medium text-gray-900">Baby Rohit - Iron Supplementation</p>
                                    <p class="text-sm text-gray-600">4:30 PM ‚Ä¢ 8 months old</p>
                                </div>
                                <span class="text-yellow-600 text-sm">‚è≥ Scheduled</span>
                            </div>
                            <div class="flex items-center justify-between py-2">
                                <div>
                                    <p class="font-medium text-gray-900">Kamala Sharma - Nutrition Counseling</p>
                                    <p class="text-sm text-gray-600">5:00 PM ‚Ä¢ New mother</p>
                                </div>
                                <span class="text-yellow-600 text-sm">‚è≥ Scheduled</span>
                            </div>
                        </div>
                        <button onclick="startVillageVisits('govindpur')" class="w-full mt-3 px-4 py-2 bg-orange-600 text-white rounded-lg hover:bg-orange-700">
                            Start Village Visits
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Pending Tasks -->
        <div id="pending-tasks" class="page-content hidden pb-20">
            <div class="p-4">
                <div class="flex items-center mb-6">
                    <button onclick="showPage('dashboard')" class="mr-3 p-2 hover:bg-gray-100 rounded-lg">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"/>
                        </svg>
                    </button>
                    <h2 class="text-xl font-bold">Pending Tasks</h2>
                </div>

                <!-- Task Filters -->
                <div class="flex space-x-2 overflow-x-auto pb-2 mb-6">
                    <button onclick="filterTasks('all')" class="task-filter-btn active px-4 py-2 bg-teal-600 text-white rounded-full text-sm whitespace-nowrap">All Tasks (6)</button>
                    <button onclick="filterTasks('overdue')" class="task-filter-btn px-4 py-2 bg-gray-200 text-gray-700 rounded-full text-sm whitespace-nowrap">Overdue (2)</button>
                    <button onclick="filterTasks('due-today')" class="task-filter-btn px-4 py-2 bg-gray-200 text-gray-700 rounded-full text-sm whitespace-nowrap">Due Today (3)</button>
                    <button onclick="filterTasks('upcoming')" class="task-filter-btn px-4 py-2 bg-gray-200 text-gray-700 rounded-full text-sm whitespace-nowrap">Upcoming (1)</button>
                </div>

                <!-- Tasks List -->
                <div id="pendingTasksList" class="space-y-3">
                    <!-- Overdue Tasks -->
                    <div class="task-item overdue bg-white rounded-xl p-4 shadow-sm border-l-4 border-red-500">
                        <div class="flex items-center justify-between">
                            <div class="flex-1">
                                <p class="font-semibold text-gray-900">Baby Raj Kumar - DPT-3 Vaccination</p>
                                <p class="text-sm text-gray-600">Rampur Village ‚Ä¢ Mother: Sunita Devi</p>
                                <p class="text-xs text-red-600 mt-1">5 days overdue</p>
                            </div>
                            <button onclick="completeTask('raj-kumar')" class="px-3 py-1 bg-red-600 text-white rounded text-xs hover:bg-red-700">Complete</button>
                        </div>
                    </div>

                    <div class="task-item overdue bg-white rounded-xl p-4 shadow-sm border-l-4 border-red-500">
                        <div class="flex items-center justify-between">
                            <div class="flex-1">
                                <p class="font-semibold text-gray-900">Sunita Devi - High-Risk ANC Follow-up</p>
                                <p class="text-sm text-gray-600">Govindpur Village ‚Ä¢ 28 weeks pregnant</p>
                                <p class="text-xs text-red-600 mt-1">2 days overdue</p>
                            </div>
                            <button onclick="completeTask('sunita-devi')" class="px-3 py-1 bg-red-600 text-white rounded text-xs hover:bg-red-700">Complete</button>
                        </div>
                    </div>

                    <!-- Due Today -->
                    <div class="task-item due-today bg-white rounded-xl p-4 shadow-sm border-l-4 border-yellow-500">
                        <div class="flex items-center justify-between">
                            <div class="flex-1">
                                <p class="font-semibold text-gray-900">Baby Anita Sharma - Measles Vaccine</p>
                                <p class="text-sm text-gray-600">Krishnapur Village ‚Ä¢ 9 months old</p>
                                <p class="text-xs text-yellow-600 mt-1">Due today</p>
                            </div>
                            <button onclick="completeTask('anita-sharma')" class="px-3 py-1 bg-yellow-600 text-white rounded text-xs hover:bg-yellow-700">Complete</button>
                        </div>
                    </div>

                    <div class="task-item due-today bg-white rounded-xl p-4 shadow-sm border-l-4 border-yellow-500">
                        <div class="flex items-center justify-between">
                            <div class="flex-1">
                                <p class="font-semibold text-gray-900">Meera Devi - PNC-1 Visit</p>
                                <p class="text-sm text-gray-600">Krishnapur Village ‚Ä¢ Delivered 3 days ago</p>
                                <p class="text-xs text-yellow-600 mt-1">Due today</p>
                            </div>
                            <button onclick="completeTask('meera-devi')" class="px-3 py-1 bg-yellow-600 text-white rounded text-xs hover:bg-yellow-700">Complete</button>
                        </div>
                    </div>

                    <div class="task-item due-today bg-white rounded-xl p-4 shadow-sm border-l-4 border-yellow-500">
                        <div class="flex items-center justify-between">
                            <div class="flex-1">
                                <p class="font-semibold text-gray-900">Baby Kavita - Growth Monitoring</p>
                                <p class="text-sm text-gray-600">Krishnapur Village ‚Ä¢ 6 months old</p>
                                <p class="text-xs text-yellow-600 mt-1">Due today</p>
                            </div>
                            <button onclick="completeTask('kavita')" class="px-3 py-1 bg-yellow-600 text-white rounded text-xs hover:bg-yellow-700">Complete</button>
                        </div>
                    </div>

                    <!-- Upcoming -->
                    <div class="task-item upcoming bg-white rounded-xl p-4 shadow-sm border-l-4 border-green-500">
                        <div class="flex items-center justify-between">
                            <div class="flex-1">
                                <p class="font-semibold text-gray-900">Priya Patel - ANC-1 Visit</p>
                                <p class="text-sm text-gray-600">Rampur Village ‚Ä¢ 12 weeks pregnant</p>
                                <p class="text-xs text-green-600 mt-1">Due in 2 days</p>
                            </div>
                            <button onclick="scheduleTask('priya-patel')" class="px-3 py-1 bg-green-600 text-white rounded text-xs hover:bg-green-700">Schedule</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- PHC Villages Page -->
        <div id="phc-villages" class="page-content hidden pb-20">
            <div class="p-4">
                <div class="flex items-center justify-between mb-6">
                    <div class="flex items-center">
                        <button onclick="showPage('phc-dashboard')" class="mr-3 p-2 hover:bg-gray-100 rounded-lg">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"/>
                            </svg>
                        </button>
                        <h2 class="text-xl font-bold">Live Village Monitoring</h2>
                    </div>
                    <div class="flex items-center space-x-2">
                        <div class="flex items-center space-x-2 bg-green-50 px-3 py-1 rounded-full">
                            <div class="w-2 h-2 bg-green-500 rounded-full pulse-dot"></div>
                            <span class="text-sm text-green-700">Live Updates</span>
                        </div>
                        <button onclick="refreshVillageData()" class="p-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700">
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"/>
                            </svg>
                        </button>
                    </div>
                </div>

                <!-- Real-time Overview Cards -->
                <div class="grid grid-cols-2 lg:grid-cols-4 gap-4 mb-6">
                    <div class="bg-gradient-to-r from-green-500 to-green-600 text-white p-4 rounded-xl">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-2xl font-bold" id="activeVillagesCount">9</p>
                                <p class="text-sm text-white font-semibold">Active Villages</p>
                            </div>
                            <div class="w-10 h-10 bg-white/20 rounded-lg flex items-center justify-center">
                                <span class="text-xl">üèòÔ∏è</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="bg-gradient-to-r from-blue-500 to-blue-600 text-white p-4 rounded-xl">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-2xl font-bold" id="onlineAshaCount">15</p>
                                <p class="text-sm text-white font-semibold">ASHA Online</p>
                            </div>
                            <div class="w-10 h-10 bg-white/20 rounded-lg flex items-center justify-center">
                                <span class="text-xl">üë©‚Äç‚öïÔ∏è</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="bg-gradient-to-r from-orange-500 to-orange-600 text-white p-4 rounded-xl">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-2xl font-bold" id="todayVisitsCount">47</p>
                                <p class="text-sm text-white font-semibold">Today's Visits</p>
                            </div>
                            <div class="w-10 h-10 bg-white/20 rounded-lg flex items-center justify-center">
                                <span class="text-xl">üìã</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="bg-gradient-to-r from-purple-500 to-purple-600 text-white p-4 rounded-xl">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-2xl font-bold" id="urgentAlertsCount">3</p>
                                <p class="text-sm text-white font-semibold">Urgent Alerts</p>
                            </div>
                            <div class="w-10 h-10 bg-white/20 rounded-lg flex items-center justify-center">
                                <span class="text-xl">üö®</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Filter and Sort Options -->
                <div class="flex items-center justify-between mb-4">
                    <div class="flex space-x-2 overflow-x-auto">
                        <button onclick="filterVillages('all')" class="village-filter-btn active px-4 py-2 bg-blue-600 text-white rounded-full text-sm whitespace-nowrap">All Villages</button>
                        <button onclick="filterVillages('critical')" class="village-filter-btn px-4 py-2 bg-gray-200 text-gray-700 rounded-full text-sm whitespace-nowrap">Critical (3)</button>
                        <button onclick="filterVillages('attention')" class="village-filter-btn px-4 py-2 bg-gray-200 text-gray-700 rounded-full text-sm whitespace-nowrap">Needs Attention (4)</button>
                        <button onclick="filterVillages('active')" class="village-filter-btn px-4 py-2 bg-gray-200 text-gray-700 rounded-full text-sm whitespace-nowrap">Active (5)</button>
                    </div>
                    <select onchange="sortVillages(this.value)" class="px-3 py-2 bg-white border border-gray-300 rounded-lg text-sm">
                        <option value="name">Sort by Name</option>
                        <option value="coverage">Sort by Coverage</option>
                        <option value="priority">Sort by Priority</option>
                        <option value="activity">Sort by Activity</option>
                    </select>
                </div>

                <!-- Enhanced Village List -->
                <div id="villagesList" class="space-y-4">
                    <!-- Rampur Village - Enhanced -->
                    <div class="village-card active bg-white rounded-xl p-4 shadow-sm border-l-4 border-green-500 hover:shadow-md transition-all cursor-pointer" onclick="expandVillageDetails('rampur')" data-village="rampur" data-status="active">
                        <div class="flex items-center justify-between mb-3">
                            <div class="flex items-center space-x-3">
                                <div class="w-12 h-12 bg-green-100 rounded-full flex items-center justify-center">
                                    <span class="text-green-600 text-xl">üèòÔ∏è</span>
                                </div>
                                <div>
                                    <h3 class="font-semibold text-gray-900 flex items-center">
                                        Rampur Village
                                        <div class="w-2 h-2 bg-green-500 rounded-full ml-2 pulse-dot" title="ASHA Online"></div>
                                    </h3>
                                    <p class="text-sm text-gray-600">ASHA: Sunita Devi ‚Ä¢ Population: 1,247 ‚Ä¢ Distance: 3.2 km</p>
                                </div>
                            </div>
                            <div class="flex items-center space-x-2">
                                <span class="px-3 py-1 bg-green-100 text-green-800 rounded-full text-sm font-medium">Excellent</span>
                                <button onclick="event.stopPropagation(); contactVillageASHA('rampur')" class="p-2 bg-green-600 text-white rounded-lg hover:bg-green-700">
                                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z"/>
                                    </svg>
                                </button>
                            </div>
                        </div>
                        
                        <div class="grid grid-cols-2 lg:grid-cols-4 gap-4 mb-3">
                            <div class="text-center">
                                <p class="text-xs text-gray-600 mb-1">Immunization</p>
                                <div class="relative">
                                    <div class="w-full bg-gray-200 rounded-full h-2">
                                        <div class="bg-green-500 h-2 rounded-full transition-all duration-500" style="width: 92%"></div>
                                    </div>
                                    <p class="text-sm font-semibold text-green-600 mt-1">92%</p>
                                </div>
                            </div>
                            <div class="text-center">
                                <p class="text-xs text-gray-600 mb-1">ANC Coverage</p>
                                <div class="relative">
                                    <div class="w-full bg-gray-200 rounded-full h-2">
                                        <div class="bg-blue-500 h-2 rounded-full transition-all duration-500" style="width: 88%"></div>
                                    </div>
                                    <p class="text-sm font-semibold text-blue-600 mt-1">88%</p>
                                </div>
                            </div>
                            <div class="text-center">
                                <p class="text-xs text-gray-600 mb-1">Today's Visits</p>
                                <p class="text-lg font-bold text-gray-900">8/12</p>
                                <p class="text-xs text-green-600">67% Complete</p>
                            </div>
                            <div class="text-center">
                                <p class="text-xs text-gray-600 mb-1">Pending Tasks</p>
                                <p class="text-lg font-bold text-orange-600">3</p>
                                <p class="text-xs text-gray-500">Low Priority</p>
                            </div>
                        </div>
                        
                        <div class="flex items-center justify-between text-sm">
                            <div class="flex items-center space-x-4">
                                <span class="text-green-600">üì± Last Sync: 15 min ago</span>
                                <span class="text-blue-600">üè• Last Visit: 2 hours ago</span>
                            </div>
                            <div class="flex items-center space-x-2">
                                <button onclick="event.stopPropagation(); viewVillageMap('rampur')" class="px-3 py-1 bg-blue-100 text-blue-700 rounded text-xs hover:bg-blue-200">View Map</button>
                                <button onclick="event.stopPropagation(); generateVillageReport('rampur')" class="px-3 py-1 bg-gray-100 text-gray-700 rounded text-xs hover:bg-gray-200">Report</button>
                            </div>
                        </div>
                        
                        <!-- Expandable Details -->
                        <div id="rampur-details" class="village-details hidden mt-4 pt-4 border-t border-gray-100">
                            <div class="grid grid-cols-1 lg:grid-cols-2 gap-4">
                                <div class="bg-gray-50 p-3 rounded-lg">
                                    <h4 class="font-semibold text-gray-800 mb-2">Recent Activities</h4>
                                    <div class="space-y-2 text-sm">
                                        <div class="flex justify-between">
                                            <span>Baby Raj - DPT-3 Vaccination</span>
                                            <span class="text-green-600">‚úÖ Completed</span>
                                        </div>
                                        <div class="flex justify-between">
                                            <span>Priya - ANC-2 Visit</span>
                                            <span class="text-green-600">‚úÖ Completed</span>
                                        </div>
                                        <div class="flex justify-between">
                                            <span>Sunita - Iron Supplementation</span>
                                            <span class="text-yellow-600">‚è≥ Scheduled</span>
                                        </div>
                                    </div>
                                </div>
                                <div class="bg-gray-50 p-3 rounded-lg">
                                    <h4 class="font-semibold text-gray-800 mb-2">Health Indicators</h4>
                                    <div class="space-y-2 text-sm">
                                        <div class="flex justify-between">
                                            <span>Malnutrition Rate:</span>
                                            <span class="text-green-600">8% (‚Üì2%)</span>
                                        </div>
                                            <!-- Education Button -->
                                        <div class="text-center mt-8">
                                            <button onclick="window.location.href='index5.html'" class="px-6 py-3 bg-blue-600 text-white font-semibold rounded-lg shadow-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2">
                                                Education
                                            </button>
                                        </div>                                    <div class="flex justify-between">
                                            <span>Institutional Deliveries:</span>
                                            <span class="text-green-600">95%</span>
                                        </div>
                                        <div class="flex justify-between">
                                            <span>High-Risk Pregnancies:</span>
                                            <span class="text-blue-600">2 Active</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Krishnapur Village - Enhanced -->
                    <div class="village-card attention bg-white rounded-xl p-4 shadow-sm border-l-4 border-yellow-500 hover:shadow-md transition-all cursor-pointer" onclick="expandVillageDetails('krishnapur')" data-village="krishnapur" data-status="attention">
                        <div class="flex items-center justify-between mb-3">
                            <div class="flex items-center space-x-3">
                                <div class="w-12 h-12 bg-yellow-100 rounded-full flex items-center justify-center">
                                    <span class="text-yellow-600 text-xl">üèòÔ∏è</span>
                                </div>
                                <div>
                                    <h3 class="font-semibold text-gray-900 flex items-center">
                                        Krishnapur Village
                                        <div class="w-2 h-2 bg-yellow-500 rounded-full ml-2 pulse-dot" title="ASHA Active"></div>
                                    </h3>
                                    <p class="text-sm text-gray-600">ASHA: Priya Sharma ‚Ä¢ Population: 892 ‚Ä¢ Distance: 5.8 km</p>
                                </div>
                            </div>
                            <div class="flex items-center space-x-2">
                                <span class="px-3 py-1 bg-yellow-100 text-yellow-800 rounded-full text-sm font-medium">Needs Attention</span>
                                <button onclick="event.stopPropagation(); contactVillageASHA('krishnapur')" class="p-2 bg-yellow-600 text-white rounded-lg hover:bg-yellow-700">
                                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z"/>
                                    </svg>
                                </button>
                            </div>
                        </div>
                        
                        <div class="grid grid-cols-2 lg:grid-cols-4 gap-4 mb-3">
                            <div class="text-center">
                                <p class="text-xs text-gray-600 mb-1">Immunization</p>
                                <div class="relative">
                                    <div class="w-full bg-gray-200 rounded-full h-2">
                                        <div class="bg-yellow-500 h-2 rounded-full transition-all duration-500" style="width: 76%"></div>
                                    </div>
                                    <p class="text-sm font-semibold text-yellow-600 mt-1">76%</p>
                                </div>
                            </div>
                            <div class="text-center">
                                <p class="text-xs text-gray-600 mb-1">ANC Coverage</p>
                                <div class="relative">
                                    <div class="w-full bg-gray-200 rounded-full h-2">
                                        <div class="bg-yellow-500 h-2 rounded-full transition-all duration-500" style="width: 82%"></div>
                                    </div>
                                    <p class="text-sm font-semibold text-yellow-600 mt-1">82%</p>
                                </div>
                            </div>
                            <div class="text-center">
                                <p class="text-xs text-gray-600 mb-1">Today's Visits</p>
                                <p class="text-lg font-bold text-gray-900">5/10</p>
                                <p class="text-xs text-yellow-600">50% Complete</p>
                            </div>
                            <div class="text-center">
                                <p class="text-xs text-gray-600 mb-1">Pending Tasks</p>
                                <p class="text-lg font-bold text-orange-600">8</p>
                                <p class="text-xs text-yellow-600">Medium Priority</p>
                            </div>
                        </div>
                        
                        <div class="flex items-center justify-between text-sm">
                            <div class="flex items-center space-x-4">
                                <span class="text-yellow-600">üì± Last Sync: 2 hours ago</span>
                                <span class="text-blue-600">üè• Last Visit: 4 hours ago</span>
                            </div>
                            <div class="flex items-center space-x-2">
                                <button onclick="event.stopPropagation(); viewVillageMap('krishnapur')" class="px-3 py-1 bg-blue-100 text-blue-700 rounded text-xs hover:bg-blue-200">View Map</button>
                                <button onclick="event.stopPropagation(); generateVillageReport('krishnapur')" class="px-3 py-1 bg-gray-100 text-gray-700 rounded text-xs hover:bg-gray-200">Report</button>
                            </div>
                        </div>
                        
                        <!-- Expandable Details -->
                        <div id="krishnapur-details" class="village-details hidden mt-4 pt-4 border-t border-gray-100">
                            <div class="grid grid-cols-1 lg:grid-cols-2 gap-4">
                                <div class="bg-gray-50 p-3 rounded-lg">
                                    <h4 class="font-semibold text-gray-800 mb-2">Recent Activities</h4>
                                    <div class="space-y-2 text-sm">
                                        <div class="flex justify-between">
                                            <span>Baby Anita - Measles Vaccine</span>
                                            <span class="text-yellow-600">‚è≥ Due Today</span>
                                        </div>
                                        <div class="flex justify-between">
                                            <span>Meera - PNC-1 Visit</span>
                                            <span class="text-yellow-600">‚è≥ Scheduled</span>
                                        </div>
                                        <div class="flex justify-between">
                                            <span>Baby Kavita - Growth Check</span>
                                            <span class="text-red-600">‚ö†Ô∏è Overdue</span>
                                        </div>
                                    </div>
                                </div>
                                <div class="bg-gray-50 p-3 rounded-lg">
                                    <h4 class="font-semibold text-gray-800 mb-2">Health Indicators</h4>
                                    <div class="space-y-2 text-sm">
                                        <div class="flex justify-between">
                                            <span>Malnutrition Rate:</span>
                                            <span class="text-yellow-600">12% (‚Üë1%)</span>
                                        </div>
                                        <div class="flex justify-between">
                                            <span>Institutional Deliveries:</span>
                                            <span class="text-yellow-600">87%</span>
                                        </div>
                                        <div class="flex justify-between">
                                            <span>High-Risk Pregnancies:</span>
                                            <span class="text-orange-600">3 Active</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Govindpur Village - Enhanced -->
                    <div class="village-card critical bg-white rounded-xl p-4 shadow-sm border-l-4 border-red-500 hover:shadow-md transition-all cursor-pointer" onclick="expandVillageDetails('govindpur')" data-village="govindpur" data-status="critical">
                        <div class="flex items-center justify-between mb-3">
                            <div class="flex items-center space-x-3">
                                <div class="w-12 h-12 bg-red-100 rounded-full flex items-center justify-center">
                                    <span class="text-red-600 text-xl">üèòÔ∏è</span>
                                </div>
                                <div>
                                    <h3 class="font-semibold text-gray-900 flex items-center">
                                        Govindpur Village
                                        <div class="w-2 h-2 bg-red-500 rounded-full ml-2" title="ASHA Offline"></div>
                                    </h3>
                                    <p class="text-sm text-gray-600">ASHA: Meera Devi ‚Ä¢ Population: 1,156 ‚Ä¢ Distance: 8.1 km</p>
                                </div>
                            </div>
                            <div class="flex items-center space-x-2">
                                <span class="px-3 py-1 bg-red-100 text-red-800 rounded-full text-sm font-medium">Critical</span>
                                <button onclick="event.stopPropagation(); contactVillageASHA('govindpur')" class="p-2 bg-red-600 text-white rounded-lg hover:bg-red-700">
                                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"/>
                                    </svg>
                                </button>
                            </div>
                        </div>
                        
                        <div class="grid grid-cols-2 lg:grid-cols-4 gap-4 mb-3">
                            <div class="text-center">
                                <p class="text-xs text-gray-600 mb-1">Immunization</p>
                                <div class="relative">
                                    <div class="w-full bg-gray-200 rounded-full h-2">
                                        <div class="bg-red-500 h-2 rounded-full transition-all duration-500" style="width: 68%"></div>
                                    </div>
                                    <p class="text-sm font-semibold text-red-600 mt-1">68%</p>
                                </div>
                            </div>
                            <div class="text-center">
                                <p class="text-xs text-gray-600 mb-1">ANC Coverage</p>
                                <div class="relative">
                                    <div class="w-full bg-gray-200 rounded-full h-2">
                                        <div class="bg-red-500 h-2 rounded-full transition-all duration-500" style="width: 71%"></div>
                                    </div>
                                    <p class="text-sm font-semibold text-red-600 mt-1">71%</p>
                                </div>
                            </div>
                            <div class="text-center">
                                <p class="text-xs text-gray-600 mb-1">Today's Visits</p>
                                <p class="text-lg font-bold text-gray-900">2/15</p>
                                <p class="text-xs text-red-600">13% Complete</p>
                            </div>
                            <div class="text-center">
                                <p class="text-xs text-gray-600 mb-1">Pending Tasks</p>
                                <p class="text-lg font-bold text-red-600">12</p>
                                <p class="text-xs text-red-600">High Priority</p>
                            </div>
                        </div>
                        
                        <div class="flex items-center justify-between text-sm">
                            <div class="flex items-center space-x-4">
                                <span class="text-red-600">üì± Last Sync: 1 day ago</span>
                                <span class="text-red-600">üè• Last Visit: 8 hours ago</span>
                            </div>
                            <div class="flex items-center space-x-2">
                                <button onclick="event.stopPropagation(); viewVillageMap('govindpur')" class="px-3 py-1 bg-blue-100 text-blue-700 rounded text-xs hover:bg-blue-200">View Map</button>
                                <button onclick="event.stopPropagation(); generateVillageReport('govindpur')" class="px-3 py-1 bg-gray-100 text-gray-700 rounded text-xs hover:bg-gray-200">Report</button>
                            </div>
                        </div>
                        
                        <!-- Expandable Details -->
                        <div id="govindpur-details" class="village-details hidden mt-4 pt-4 border-t border-gray-100">
                            <div class="grid grid-cols-1 lg:grid-cols-2 gap-4">
                                <div class="bg-gray-50 p-3 rounded-lg">
                                    <h4 class="font-semibold text-gray-800 mb-2">Recent Activities</h4>
                                    <div class="space-y-2 text-sm">
                                        <div class="flex justify-between">
                                            <span>Sunita - High-Risk Follow-up</span>
                                            <span class="text-red-600">üî¥ Urgent</span>
                                        </div>
                                        <div class="flex justify-between">
                                            <span>Baby Rohit - Iron Supplement</span>
                                            <span class="text-red-600">‚ö†Ô∏è Overdue</span>
                                        </div>
                                        <div class="flex justify-between">
                                            <span>Kamala - Nutrition Counseling</span>
                                            <span class="text-yellow-600">‚è≥ Scheduled</span>
                                        </div>
                                    </div>
                                </div>
                                <div class="bg-gray-50 p-3 rounded-lg">
                                    <h4 class="font-semibold text-gray-800 mb-2">Health Indicators</h4>
                                    <div class="space-y-2 text-sm">
                                        <div class="flex justify-between">
                                            <span>Malnutrition Rate:</span>
                                            <span class="text-red-600">18% (‚Üë3%)</span>
                                        </div>
                                        <div class="flex justify-between">
                                            <span>Institutional Deliveries:</span>
                                            <span class="text-red-600">72%</span>
                                        </div>
                                        <div class="flex justify-between">
                                            <span>High-Risk Pregnancies:</span>
                                            <span class="text-red-600">5 Active</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Quick Action Panel -->
                <div class="fixed bottom-24 right-4 space-y-2" id="villageActionsPanel">
                    <button onclick="bulkVillageAction()" class="w-12 h-12 bg-purple-600 text-white rounded-full shadow-lg hover:bg-purple-700 flex items-center justify-center" title="Bulk Actions">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v6a2 2 0 002 2h6a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"/>
                        </svg>
                    </button>
                    <button onclick="exportVillageData()" class="w-12 h-12 bg-green-600 text-white rounded-full shadow-lg hover:bg-green-700 flex items-center justify-center" title="Export Data">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/>
                        </svg>
                    </button>
                </div>
            </div>
        </div>

        <!-- PHC Sync Management -->
        <div id="phc-sync" class="page-content hidden pb-20">
            <div class="p-4">
                <div class="flex items-center mb-6">
                    <button onclick="showPage('phc-dashboard')" class="mr-3 p-2 hover:bg-gray-100 rounded-lg">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"/>
                        </svg>
                    </button>
                    <h2 class="text-xl font-bold">Sync Management</h2>
                </div>

                <!-- Sync Overview -->
                <div class="bg-white rounded-xl p-4 shadow-sm mb-6">
                    <div class="flex items-center justify-between mb-4">
                        <h3 class="text-lg font-semibold">Synchronization Status</h3>
                        <button onclick="syncAllData()" class="primary-btn text-sm">
                            Sync All Now
                        </button>
                    </div>
                    <div class="grid grid-cols-1 lg:grid-cols-3 gap-4">
                        <div class="text-center p-4 bg-green-50 rounded-lg">
                            <p class="text-2xl font-bold text-green-600">15</p>
                            <p class="text-sm text-green-600">Synced</p>
                        </div>
                        <div class="text-center p-4 bg-yellow-50 rounded-lg">
                            <p class="text-2xl font-bold text-yellow-600">3</p>
                            <p class="text-sm text-yellow-600">Pending</p>
                        </div>
                        <div class="text-center p-4 bg-red-50 rounded-lg">
                            <p class="text-2xl font-bold text-red-600">0</p>
                            <p class="text-sm text-red-600">Failed</p>
                        </div>
                    </div>
                </div>

                <!-- ASHA-wise Sync Status -->
                <div class="space-y-3">
                    <div class="bg-white rounded-xl p-4 shadow-sm">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="font-semibold text-gray-900">Sunita Devi - Rampur</p>
                                <p class="text-sm text-gray-600">Last sync: 2 hours ago</p>
                            </div>
                            <div class="flex items-center space-x-2">
                                <span class="px-3 py-1 bg-green-100 text-green-800 rounded-full text-sm">Synced</span>
                                <button onclick="syncASHA('sunita')" class="p-2 text-gray-400 hover:text-gray-600">
                                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"/>
                                    </svg>
                                </button>
                            </div>
                        </div>
                    </div>

                    <div class="bg-white rounded-xl p-4 shadow-sm">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="font-semibold text-gray-900">Priya Sharma - Krishnapur</p>
                                <p class="text-sm text-gray-600">Last sync: 6 hours ago</p>
                            </div>
                            <div class="flex items-center space-x-2">
                                <span class="px-3 py-1 bg-yellow-100 text-yellow-800 rounded-full text-sm">Pending</span>
                                <button onclick="syncASHA('priya')" class="p-2 text-gray-400 hover:text-gray-600">
                                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"/>
                                    </svg>
                                </button>
                            </div>
                        </div>
                    </div>

                    <div class="bg-white rounded-xl p-4 shadow-sm">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="font-semibold text-gray-900">Meera Devi - Govindpur</p>
                                <p class="text-sm text-gray-600">Last sync: 1 day ago</p>
                            </div>
                            <div class="flex items-center space-x-2">
                                <span class="px-3 py-1 bg-red-100 text-red-800 rounded-full text-sm">Critical</span>
                                <button onclick="syncASHA('meera')" class="p-2 text-gray-400 hover:text-gray-600">
                                    <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"/>
                                    </svg>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- PHC Alerts -->
        <div id="phc-alerts" class="page-content hidden pb-20">
            <div class="p-4">
                <div class="flex items-center justify-between mb-6">
                    <div class="flex items-center">
                        <button onclick="showPage('phc-dashboard')" class="mr-3 p-2 hover:bg-gray-100 rounded-lg">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"/>
                            </svg>
                        </button>
                        <h2 class="text-xl font-bold">Alerts & Notifications</h2>
                    </div>
                    <div class="flex items-center space-x-2">
                        <button onclick="refreshAlerts()" class="p-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700">
                            <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"/>
                            </svg>
                        </button>
                        <button onclick="markAllAlertsRead()" class="px-3 py-2 bg-gray-600 text-white rounded-lg text-sm hover:bg-gray-700">Mark All Read</button>
                    </div>
                </div>

                <!-- Alert Summary -->
                <div class="grid grid-cols-2 lg:grid-cols-4 gap-4 mb-6">
                    <div class="bg-white rounded-xl p-4 shadow-sm border-l-4 border-red-500">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-2xl font-bold text-red-600" id="criticalAlertsCount">8</p>
                                <p class="text-sm text-red-600">Critical</p>
                            </div>
                            <div class="w-10 h-10 bg-red-100 rounded-lg flex items-center justify-center">
                                <span class="text-red-600">üö®</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="bg-white rounded-xl p-4 shadow-sm border-l-4 border-yellow-500">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-2xl font-bold text-yellow-600" id="warningAlertsCount">15</p>
                                <p class="text-sm text-yellow-600">Warning</p>
                            </div>
                            <div class="w-10 h-10 bg-yellow-100 rounded-lg flex items-center justify-center">
                                <span class="text-yellow-600">‚ö†Ô∏è</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="bg-white rounded-xl p-4 shadow-sm border-l-4 border-blue-500">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-2xl font-bold text-blue-600" id="infoAlertsCount">23</p>
                                <p class="text-sm text-blue-600">Info</p>
                            </div>
                            <div class="w-10 h-10 bg-blue-100 rounded-lg flex items-center justify-center">
                                <span class="text-blue-600">‚ÑπÔ∏è</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="bg-white rounded-xl p-4 shadow-sm border-l-4 border-green-500">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-2xl font-bold text-green-600" id="resolvedAlertsCount">142</p>
                                <p class="text-sm text-green-600">Resolved</p>
                            </div>
                            <div class="w-10 h-10 bg-green-100 rounded-lg flex items-center justify-center">
                                <span class="text-green-600">‚úÖ</span>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Alert Filters -->
                <div class="flex space-x-2 overflow-x-auto pb-2 mb-6">
                    <button onclick="filterAlerts('all')" class="alert-filter-btn active px-4 py-2 bg-blue-600 text-white rounded-full text-sm whitespace-nowrap">All Alerts</button>
                    <button onclick="filterAlerts('critical')" class="alert-filter-btn px-4 py-2 bg-gray-200 text-gray-700 rounded-full text-sm whitespace-nowrap">Critical (8)</button>
                    <button onclick="filterAlerts('warning')" class="alert-filter-btn px-4 py-2 bg-gray-200 text-gray-700 rounded-full text-sm whitespace-nowrap">Warning (15)</button>
                    <button onclick="filterAlerts('info')" class="alert-filter-btn px-4 py-2 bg-gray-200 text-gray-700 rounded-full text-sm whitespace-nowrap">Info (23)</button>
                    <button onclick="filterAlerts('unread')" class="alert-filter-btn px-4 py-2 bg-gray-200 text-gray-700 rounded-full text-sm whitespace-nowrap">Unread (31)</button>
                </div>

                <!-- Alert Categories -->
                <div id="alertsList" class="space-y-4">
                    <!-- High-Risk Pregnancies -->
                    <div class="alert-item critical bg-white rounded-xl p-4 shadow-sm border-l-4 border-red-500" data-alert-id="high-risk-pregnancies">
                        <div class="flex items-center justify-between mb-3">
                            <div class="flex items-center space-x-3">
                                <div class="w-3 h-3 bg-red-500 rounded-full pulse-dot"></div>
                                <h3 class="font-semibold text-red-800">üö® High-Risk Pregnancies</h3>
                                <span class="px-2 py-1 bg-red-100 text-red-800 rounded-full text-xs">CRITICAL</span>
                            </div>
                            <div class="flex items-center space-x-2">
                                <span class="px-3 py-1 bg-red-100 text-red-800 rounded-full text-sm">5 cases</span>
                                <button onclick="toggleAlertDetails('high-risk-pregnancies')" class="p-1 hover:bg-gray-100 rounded">
                                    <svg class="w-4 h-4 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/>
                                    </svg>
                                </button>
                            </div>
                        </div>
                        <div class="alert-details space-y-2">
                            <div class="flex items-center justify-between py-2 border-b border-gray-100">
                                <div class="flex-1">
                                    <p class="font-medium text-gray-900">Sunita Devi - Govindpur Village</p>
                                    <p class="text-sm text-gray-600">Anemia + Hypertension ‚Ä¢ 28 weeks pregnant</p>
                                    <p class="text-xs text-red-600">Last visit: 3 days ago ‚Ä¢ Next due: Today</p>
                                </div>
                                <div class="flex space-x-2">
                                    <button onclick="assignAlert('sunita-risk')" class="px-3 py-1 bg-blue-600 text-white rounded text-xs hover:bg-blue-700">Assign</button>
                                    <button onclick="reviewAlert('sunita-risk')" class="px-3 py-1 bg-red-600 text-white rounded text-xs hover:bg-red-700">Review</button>
                                </div>
                            </div>
                            <div class="flex items-center justify-between py-2 border-b border-gray-100">
                                <div class="flex-1">
                                    <p class="font-medium text-gray-900">Kamala Sharma - Rampur Village</p>
                                    <p class="text-sm text-gray-600">Gestational Diabetes ‚Ä¢ 32 weeks pregnant</p>
                                    <p class="text-xs text-red-600">Last visit: 1 week ago ‚Ä¢ Blood sugar monitoring needed</p>
                                </div>
                                <div class="flex space-x-2">
                                    <button onclick="assignAlert('kamala-risk')" class="px-3 py-1 bg-blue-600 text-white rounded text-xs hover:bg-blue-700">Assign</button>
                                    <button onclick="reviewAlert('kamala-risk')" class="px-3 py-1 bg-red-600 text-white rounded text-xs hover:bg-red-700">Review</button>
                                </div>
                            </div>
                            <div class="flex items-center justify-between py-2 border-b border-gray-100">
                                <div class="flex-1">
                                    <p class="font-medium text-gray-900">Priya Patel - Krishnapur Village</p>
                                    <p class="text-sm text-gray-600">Previous C-section + Low hemoglobin ‚Ä¢ 24 weeks</p>
                                    <p class="text-xs text-red-600">Iron supplementation compliance poor</p>
                                </div>
                                <div class="flex space-x-2">
                                    <button onclick="assignAlert('priya-risk')" class="px-3 py-1 bg-blue-600 text-white rounded text-xs hover:bg-blue-700">Assign</button>
                                    <button onclick="reviewAlert('priya-risk')" class="px-3 py-1 bg-red-600 text-white rounded text-xs hover:bg-red-700">Review</button>
                                </div>
                            </div>
                        </div>
                        <div class="mt-3 flex justify-between items-center">
                            <p class="text-xs text-gray-500">Generated: 2 hours ago</p>
                            <button onclick="resolveAlertCategory('high-risk-pregnancies')" class="px-3 py-1 bg-green-600 text-white rounded text-xs hover:bg-green-700">Mark Category Reviewed</button>
                        </div>
                    </div>

                    <!-- Overdue Immunizations -->
                    <div class="alert-item warning bg-white rounded-xl p-4 shadow-sm border-l-4 border-yellow-500" data-alert-id="overdue-immunizations">
                        <div class="flex items-center justify-between mb-3">
                            <div class="flex items-center space-x-3">
                                <div class="w-3 h-3 bg-yellow-500 rounded-full pulse-dot"></div>
                                <h3 class="font-semibold text-yellow-800">‚ö†Ô∏è Overdue Immunizations</h3>
                                <span class="px-2 py-1 bg-yellow-100 text-yellow-800 rounded-full text-xs">WARNING</span>
                            </div>
                            <div class="flex items-center space-x-2">
                                <span class="px-3 py-1 bg-yellow-100 text-yellow-800 rounded-full text-sm">12 children</span>
                                <button onclick="toggleAlertDetails('overdue-immunizations')" class="p-1 hover:bg-gray-100 rounded">
                                    <svg class="w-4 h-4 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/>
                                    </svg>
                                </button>
                            </div>
                        </div>
                        <div class="alert-details space-y-2 hidden">
                            <div class="flex items-center justify-between py-2 border-b border-gray-100">
                                <div class="flex-1">
                                    <p class="font-medium text-gray-900">Baby Raj Kumar - Rampur Village</p>
                                    <p class="text-sm text-gray-600">DPT-3 + OPV-3 overdue by 5 days</p>
                                    <p class="text-xs text-yellow-600">Mother: Sunita Devi ‚Ä¢ Age: 4 months</p>
                                </div>
                                <div class="flex space-x-2">
                                    <button onclick="scheduleVaccination('raj-dpt3')" class="px-3 py-1 bg-green-600 text-white rounded text-xs hover:bg-green-700">Schedule</button>
                                    <button onclick="reviewAlert('raj-overdue')" class="px-3 py-1 bg-yellow-600 text-white rounded text-xs hover:bg-yellow-700">Review</button>
                                </div>
                            </div>
                            <div class="flex items-center justify-between py-2 border-b border-gray-100">
                                <div class="flex-1">
                                    <p class="font-medium text-gray-900">Baby Anita Sharma - Krishnapur Village</p>
                                    <p class="text-sm text-gray-600">Measles vaccine overdue by 2 days</p>
                                    <p class="text-xs text-yellow-600">Mother: Meera Devi ‚Ä¢ Age: 9 months</p>
                                </div>
                                <div class="flex space-x-2">
                                    <button onclick="scheduleVaccination('anita-measles')" class="px-3 py-1 bg-green-600 text-white rounded text-xs hover:bg-green-700">Schedule</button>
                                    <button onclick="reviewAlert('anita-overdue')" class="px-3 py-1 bg-yellow-600 text-white rounded text-xs hover:bg-yellow-700">Review</button>
                                </div>
                            </div>
                            <div class="flex items-center justify-between py-2">
                                <div class="flex-1">
                                    <p class="font-medium text-gray-900">Baby Rohit Patel - Govindpur Village</p>
                                    <p class="text-sm text-gray-600">DPT-2 + OPV-2 overdue by 1 week</p>
                                    <p class="text-xs text-yellow-600">Mother: Kavita Patel ‚Ä¢ Age: 3 months</p>
                                </div>
                                <div class="flex space-x-2">
                                    <button onclick="scheduleVaccination('rohit-dpt2')" class="px-3 py-1 bg-green-600 text-white rounded text-xs hover:bg-green-700">Schedule</button>
                                    <button onclick="reviewAlert('rohit-overdue')" class="px-3 py-1 bg-yellow-600 text-white rounded text-xs hover:bg-yellow-700">Review</button>
                                </div>
                            </div>
                        </div>
                        <div class="mt-3 flex justify-between items-center">
                            <p class="text-xs text-gray-500">Generated: 4 hours ago</p>
                            <button onclick="resolveAlertCategory('overdue-immunizations')" class="px-3 py-1 bg-green-600 text-white rounded text-xs hover:bg-green-700">Mark Category Reviewed</button>
                        </div>
                    </div>

                    <!-- ASHA Worker Issues -->
                    <div class="alert-item warning bg-white rounded-xl p-4 shadow-sm border-l-4 border-orange-500" data-alert-id="asha-issues">
                        <div class="flex items-center justify-between mb-3">
                            <div class="flex items-center space-x-3">
                                <div class="w-3 h-3 bg-orange-500 rounded-full pulse-dot"></div>
                                <h3 class="font-semibold text-orange-800">üë©‚Äç‚öïÔ∏è ASHA Worker Issues</h3>
                                <span class="px-2 py-1 bg-orange-100 text-orange-800 rounded-full text-xs">WARNING</span>
                            </div>
                            <div class="flex items-center space-x-2">
                                <span class="px-3 py-1 bg-orange-100 text-orange-800 rounded-full text-sm">3 workers</span>
                                <button onclick="toggleAlertDetails('asha-issues')" class="p-1 hover:bg-gray-100 rounded">
                                    <svg class="w-4 h-4 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/>
                                    </svg>
                                </button>
                            </div>
                        </div>
                        <div class="alert-details space-y-2 hidden">
                            <div class="flex items-center justify-between py-2 border-b border-gray-100">
                                <div class="flex-1">
                                    <p class="font-medium text-gray-900">Meera Devi - Govindpur Village</p>
                                    <p class="text-sm text-gray-600">No data sync for 2 days ‚Ä¢ 12 pending tasks</p>
                                    <p class="text-xs text-orange-600">Last contact: 3 days ago</p>
                                </div>
                                <div class="flex space-x-2">
                                    <button onclick="contactASHA('meera-devi')" class="px-3 py-1 bg-blue-600 text-white rounded text-xs hover:bg-blue-700">Contact</button>
                                    <button onclick="reviewAlert('meera-issues')" class="px-3 py-1 bg-orange-600 text-white rounded text-xs hover:bg-orange-700">Review</button>
                                </div>
                            </div>
                            <div class="flex items-center justify-between py-2 border-b border-gray-100">
                                <div class="flex-1">
                                    <p class="font-medium text-gray-900">Priya Sharma - Krishnapur Village</p>
                                    <p class="text-sm text-gray-600">Low task completion rate (65%) this month</p>
                                    <p class="text-xs text-orange-600">8 overdue visits ‚Ä¢ Training needed</p>
                                </div>
                                <div class="flex space-x-2">
                                    <button onclick="scheduleTraining('priya-sharma')" class="px-3 py-1 bg-purple-600 text-white rounded text-xs hover:bg-purple-700">Training</button>
                                    <button onclick="reviewAlert('priya-performance')" class="px-3 py-1 bg-orange-600 text-white rounded text-xs hover:bg-orange-700">Review</button>
                                </div>
                            </div>
                        </div>
                        <div class="mt-3 flex justify-between items-center">
                            <p class="text-xs text-gray-500">Generated: 6 hours ago</p>
                            <button onclick="resolveAlertCategory('asha-issues')" class="px-3 py-1 bg-green-600 text-white rounded text-xs hover:bg-green-700">Mark Category Reviewed</button>
                        </div>
                    </div>

                    <!-- Pending Reports -->
                    <div class="alert-item info bg-white rounded-xl p-4 shadow-sm border-l-4 border-blue-500" data-alert-id="pending-reports">
                        <div class="flex items-center justify-between mb-3">
                            <div class="flex items-center space-x-3">
                                <div class="w-3 h-3 bg-blue-500 rounded-full pulse-dot"></div>
                                <h3 class="font-semibold text-blue-800">üìã Pending Reports</h3>
                                <span class="px-2 py-1 bg-blue-100 text-blue-800 rounded-full text-xs">INFO</span>
                            </div>
                            <div class="flex items-center space-x-2">
                                <span class="px-3 py-1 bg-blue-100 text-blue-800 rounded-full text-sm">4 reports</span>
                                <button onclick="toggleAlertDetails('pending-reports')" class="p-1 hover:bg-gray-100 rounded">
                                    <svg class="w-4 h-4 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/>
                                    </svg>
                                </button>
                            </div>
                        </div>
                        <div class="alert-details space-y-2 hidden">
                            <div class="flex items-center justify-between py-2 border-b border-gray-100">
                                <div class="flex-1">
                                    <p class="font-medium text-gray-900">Monthly Immunization Report</p>
                                    <p class="text-sm text-gray-600">Due: Yesterday ‚Ä¢ Coverage analysis needed</p>
                                    <p class="text-xs text-blue-600">All village data available</p>
                                </div>
                                <div class="flex space-x-2">
                                    <button onclick="generateReport('monthly-immunization')" class="px-3 py-1 bg-green-600 text-white rounded text-xs hover:bg-green-700">Generate</button>
                                    <button onclick="reviewAlert('monthly-report')" class="px-3 py-1 bg-blue-600 text-white rounded text-xs hover:bg-blue-700">Review</button>
                                </div>
                            </div>
                            <div class="flex items-center justify-between py-2 border-b border-gray-100">
                                <div class="flex-1">
                                    <p class="font-medium text-gray-900">ANC Coverage Report</p>
                                    <p class="text-sm text-gray-600">Due: Today ‚Ä¢ Quarterly submission</p>
                                    <p class="text-xs text-blue-600">92% data completeness</p>
                                </div>
                                <div class="flex space-x-2">
                                    <button onclick="generateReport('anc-coverage')" class="px-3 py-1 bg-green-600 text-white rounded text-xs hover:bg-green-700">Generate</button>
                                    <button onclick="reviewAlert('anc-report')" class="px-3 py-1 bg-blue-600 text-white rounded text-xs hover:bg-blue-700">Review</button>
                                </div>
                            </div>
                        </div>
                        <div class="mt-3 flex justify-between items-center">
                            <p class="text-xs text-gray-500">Generated: 1 day ago</p>
                            <button onclick="resolveAlertCategory('pending-reports')" class="px-3 py-1 bg-green-600 text-white rounded text-xs hover:bg-green-700">Mark Category Reviewed</button>
                        </div>
                    </div>

                    <!-- System Notifications -->
                    <div class="alert-item info bg-white rounded-xl p-4 shadow-sm border-l-4 border-green-500" data-alert-id="system-notifications">
                        <div class="flex items-center justify-between mb-3">
                            <div class="flex items-center space-x-3">
                                <div class="w-3 h-3 bg-green-500 rounded-full pulse-dot"></div>
                                <h3 class="font-semibold text-green-800">‚öôÔ∏è System Notifications</h3>
                                <span class="px-2 py-1 bg-green-100 text-green-800 rounded-full text-xs">INFO</span>
                            </div>
                            <div class="flex items-center space-x-2">
                                <span class="px-3 py-1 bg-green-100 text-green-800 rounded-full text-sm">2 updates</span>
                                <button onclick="toggleAlertDetails('system-notifications')" class="p-1 hover:bg-gray-100 rounded">
                                    <svg class="w-4 h-4 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/>
                                    </svg>
                                </button>
                            </div>
                        </div>
                        <div class="alert-details space-y-2 hidden">
                            <div class="flex items-center justify-between py-2 border-b border-gray-100">
                                <div class="flex-1">
                                    <p class="font-medium text-gray-900">System Backup Completed</p>
                                    <p class="text-sm text-gray-600">All PHC data backed up successfully</p>
                                    <p class="text-xs text-green-600">Backup size: 45.2 MB ‚Ä¢ Time: 02:30 AM</p>
                                </div>
                                <button onclick="dismissAlert('backup-complete')" class="px-3 py-1 bg-gray-600 text-white rounded text-xs hover:bg-gray-700">Dismiss</button>
                            </div>
                            <div class="flex items-center justify-between py-2">
                                <div class="flex-1">
                                    <p class="font-medium text-gray-900">New Training Module Available</p>
                                    <p class="text-sm text-gray-600">Maternal Health Best Practices - 2024 Update</p>
                                    <p class="text-xs text-green-600">Duration: 45 minutes ‚Ä¢ For all ASHA workers</p>
                                </div>
                                <button onclick="viewTrainingModule('maternal-2024')" class="px-3 py-1 bg-blue-600 text-white rounded text-xs hover:bg-blue-700">View</button>
                            </div>
                        </div>
                        <div class="mt-3 flex justify-between items-center">
                            <p class="text-xs text-gray-500">Generated: 8 hours ago</p>
                            <button onclick="resolveAlertCategory('system-notifications')" class="px-3 py-1 bg-green-600 text-white rounded text-xs hover:bg-green-700">Mark Category Reviewed</button>
                        </div>
                    </div>
                </div>

                <!-- Alert Actions Panel -->
                <div class="fixed bottom-24 right-4 space-y-2" id="alertActionsPanel">
                    <button onclick="createCustomAlert()" class="w-12 h-12 bg-blue-600 text-white rounded-full shadow-lg hover:bg-blue-700 flex items-center justify-center">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"/>
                        </svg>
                    </button>
                    <button onclick="exportAlerts()" class="w-12 h-12 bg-green-600 text-white rounded-full shadow-lg hover:bg-green-700 flex items-center justify-center">
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 10v6m0 0l-3-3m3 3l3-3m2 8H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/>
                        </svg>
                    </button>
                </div>
            </div>
        </div>

        <!-- Missing ASHA Pages -->
        <!-- Health Records Page -->
        <div id="health-records" class="page-content hidden pb-20">
            <div class="p-4">
                <div class="flex items-center mb-6">
                    <button onclick="showPage('dashboard')" class="mr-3 p-2 hover:bg-gray-100 rounded-lg">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"/>
                        </svg>
                    </button>
                    <h2 class="text-xl font-bold">Health Records</h2>
                </div>

                <!-- Search Bar -->
                <div class="mb-6">
                    <div class="relative">
                        <input type="text" placeholder="Search patients..." class="w-full px-4 py-3 pl-10 bg-white rounded-xl border border-gray-200 focus:outline-none focus:ring-2 focus:ring-teal-500">
                        <svg class="w-5 h-5 text-gray-400 absolute left-3 top-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"/>
                        </svg>
                    </div>
                </div>

                <!-- Patient Records -->
                <div class="space-y-3">
                    <div class="bg-white rounded-xl p-4 shadow-sm">
                        <div class="flex items-center justify-between">
                            <div>
                                <h3 class="font-semibold text-gray-900">Baby Raj Kumar</h3>
                                <p class="text-sm text-gray-600">4 months ‚Ä¢ Mother: Sunita Devi</p>
                                <p class="text-xs text-gray-500">Last visit: 2 days ago</p>
                            </div>
                            <button onclick="viewPatientRecord('raj-kumar')" class="px-4 py-2 bg-teal-600 text-white rounded-lg text-sm hover:bg-teal-700">View</button>
                        </div>
                    </div>

                    <div class="bg-white rounded-xl p-4 shadow-sm">
                        <div class="flex items-center justify-between">
                            <div>
                                <h3 class="font-semibold text-gray-900">Priya Sharma</h3>
                                <p class="text-sm text-gray-600">28 years ‚Ä¢ Pregnant (20 weeks)</p>
                                <p class="text-xs text-gray-500">Last visit: 1 week ago</p>
                            </div>
                            <button onclick="viewPatientRecord('priya-sharma')" class="px-4 py-2 bg-teal-600 text-white rounded-lg text-sm hover:bg-teal-700">View</button>
                        </div>
                    </div>

                    <div class="bg-white rounded-xl p-4 shadow-sm">
                        <div class="flex items-center justify-between">
                            <div>
                                <h3 class="font-semibold text-gray-900">Baby Anita Sharma</h3>
                                <p class="text-sm text-gray-600">9 months ‚Ä¢ Mother: Meera Devi</p>
                                <p class="text-xs text-gray-500">Last visit: 3 days ago</p>
                            </div>
                            <button onclick="viewPatientRecord('anita-sharma')" class="px-4 py-2 bg-teal-600 text-white rounded-lg text-sm hover:bg-teal-700">View</button>
                        </div>
                    </div>
                </div>

                <!-- Add New Patient Button -->
                <button onclick="showPage('patient-registration')" class="fixed bottom-24 right-4 w-14 h-14 bg-teal-600 text-white rounded-full shadow-lg hover:bg-teal-700 flex items-center justify-center">
                    <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6v6m0 0v6m0-6h6m-6 0H6"/>
                    </svg>
                </button>
            </div>
        </div>

        <!-- Immunization Page -->
        <div id="immunization" class="page-content hidden pb-20">
            <div class="p-4">
                <div class="flex items-center mb-6">
                    <button onclick="showPage('dashboard')" class="mr-3 p-2 hover:bg-gray-100 rounded-lg">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"/>
                        </svg>
                    </button>
                    <h2 class="text-xl font-bold">Immunization Tracking</h2>
                </div>

                <!-- Immunization Stats -->
                <div class="grid grid-cols-2 gap-4 mb-6">
                    <div class="bg-white rounded-xl p-4 shadow-sm">
                        <p class="text-2xl font-bold text-green-600">87%</p>
                        <p class="text-sm text-gray-600">Coverage Rate</p>
                    </div>
                    <div class="bg-white rounded-xl p-4 shadow-sm">
                        <p class="text-2xl font-bold text-red-600">12</p>
                        <p class="text-sm text-gray-600">Overdue</p>
                    </div>
                </div>

                <!-- Due Vaccinations -->
                <div class="mb-6">
                    <h3 class="text-lg font-semibold mb-3">Due This Week</h3>
                    <div class="space-y-3">
                        <div class="bg-white rounded-xl p-4 shadow-sm border-l-4 border-yellow-500">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="font-semibold text-gray-900">Baby Anita - Measles</p>
                                    <p class="text-sm text-gray-600">Due: Tomorrow</p>
                                </div>
                                <button onclick="scheduleVaccination('anita-measles')" class="px-3 py-1 bg-yellow-600 text-white rounded text-sm hover:bg-yellow-700">Schedule</button>
                            </div>
                        </div>

                        <div class="bg-white rounded-xl p-4 shadow-sm border-l-4 border-red-500">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="font-semibold text-gray-900">Baby Raj - DPT-3</p>
                                    <p class="text-sm text-gray-600">Overdue: 5 days</p>
                                </div>
                                <button onclick="scheduleVaccination('raj-dpt3')" class="px-3 py-1 bg-red-600 text-white rounded text-sm hover:bg-red-700">Urgent</button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Vaccination History -->
                <div>
                    <h3 class="text-lg font-semibold mb-3">Recent Vaccinations</h3>
                    <div class="space-y-3">
                        <div class="bg-white rounded-xl p-4 shadow-sm">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="font-semibold text-gray-900">Baby Kavita - OPV-2</p>
                                    <p class="text-sm text-gray-600">Completed: 2 days ago</p>
                                </div>
                                <span class="px-3 py-1 bg-green-100 text-green-800 rounded-full text-sm">‚úÖ Done</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Maternal Health Page -->
        <div id="maternal-health" class="page-content hidden pb-20">
            <div class="p-4">
                <div class="flex items-center mb-6">
                    <button onclick="showPage('dashboard')" class="mr-3 p-2 hover:bg-gray-100 rounded-lg">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"/>
                        </svg>
                    </button>
                    <h2 class="text-xl font-bold">Maternal Health</h2>
                </div>

                <!-- ANC Stats -->
                <div class="grid grid-cols-2 gap-4 mb-6">
                    <div class="bg-white rounded-xl p-4 shadow-sm">
                        <p class="text-2xl font-bold text-blue-600">92%</p>
                        <p class="text-sm text-gray-600">ANC Coverage</p>
                    </div>
                    <div class="bg-white rounded-xl p-4 shadow-sm">
                        <p class="text-2xl font-bold text-red-600">5</p>
                        <p class="text-sm text-gray-600">High Risk</p>
                    </div>
                </div>

                <!-- Pregnant Women -->
                <div class="mb-6">
                    <h3 class="text-lg font-semibold mb-3">Active Pregnancies</h3>
                    <div class="space-y-3">
                        <div class="bg-white rounded-xl p-4 shadow-sm border-l-4 border-red-500">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="font-semibold text-gray-900">Sunita Devi</p>
                                    <p class="text-sm text-gray-600">28 weeks ‚Ä¢ High Risk: Anemia + BP</p>
                                </div>
                                <button onclick="viewMaternalRecord('sunita-devi')" class="px-3 py-1 bg-red-600 text-white rounded text-sm hover:bg-red-700">Review</button>
                            </div>
                        </div>

                        <div class="bg-white rounded-xl p-4 shadow-sm border-l-4 border-green-500">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="font-semibold text-gray-900">Priya Sharma</p>
                                    <p class="text-sm text-gray-600">20 weeks ‚Ä¢ Normal pregnancy</p>
                                </div>
                                <button onclick="viewMaternalRecord('priya-sharma')" class="px-3 py-1 bg-green-600 text-white rounded text-sm hover:bg-green-700">View</button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Recent Deliveries -->
                <div>
                    <h3 class="text-lg font-semibold mb-3">Recent Deliveries</h3>
                    <div class="space-y-3">
                        <div class="bg-white rounded-xl p-4 shadow-sm">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="font-semibold text-gray-900">Meera Devi</p>
                                    <p class="text-sm text-gray-600">Delivered: 3 days ago ‚Ä¢ PNC-1 due</p>
                                </div>
                                <button onclick="schedulePNC('meera-devi')" class="px-3 py-1 bg-blue-600 text-white rounded text-sm hover:bg-blue-700">Schedule PNC</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Work Planning Page -->
        <div id="work-planning" class="page-content hidden pb-20">
            <div class="p-4">
                <div class="flex items-center mb-6">
                    <button onclick="showPage('dashboard')" class="mr-3 p-2 hover:bg-gray-100 rounded-lg">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"/>
                        </svg>
                    </button>
                    <h2 class="text-xl font-bold">Reports & Planning</h2>
                </div>

                <!-- Quick Reports -->
                <div class="grid grid-cols-1 gap-4 mb-6">
                    <button onclick="generateReport('monthly')" class="bg-white rounded-xl p-4 shadow-sm text-left hover:shadow-md transition-shadow">
                        <div class="flex items-center justify-between">
                            <div>
                                <h3 class="font-semibold text-gray-900">Monthly Activity Report</h3>
                                <p class="text-sm text-gray-600">Generate comprehensive monthly report</p>
                            </div>
                            <svg class="w-5 h-5 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/>
                            </svg>
                        </div>
                    </button>

                    <button onclick="generateReport('immunization')" class="bg-white rounded-xl p-4 shadow-sm text-left hover:shadow-md transition-shadow">
                        <div class="flex items-center justify-between">
                            <div>
                                <h3 class="font-semibold text-gray-900">Immunization Coverage</h3>
                                <p class="text-sm text-gray-600">Track vaccination progress</p>
                            </div>
                            <svg class="w-5 h-5 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"/>
                            </svg>
                        </div>
                    </button>

                    <button onclick="generateReport('maternal')" class="bg-white rounded-xl p-4 shadow-sm text-left hover:shadow-md transition-shadow">
                        <div class="flex items-center justify-between">
                            <div>
                                <h3 class="font-semibold text-gray-900">Maternal Health Report</h3>
                                <p class="text-sm text-gray-600">ANC and PNC tracking</p>
                            </div>
                            <svg class="w-5 h-5 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"/>
                            </svg>
                        </div>
                    </button>
                </div>

                <!-- Recent Reports -->
                <div>
                    <h3 class="text-lg font-semibold mb-3">Recent Reports</h3>
                    <div class="space-y-3">
                        <div class="bg-white rounded-xl p-4 shadow-sm">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="font-semibold text-gray-900">October Monthly Report</p>
                                    <p class="text-sm text-gray-600">Generated: 2 days ago</p>
                                </div>
                                <button onclick="viewReport('oct-monthly')" class="px-3 py-1 bg-teal-600 text-white rounded text-sm hover:bg-teal-700">View</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- PHC Reports Page -->
        <div id="phc-reports" class="page-content hidden pb-20">
            <div class="p-4">
                <div class="flex items-center mb-6">
                    <button onclick="showPage('phc-dashboard')" class="mr-3 p-2 hover:bg-gray-100 rounded-lg">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"/>
                        </svg>
                    </button>
                    <h2 class="text-xl font-bold">PHC Reports</h2>
                </div>

                <!-- Report Generation Progress -->
                <div id="reportProgress" class="bg-white rounded-xl p-4 shadow-sm mb-6 hidden">
                    <div class="flex items-center justify-between mb-3">
                        <h3 class="font-semibold text-gray-900">Generating Report...</h3>
                        <span id="progressPercentage" class="text-sm text-gray-600">0%</span>
                    </div>
                    <div class="w-full bg-gray-200 rounded-full h-2 mb-3">
                        <div id="progressBar" class="bg-blue-600 h-2 rounded-full transition-all duration-300" style="width: 0%"></div>
                    </div>
                    <p id="progressStatus" class="text-sm text-gray-600">Initializing...</p>
                </div>

                <!-- Report Categories -->
                <div class="grid grid-cols-1 gap-4 mb-6">
                    <button onclick="generatePHCReport('consolidated')" class="report-btn bg-white rounded-xl p-4 shadow-sm text-left hover:shadow-md transition-shadow">
                        <div class="flex items-center justify-between">
                            <div>
                                <h3 class="font-semibold text-gray-900">üìä Consolidated Village Report</h3>
                                <p class="text-sm text-gray-600">All villages performance summary with health indicators</p>
                                <p class="text-xs text-blue-600 mt-1">Includes: Coverage rates, ASHA performance, village metrics</p>
                            </div>
                            <svg class="w-5 h-5 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"/>
                            </svg>
                        </div>
                    </button>

                    <button onclick="generatePHCReport('asha-performance')" class="report-btn bg-white rounded-xl p-4 shadow-sm text-left hover:shadow-md transition-shadow">
                        <div class="flex items-center justify-between">
                            <div>
                                <h3 class="font-semibold text-gray-900">üë©‚Äç‚öïÔ∏è ASHA Performance Report</h3>
                                <p class="text-sm text-gray-600">Individual ASHA worker metrics and achievements</p>
                                <p class="text-xs text-green-600 mt-1">Includes: Visit completion, task efficiency, training status</p>
                            </div>
                            <svg class="w-5 h-5 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z"/>
                            </svg>
                        </div>
                    </button>

                    <button onclick="generatePHCReport('health-indicators')" class="report-btn bg-white rounded-xl p-4 shadow-sm text-left hover:shadow-md transition-shadow">
                        <div class="flex items-center justify-between">
                            <div>
                                <h3 class="font-semibold text-gray-900">üíâ Health Indicators Report</h3>
                                <p class="text-sm text-gray-600">Immunization, ANC, PNC and health outcome metrics</p>
                                <p class="text-xs text-purple-600 mt-1">Includes: Vaccination coverage, maternal health, child nutrition</p>
                            </div>
                            <svg class="w-5 h-5 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"/>
                            </svg>
                        </div>
                    </button>

                    <button onclick="generatePHCReport('monthly-summary')" class="report-btn bg-white rounded-xl p-4 shadow-sm text-left hover:shadow-md transition-shadow">
                        <div class="flex items-center justify-between">
                            <div>
                                <h3 class="font-semibold text-gray-900">üìÖ Monthly Summary Report</h3>
                                <p class="text-sm text-gray-600">Comprehensive monthly activities and outcomes</p>
                                <p class="text-xs text-orange-600 mt-1">Includes: All activities, trends, recommendations</p>
                            </div>
                            <svg class="w-5 h-5 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"/>
                            </svg>
                        </div>
                    </button>
                </div>

                <!-- Recent PHC Reports -->
                <div>
                    <div class="flex items-center justify-between mb-3">
                        <h3 class="text-lg font-semibold">Recent Reports</h3>
                        <button onclick="clearReportHistory()" class="text-sm text-red-600 hover:text-red-700">Clear History</button>
                    </div>
                    <div id="recentReportsList" class="space-y-3">
                        <div class="bg-white rounded-xl p-4 shadow-sm">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="font-semibold text-gray-900">üìä October Consolidated Report</p>
                                    <p class="text-sm text-gray-600">Generated: 1 day ago ‚Ä¢ 12 villages ‚Ä¢ 18 ASHA workers</p>
                                    <p class="text-xs text-green-600">Status: Complete ‚Ä¢ Size: 2.4 MB</p>
                                </div>
                                <div class="flex space-x-2">
                                    <button onclick="viewPHCReport('oct-consolidated')" class="px-3 py-1 bg-blue-600 text-white rounded text-sm hover:bg-blue-700">View</button>
                                    <button onclick="downloadPHCReport('oct-consolidated')" class="px-3 py-1 bg-green-600 text-white rounded text-sm hover:bg-green-700">Download</button>
                                </div>
                            </div>
                        </div>

                        <div class="bg-white rounded-xl p-4 shadow-sm">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="font-semibold text-gray-900">üë©‚Äç‚öïÔ∏è September ASHA Performance</p>
                                    <p class="text-sm text-gray-600">Generated: 3 days ago ‚Ä¢ 18 workers evaluated</p>
                                    <p class="text-xs text-green-600">Status: Complete ‚Ä¢ Size: 1.8 MB</p>
                                </div>
                                <div class="flex space-x-2">
                                    <button onclick="viewPHCReport('sep-asha')" class="px-3 py-1 bg-blue-600 text-white rounded text-sm hover:bg-blue-700">View</button>
                                    <button onclick="downloadPHCReport('sep-asha')" class="px-3 py-1 bg-green-600 text-white rounded text-sm hover:bg-green-700">Download</button>
                                </div>
                            </div>
                        </div>

                        <div class="bg-white rounded-xl p-4 shadow-sm">
                            <div class="flex items-center justify-between">
                                <div>
                                    <p class="font-semibold text-gray-900">üíâ Q3 Health Indicators</p>
                                    <p class="text-sm text-gray-600">Generated: 1 week ago ‚Ä¢ Quarterly analysis</p>
                                    <p class="text-xs text-green-600">Status: Complete ‚Ä¢ Size: 3.1 MB</p>
                                </div>
                                <div class="flex space-x-2">
                                    <button onclick="viewPHCReport('q3-health')" class="px-3 py-1 bg-blue-600 text-white rounded text-sm hover:bg-blue-700">View</button>
                                    <button onclick="downloadPHCReport('q3-health')" class="px-3 py-1 bg-green-600 text-white rounded text-sm hover:bg-green-700">Download</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Patient Registration Page -->
        <div id="patient-registration" class="page-content hidden pb-20">
            <div class="p-4">
                <div class="flex items-center mb-6">
                    <button onclick="showPage('health-records')" class="mr-3 p-2 hover:bg-gray-100 rounded-lg">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"/>
                        </svg>
                    </button>
                    <h2 class="text-xl font-bold">Register New Patient</h2>
                </div>

                <!-- Registration Form -->
                <form onsubmit="registerPatient(event)" class="space-y-4">
                    <div class="bg-white rounded-xl p-4 shadow-sm">
                        <h3 class="font-semibold mb-4">Basic Information</h3>
                        <div class="space-y-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Full Name</label>
                                <input type="text" required class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-teal-500">
                            </div>
                            <div class="grid grid-cols-2 gap-4">
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">Age</label>
                                    <input type="number" required class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-teal-500">
                                </div>
                                <div>
                                    <label class="block text-sm font-medium text-gray-700 mb-1">Gender</label>
                                    <select required class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-teal-500">
                                        <option value="">Select</option>
                                        <option value="male">Male</option>
                                        <option value="female">Female</option>
                                    </select>
                                </div>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Village</label>
                                <select required class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-teal-500">
                                    <option value="">Select Village</option>
                                    <option value="rampur">Rampur</option>
                                    <option value="krishnapur">Krishnapur</option>
                                    <option value="govindpur">Govindpur</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <div class="bg-white rounded-xl p-4 shadow-sm">
                        <h3 class="font-semibold mb-4">Contact Information</h3>
                        <div class="space-y-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Mobile Number</label>
                                <input type="tel" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-teal-500">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Address</label>
                                <textarea rows="3" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-teal-500"></textarea>
                            </div>
                        </div>
                    </div>

                    <button type="submit" class="w-full px-4 py-3 bg-teal-600 text-white rounded-lg hover:bg-teal-700 font-semibold">
                        Register Patient
                    </button>
                </form>
            </div>
        </div>
    </main>

    <!-- Static Modals -->
    <div id="taskReviewModal" class="modal-backdrop" aria-hidden="true">
        <div class="modal-card">
            <div class="p-6 max-h-[80vh] overflow-y-auto">
                <div class="flex items-center justify-between mb-4">
                    <h2 class="text-xl font-bold">Task Review</h2>
                    <button onclick="hideModal('taskReviewModal')" class="p-2 hover:bg-gray-100 rounded-lg">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                        </svg>
                    </button>
                </div>
                <div id="taskReviewContent">
                    <!-- populated via populateTaskReviewModal() -->
                    <p class="text-gray-600">Loading tasks...</p>
                </div>
                <div class="mt-6 flex justify-end">
                    <button onclick="hideModal('taskReviewModal')" class="px-4 py-2 bg-gray-600 text-white rounded-lg hover:bg-gray-700">Close</button>
                </div>
            </div>
        </div>
    </div>

    <div id="errorLogsModal" class="modal-backdrop" aria-hidden="true">
        <div class="modal-card">
            <div class="p-6 max-h-[80vh] overflow-y-auto">
                <div class="flex items-center justify-between mb-4">
                    <h2 class="text-xl font-bold">Error Logs</h2>
                    <button onclick="hideModal('errorLogsModal')" class="p-2 hover:bg-gray-100 rounded-lg">
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                        </svg>
                    </button>
                </div>
                <div id="errorLogsContent">
                    <p class="text-gray-600">Loading logs...</p>
                </div>
                <div class="mt-6 flex justify-end">
                    <button onclick="hideModal('errorLogsModal')" class="px-4 py-2 bg-gray-600 text-white rounded-lg hover:bg-gray-700">Close</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Bottom Navigation (only show for dashboard and other pages, not homepage) -->
    <nav id="bottomNav" class="fixed bottom-0 left-0 right-0 bg-white border-t border-gray-200 px-4 py-2 hidden">
        <div class="flex justify-around" id="navContent">
            <!-- ASHA Navigation -->
            <div id="ashaNav" class="flex justify-around w-full">
                <button onclick="window.location.href='index2.html'" class="nav-item active flex flex-col items-center py-2 px-3 rounded-lg">
                    <svg class="w-5 h-5 mb-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 7v10a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2H5a2 2 0 00-2-2z"/>
                    </svg>
                    <span class="text-xs">Dashboard</span>
                </button>
                <button onclick="window.location.href='index2.html'" class="nav-item flex flex-col items-center py-2 px-3 rounded-lg">
                    <svg class="w-5 h-5 mb-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/>
                    </svg>
                    <span class="text-xs">Records</span>
                </button>
                <button onclick="window.location.href='index2.html'" class="nav-item flex flex-col items-center py-2 px-3 rounded-lg">
                    <svg class="w-5 h-5 mb-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19.428 15.428a2 2 0 00-1.022-.547l-2.387-.477a6 6 0 00-3.86.517l-.318.158a6 6 0 01-3.86.517L6.05 15.21a2 2 0 00-1.806.547M8 4h8l-1 1v5.172a2 2 0 00.586 1.414l5 5c1.26 1.26.367 3.414-1.415 3.414H4.828c-1.782 0-2.674-2.154-1.414-3.414l5-5A2 2 0 009 10.172V5L8 4z"/>
                    </svg>
                    <span class="text-xs">Vaccines</span>
                </button>
                <button onclick="window.location.href='index2.html'" class="nav-item flex flex-col items-center py-2 px-3 rounded-lg">
                    <svg class="w-5 h-5 mb-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4.318 6.318a4.5 4.5 0 000 6.364L12 20.364l7.682-7.682a4.5 4.5 0 00-6.364-6.364L12 7.636l-1.318-1.318a4.5 4.5 0 00-6.364 0z"/>
                    </svg>
                    <span class="text-xs">Maternal</span>
                </button>
                <button onclick="window.location.href='index2.html'" class="nav-item flex flex-col items-center py-2 px-3 rounded-lg">
                    <svg class="w-5 h-5 mb-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"/>
                    </svg>
                    <span class="text-xs">Reports</span>
                </button>
            </div>

            <!-- PHC Navigation -->
            <div id="phcNav" class="flex justify-around w-full hidden">
                <button onclick="showPage('phc-dashboard')" class="nav-item active flex flex-col items-center py-2 px-3 rounded-lg">
                    <svg class="w-5 h-5 mb-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 7v10a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2H5a2 2 0 00-2-2z"/>
                    </svg>
                    <span class="text-xs">Overview</span>
                </button>
                <button onclick="showPage('phc-villages')" class="nav-item flex flex-col items-center py-2 px-3 rounded-lg">
                    <svg class="w-5 h-5 mb-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 21V5a2 2 0 00-2-2H7a2 2 0 00-2 2v16m14 0h2m-2 0h-5m-9 0H3m2 0h5M9 7h1m-1 4h1m4-4h1m-1 4h1m-5 10v-5a1 1 0 011-1h2a1 1 0 011 1v5m-4 0h4"/>
                    </svg>
                    <span class="text-xs">Villages</span>
                </button>
                <button onclick="showPage('phc-reports')" class="nav-item flex flex-col items-center py-2 px-3 rounded-lg">
                    <svg class="w-5 h-5 mb-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 19v-6a2 2 0 00-2-2H5a2 2 0 00-2 2v6a2 2 0 002 2h2a2 2 0 002-2zm0 0V9a2 2 0 012-2h2a2 2 0 012 2v10m-6 0a2 2 0 002 2h2a2 2 0 002-2m0 0V5a2 2 0 012-2h2a2 2 0 012 2v14a2 2 0 01-2 2h-2a2 2 0 01-2-2z"/>
                    </svg>
                    <span class="text-xs">Reports</span>
                </button>
                <button onclick="showPage('phc-alerts')" class="nav-item flex flex-col items-center py-2 px-3 rounded-lg">
                    <svg class="w-5 h-5 mb-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"/>
                    </svg>
                    <span class="text-xs">Alerts</span>
                </button>
                <button onclick="showPage('phc-sync')" class="nav-item flex flex-col items-center py-2 px-3 rounded-lg">
                    <svg class="w-5 h-5 mb-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"/>
                    </svg>
                    <span class="text-xs">Sync</span>
                </button>
            </div>
        </div>
    </nav>

    <!-- Notification Toast -->
    <div id="notification" class="notification">
        <span id="notificationText"></span>
    </div>

    <script>
    // Global state
    let currentPage = 'homepage';
    let isOnline = true;
    let phcIsOnline = true; // PHC-specific connectivity state
    let currentVoiceField = null;
    let patients = [];
    let currentLanguage = 'en';
    let currentTaskId = null;
    let currentPatientId = null;
        
        // Sample patient data
        const samplePatients = [
            {
                id: 'raj-kumar',
                name: 'Baby Raj Kumar',
                type: 'child',
                age: '4 months',
                village: 'rampur',
                status: 'overdue',
                priority: 'high',
                details: 'DPT-3 overdue by 5 days',
                birthWeight: 2.8,
                motherName: 'Sunita Devi',
                vaccines: ['BCG', 'OPV-1', 'DPT-1', 'OPV-2', 'DPT-2'],
                nextVaccine: 'DPT-3, OPV-3',
                daysOverdue: 5
            },
            {
                id: 'anita-sharma',
                name: 'Baby Anita Sharma',
                type: 'child',
                age: '9 months',
                village: 'krishnapur',
                status: 'due',
                priority: 'medium',
                details: 'Measles vaccine due in 2 days',
                birthWeight: 3.2,
                motherName: 'Priya Sharma',
                vaccines: ['BCG', 'OPV-1', 'DPT-1', 'OPV-2', 'DPT-2', 'OPV-3', 'DPT-3'],
                nextVaccine: 'Measles',
                daysDue: 2
            }
        ];

        // Initialize app
        document.addEventListener('DOMContentLoaded', function() {
            patients = [...samplePatients];
            showPage('homepage');
            updateSyncStatus();
            populateAllContent();

            // attach global connectivity handlers
            const phcToggle = document.getElementById('phcConnectivityToggle');
            if (phcToggle) phcToggle.addEventListener('click', function() {
                phcIsOnline = !phcIsOnline;
                const dot = document.getElementById('phcConnectivityDot');
                const text = document.getElementById('phcConnectivityText');
                const phcSyncStatus = document.getElementById('phcSyncStatus');

                if (phcIsOnline) {
                    if (dot) dot.className = 'connectivity-dot connectivity-online';
                    if (text) text.textContent = 'Online';
                    if (phcSyncStatus) phcSyncStatus.style.opacity = '1';
                    showNotification('PHC is online. Sync functions available.', 'success');
                } else {
                    if (dot) dot.className = 'connectivity-dot connectivity-offline';
                    if (text) text.textContent = 'Offline';
                    if (phcSyncStatus) phcSyncStatus.style.opacity = '0.6';
                    showNotification('PHC is offline. Some features are limited.', 'warning');
                }
            });

            // initialize connectivity UI
            updateConnectivityStatus();
        });

        // Navigation functions
        function showPage(pageId) {
            // Hide all pages
            document.querySelectorAll('.page-content').forEach(page => {
                page.classList.add('hidden');
            });
            
            // Show selected page
            document.getElementById(pageId).classList.remove('hidden');
            
            // Show/hide bottom navigation and switch nav type
            const bottomNav = document.getElementById('bottomNav');
            const ashaNav = document.getElementById('ashaNav');
            const phcNav = document.getElementById('phcNav');
            
            if (pageId === 'homepage') {
                bottomNav.classList.add('hidden');
            } else {
                bottomNav.classList.remove('hidden');
                
                // Switch navigation based on page type
                if (pageId.startsWith('phc-')) {
                    ashaNav.classList.add('hidden');
                    phcNav.classList.remove('hidden');
                } else {
                    ashaNav.classList.remove('hidden');
                    phcNav.classList.add('hidden');
                }
            }
            
            // Update navigation only if not homepage
            if (pageId !== 'homepage') {
                document.querySelectorAll('.nav-item').forEach(item => {
                    item.classList.remove('active');
                });
                
                // Find and activate the corresponding nav item
                let navItems, pageIndex;
                
                if (pageId.startsWith('phc-')) {
                    navItems = phcNav.querySelectorAll('.nav-item');
                    pageIndex = ['phc-dashboard', 'phc-villages', 'phc-reports', 'phc-alerts', 'phc-sync'].indexOf(pageId);
                } else {
                    navItems = ashaNav.querySelectorAll('.nav-item');
                    pageIndex = ['dashboard', 'health-records', 'immunization', 'maternal-health', 'work-planning'].indexOf(pageId);
                }
                
                if (pageIndex !== -1 && navItems[pageIndex]) {
                    navItems[pageIndex].classList.add('active');
                }
            }
            
            currentPage = pageId;
        }

        // Homepage functions
        function showHomepage() {
            showPage('homepage');
        }

        function showPHCWorker() {
            showPage('phc-dashboard');
        }

        function showASHADashboard() {
            // Redirect to the ASHA-focused UI implemented in index2.html
            // This keeps the index2 layout/behaviour intact instead of duplicating it here.
            window.location.href = 'index2.html';
        }

        // Dashboard functions
        function populateAllContent() {
            populatePriorityTasks();
            updateDashboardStats();
        }

        function populatePriorityTasks() {
            const tasksList = document.getElementById('priorityTasksList');
            if (!tasksList) return;
            
            const highPriorityPatients = patients.filter(p => p.priority === 'high').slice(0, 3);
            
            tasksList.innerHTML = '';
            
            highPriorityPatients.forEach(patient => {
                const taskDiv = document.createElement('div');
                taskDiv.className = `bg-white rounded-xl p-3 sm:p-4 shadow-sm priority-${patient.priority} cursor-pointer hover:shadow-md transition-shadow`;
                taskDiv.onclick = () => showTaskDetails(patient.id);
                
                taskDiv.innerHTML = `
                    <div class="flex items-center justify-between">
                        <div class="flex-1 min-w-0">
                            <p class="font-semibold text-gray-900 text-sm sm:text-base truncate">${patient.name}</p>
                            <p class="text-xs sm:text-sm text-gray-600 truncate">${patient.details}</p>
                            <p class="text-xs text-red-600 mt-1">High Priority</p>
                        </div>
                        <div class="w-6 h-6 sm:w-8 sm:h-8 bg-red-100 rounded-full flex items-center justify-center ml-2 flex-shrink-0">
                            <span class="text-red-600 text-xs sm:text-sm">${patient.type === 'child' ? 'üíâ' : 'ü§±'}</span>
                        </div>
                    </div>
                `;
                
                tasksList.appendChild(taskDiv);
            });
        }

        function updateDashboardStats() {
            const todayVisitsElement = document.getElementById('todayVisitsCount');
            const pendingTasksElement = document.getElementById('pendingTasksCount');
            
            if (todayVisitsElement) todayVisitsElement.textContent = '2/8';
            if (pendingTasksElement) pendingTasksElement.textContent = '6';
        }

        function showTodaysVisits() {
            showPage('todays-work-plan');
        }

        function showPendingTasks() {
            showPage('pending-tasks');
        }

        // Task management functions
        function filterTasks(filter) {
            // Update filter buttons
            document.querySelectorAll('.task-filter-btn').forEach(btn => {
                btn.className = 'task-filter-btn px-4 py-2 bg-gray-200 text-gray-700 rounded-full text-sm whitespace-nowrap';
            });
            event.target.className = 'task-filter-btn active px-4 py-2 bg-teal-600 text-white rounded-full text-sm whitespace-nowrap';
            
            // Show/hide tasks based on filter
            const tasks = document.querySelectorAll('.task-item');
            tasks.forEach(task => {
                if (filter === 'all') {
                    task.style.display = 'block';
                } else {
                    if (task.classList.contains(filter)) {
                        task.style.display = 'block';
                    } else {
                        task.style.display = 'none';
                    }
                }
            });
        }

        function completeTask(taskId, evt) {
            // Update task count
            const currentCount = parseInt(document.getElementById('pendingTasksCount').textContent);
            document.getElementById('pendingTasksCount').textContent = currentCount - 1;
            
            // Remove task from list (use event if available)
            if (evt && evt.target) {
                const item = evt.target.closest('.task-item');
                if (item) item.remove();
            } else {
                // fallback: remove by id if present
                const el = document.querySelector(`.task-item[data-id="${taskId}"]`);
                if (el) el.remove();
            }
            
            showNotification('Task completed successfully!', 'success');
        }

        function scheduleTask(taskId) {
            showNotification('Task scheduled for tomorrow', 'success');
        }

        function startVillageVisits(village) {
            showNotification(`Starting visits in ${village.charAt(0).toUpperCase() + village.slice(1)} village`, 'success');
        }

        // Utility functions
        function showNotification(message, type = 'success') {
            const notification = document.getElementById('notification');
            const notificationText = document.getElementById('notificationText');
            
            notificationText.textContent = message;
            notification.className = `notification ${type}`;
            notification.classList.add('show');
            
            setTimeout(() => {
                notification.classList.remove('show');
            }, 3000);
        }

        function showTaskDetails(taskId) {
            // Placeholder for task details modal
            showNotification('Task details feature coming soon!', 'warning');
        }

        function showOCRScanner() {
            showNotification('OCR Scanner feature coming soon!', 'warning');
        }

        function showNotifications() {
            showNotification('Notifications panel coming soon!', 'warning');
        }

        function updateSyncStatus() {
            // Placeholder for sync status updates
        }

        // Connectivity toggle
        document.addEventListener('DOMContentLoaded', function() {
            const connectivityToggle = document.getElementById('connectivityToggle');
            if (connectivityToggle) {
                connectivityToggle.addEventListener('click', function() {
                    isOnline = !isOnline;
                    updateConnectivityStatus();
                    showNotification(isOnline ? 'Connected to internet' : 'Working offline', isOnline ? 'success' : 'warning');
                });
            }
        });

        function updateConnectivityStatus() {
            const dot = document.getElementById('connectivityDot');
            const text = document.getElementById('connectivityText');
            
            if (dot && text) {
                if (isOnline) {
                    dot.className = 'w-2 h-2 bg-green-400 rounded-full pulse-dot';
                    text.textContent = 'Online';
                } else {
                    dot.className = 'w-2 h-2 bg-red-400 rounded-full';
                    text.textContent = 'Offline';
                }
            }

            // PHC connectivity is handled by a global handler (initialized on DOMContentLoaded)
        }

        // PHC Functions
        function showTaskReview() {
            // Robust modal open: avoid relying on external helpers
            try {
                const modal = document.getElementById('taskReviewModal');
                if (!modal) throw new Error('Task Review modal missing');

                // activate and animate
                modal.classList.add('active');
                // allow layout, then add show class for animation
                requestAnimationFrame(() => modal.classList.add('show'));
                // lock background scroll while modal open
                document.body.style.overflow = 'hidden';

                // small delay so modal DOM is visible before we populate content
                setTimeout(() => {
                    try {
                        populateTaskReviewModal();
                    } catch (err) {
                        console.error('populateTaskReviewModal error:', err);
                        showNotification('Error loading task review content', 'error');
                    }
                }, 80);
            } catch (err) {
                console.error('showTaskReview error:', err);
                showNotification('Unable to open task review', 'error');
            }
        }

        // Generic modal helpers (work with static .modal-backdrop elements)
        function showModal(modalId) {
            const modal = document.getElementById(modalId);
            if (!modal) return;
            modal.classList.add('active');
            requestAnimationFrame(() => modal.classList.add('show'));
            document.body.style.overflow = 'hidden';
        }

        function hideModal(modalId) {
            const modal = document.getElementById(modalId);
            if (!modal) return;
            modal.classList.remove('show');
            // wait for animation to finish then hide
            setTimeout(() => {
                modal.classList.remove('active');
                // restore scrolling if no other modal active
                const anyActive = document.querySelectorAll('.modal-backdrop.active').length > 0;
                if (!anyActive) document.body.style.overflow = '';
            }, 320);
        }

        // Show Error Logs modal and populate content
        function showErrorLogs() {
            try {
                populateErrorLogsModal();
                showModal('errorLogsModal');
            } catch (err) {
                console.error('showErrorLogs error:', err);
                showNotification('Unable to open error logs', 'error');
            }
        }

        function populateErrorLogsModal() {
            const container = document.getElementById('errorLogsContent');
            if (!container) return;
            // Example: gather logs from a global `errorLogs` array or synthesize sample entries
            const logs = window.errorLogs || [
                { id: 'sync-1', level: 'error', msg: 'Failed to sync patient Raj Kumar', time: '15 min ago' },
                { id: 'val-7', level: 'warning', msg: 'Form validation failed: missing weight', time: '2 hours ago' },
            ];

            if (logs.length === 0) {
                container.innerHTML = '<p class="text-sm text-gray-600">No logs found</p>';
                return;
            }

            const list = document.createElement('div');
            list.className = 'space-y-3';
            logs.forEach(l => {
                const row = document.createElement('div');
                row.className = 'bg-white rounded-xl p-3 shadow-sm flex items-start justify-between';
                row.innerHTML = `
                    <div>
                        <p class="font-medium text-sm">${escapeHtml(l.msg)}</p>
                        <p class="text-xs text-gray-500">${escapeHtml(l.time)} ‚Ä¢ ${escapeHtml(l.level)}</p>
                    </div>
                    <div class="text-sm text-gray-400">${escapeHtml(l.id)}</div>
                `;
                list.appendChild(row);
            });
            container.innerHTML = '';
            container.appendChild(list);
        }

        // Open Task Review modal and show only high-priority tasks
        function openHighPriorityTasks() {
            try {
                // populateTaskReviewModal should be able to filter but we'll pass a flag via a temp global
                window.__showHighPriorityOnly = true;
                populateTaskReviewModal();
                showModal('taskReviewModal');
                // cleanup after a tick
                setTimeout(() => { delete window.__showHighPriorityOnly; }, 1000);
            } catch (err) {
                console.error('openHighPriorityTasks error:', err);
                showNotification('Unable to open high priority tasks', 'error');
            }
        }

        // small helper to escape html in log messages
        function escapeHtml(str) {
            return String(str).replace(/[&<>"']/g, function (s) {
                return ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'})[s];
            });
        }

        // Populate Task Review modal content
        function populateTaskReviewModal() {
            const container = document.getElementById('taskReviewContent');
            if (!container) throw new Error('taskReviewContent container not found');

            // Example: build a list of pending/high priority tasks from in-memory data
            const tasks = [];
            // Gather from sample patients and from pending tasks list in DOM
            (patients || []).forEach(p => {
                if (p.priority === 'high' || p.status === 'overdue') {
                    tasks.push({ id: p.id, title: p.name, details: p.details || p.nextVaccine || '', priority: p.priority || 'high' });
                }
            });

            // If no tasks found, build from DOM pending tasks as fallback
            if (!tasks.length) {
                document.querySelectorAll('#pendingTasksList .task-item').forEach((el, idx) => {
                    const title = el.querySelector('.font-semibold') ? el.querySelector('.font-semibold').textContent : `Task ${idx+1}`;
                    const desc = el.querySelector('.text-sm') ? el.querySelector('.text-sm').textContent : '';
                    tasks.push({ id: `t-${idx}`, title, details: desc, priority: 'medium' });
                });
            }

            // If requested, filter to only high priority tasks
            if (window.__showHighPriorityOnly) {
                const filtered = tasks.filter(t => (t.priority && t.priority.toLowerCase() === 'high') || (t.details && /overdue/i.test(t.details)));
                if (filtered.length) tasks.length = 0, filtered.forEach(x=>tasks.push(x));
                // leave the flag in place for a short time; caller may delete it
            }

            // Render content
            if (!tasks.length) {
                container.innerHTML = '<p class="text-gray-600">No tasks to review.</p>';
                return;
            }

            const html = tasks.map(t => `
                <div class="bg-gray-50 p-3 rounded-lg mb-3">
                    <div class="flex items-start justify-between gap-4">
                        <div class="flex-1 min-w-0">
                            <p class="font-semibold text-gray-900 truncate">${t.title}</p>
                            <p class="text-sm text-gray-600 truncate">${t.details}</p>
                        </div>
                        <div class="text-right">
                            <p class="text-xs text-gray-500">Priority</p>
                            <p class="font-semibold text-sm">${t.priority}</p>
                        </div>
                    </div>
                    <div class="mt-3 flex items-center justify-end space-x-2">
                        <button onclick="hideModal('taskReviewModal')" class="px-3 py-1 bg-gray-600 text-white rounded text-xs">Close</button>
                        <button onclick="assignAlert('${t.id}')" class="px-3 py-1 bg-blue-600 text-white rounded text-xs">Assign</button>
                        <button onclick="resolveAlertFromModal('${t.id}')" class="px-3 py-1 bg-green-600 text-white rounded text-xs">Resolve</button>
                    </div>
                </div>
            `).join('');

            container.innerHTML = html;
        }
 

        function syncASHA(ashaId) {
            const syncButton = event.target;
            const ashaCard = syncButton.closest('.bg-white');
            const statusElement = ashaCard.querySelector('.px-3.py-1');
            const timeElement = ashaCard.querySelector('.text-sm.text-gray-600');
            const ashaName = ashaCard.querySelector('.font-semibold').textContent.split(' - ')[0];
            
            // Show spinning icon
            syncButton.innerHTML = '<svg class="w-4 h-4 animate-spin" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"/></svg>';
            
            // Update status to syncing
            statusElement.className = 'px-3 py-1 bg-yellow-100 text-yellow-800 rounded-full text-sm';
            statusElement.textContent = 'Syncing...';
            
            showNotification(`Syncing data for ${ashaName}...`, 'success');
            
            // Simulate sync process with realistic steps
            const syncSteps = [
                `Connecting to ${ashaName}'s device...`,
                `Downloading patient records...`,
                `Syncing vaccination data...`,
                `Updating visit logs...`,
                `Finalizing sync for ${ashaName}...`
            ];
            
            let stepIndex = 0;
            const stepInterval = setInterval(() => {
                if (stepIndex < syncSteps.length) {
                    showNotification(syncSteps[stepIndex], 'success');
                    stepIndex++;
                } else {
                    clearInterval(stepInterval);
                    
                    // Complete sync
                    syncButton.innerHTML = '<svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"/></svg>';
                    
                    // Update status to synced
                    statusElement.className = 'px-3 py-1 bg-green-100 text-green-800 rounded-full text-sm';
                    statusElement.textContent = 'Synced';
                    
                    // Update last sync time
                    timeElement.textContent = 'Last sync: Just now';
                    
                    // Generate random number of synced records
                    const recordCount = Math.floor(Math.random() * 50) + 15;
                    showNotification(`${ashaName} data synchronized! ${recordCount} records updated.`, 'success');
                    
                    // Update sync counters
                    updateSyncCounters();
                }
            }, 600);
        }

        function updateAllDashboardMetrics() {
            // 1. PHC Dashboard Main Metrics
            const phcMetrics = document.querySelectorAll('#phc-dashboard .text-2xl.font-bold');
            if (phcMetrics.length >= 4) {
                phcMetrics[0].textContent = '12'; // Villages
                phcMetrics[1].textContent = '18'; // ASHA Workers  
                phcMetrics[2].textContent = '251'; // Active Cases (updated)
                phcMetrics[3].textContent = '19'; // High Priority (updated)
            }
            
            // 2. Task Review Counts
            const taskCounts = document.querySelectorAll('#phc-dashboard .text-xl.font-bold');
            if (taskCounts.length >= 4) {
                taskCounts[0].textContent = '5'; // High Priority (reduced)
                taskCounts[1].textContent = '12'; // Medium Priority (reduced)
                taskCounts[2].textContent = '28'; // Low Priority (reduced)
                taskCounts[3].textContent = '206'; // Completed (increased)
            }
            
            // 3. Performance Overview Percentages
            const performanceElements = document.querySelectorAll('#phc-dashboard .text-2xl.font-bold');
            const immunizationElement = document.querySelector('#phc-dashboard .from-green-500 .text-2xl');
            const ancElement = document.querySelector('#phc-dashboard .from-blue-500 .text-2xl');
            const highRiskElement = document.querySelector('#phc-dashboard .from-purple-500 .text-2xl');
            
            if (immunizationElement) immunizationElement.textContent = '89%'; // Improved
            if (ancElement) ancElement.textContent = '94%'; // Improved
            if (highRiskElement) highRiskElement.textContent = '19'; // Reduced
            
            // 4. System Status - Clear errors after sync
            const errorElements = document.querySelectorAll('#phc-dashboard .bg-red-50 .font-semibold');
            errorElements.forEach(element => {
                if (element.textContent.includes('Sync Errors')) {
                    element.nextElementSibling.textContent = '0 pending';
                    element.closest('.bg-red-50').className = 'flex items-center justify-between p-3 bg-green-50 rounded-lg';
                    element.className = 'font-semibold text-green-800';
                    element.textContent = 'Sync Status';
                }
            });
        }
        
        function updateVillageStatusAfterSync() {
            // Update Villages Page Status
            const villageCards = document.querySelectorAll('#phc-villages .bg-white');
            villageCards.forEach(card => {
                const statusBadge = card.querySelector('.px-3.py-1');
                const pendingTasks = card.querySelector('.text-sm.text-gray-600');
                const lastSync = card.querySelector('.text-sm.text-gray-600');
                
                // Improve village status after sync
                if (statusBadge) {
                    if (statusBadge.textContent === 'Critical') {
                        statusBadge.className = 'px-3 py-1 bg-yellow-100 text-yellow-800 rounded-full text-sm';
                        statusBadge.textContent = 'Needs Attention';
                        card.className = card.className.replace('border-red-500', 'border-yellow-500');
                    } else if (statusBadge.textContent === 'Needs Attention') {
                        statusBadge.className = 'px-3 py-1 bg-green-100 text-green-800 rounded-full text-sm';
                        statusBadge.textContent = 'Active';
                        card.className = card.className.replace('border-yellow-500', 'border-green-500');
                    }
                }
                
                // Update pending tasks and sync time
                if (pendingTasks && pendingTasks.textContent.includes('Pending Tasks:')) {
                    const currentTasks = parseInt(pendingTasks.textContent.match(/\d+/)[0]);
                    const newTasks = Math.max(0, currentTasks - Math.floor(Math.random() * 5) - 2);
                    pendingTasks.textContent = pendingTasks.textContent.replace(/Pending Tasks: \d+/, `Pending Tasks: ${newTasks}`);
                    pendingTasks.textContent = pendingTasks.textContent.replace(/Last Sync: .+/, 'Last Sync: Just now');
                }
                
                // Update coverage percentages
                const progressBars = card.querySelectorAll('.h-2.rounded-full');
                progressBars.forEach(bar => {
                    const currentWidth = parseInt(bar.style.width) || 70;
                    const newWidth = Math.min(95, currentWidth + Math.floor(Math.random() * 10) + 3);
                    bar.style.width = newWidth + '%';
                    
                    // Update percentage text
                    const percentText = bar.parentElement.nextElementSibling;
                    if (percentText) {
                        percentText.textContent = newWidth + '%';
                    }
                });
            });
        }
        
        function updateAlertCountsAfterSync() {
            // Reduce alert counts after successful sync
            const criticalCount = document.getElementById('criticalAlertsCount');
            const warningCount = document.getElementById('warningAlertsCount');
            const infoCount = document.getElementById('infoAlertsCount');
            const resolvedCount = document.getElementById('resolvedAlertsCount');
            
            if (criticalCount) {
                const current = parseInt(criticalCount.textContent);
                const reduced = Math.max(2, current - 3);
                criticalCount.textContent = reduced;
            }
            
            if (warningCount) {
                const current = parseInt(warningCount.textContent);
                const reduced = Math.max(5, current - 5);
                warningCount.textContent = reduced;
            }
            
            if (infoCount) {
                const current = parseInt(infoCount.textContent);
                const reduced = Math.max(8, current - 8);
                infoCount.textContent = reduced;
            }
            
            if (resolvedCount) {
                const current = parseInt(resolvedCount.textContent);
                const increased = current + 16; // Add resolved alerts
                resolvedCount.textContent = increased;
            }
        }
        
        function showSyncResultsModal() {
            const modal = document.createElement('div');
            modal.className = 'modal active';
            modal.innerHTML = `
                <div class="bg-white rounded-xl p-6 max-w-4xl max-h-[80vh] overflow-y-auto m-4">
                    <div class="flex items-center justify-between mb-6">
                        <div class="flex items-center space-x-3">
                            <div class="w-12 h-12 bg-green-100 rounded-full flex items-center justify-center">
                                <svg class="w-6 h-6 text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/>
                                </svg>
                            </div>
                            <div>
                                <h2 class="text-xl font-bold text-gray-900">Sync Completed Successfully!</h2>
                                <p class="text-sm text-gray-600">All ASHA data has been synchronized</p>
                            </div>
                        </div>
                        <button onclick="this.closest('.modal').remove()" class="p-2 hover:bg-gray-100 rounded-lg">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                            </svg>
                        </button>
                    </div>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
                        <div class="bg-blue-50 p-4 rounded-lg">
                            <h3 class="font-semibold text-blue-800 mb-3">üìä Data Summary</h3>
                            <div class="space-y-2 text-sm">
                                <div class="flex justify-between">
                                    <span class="text-blue-700">Patient Records:</span>
                                    <span class="font-medium text-blue-900">247 updated</span>
                                </div>
                                <div class="flex justify-between">
                                    <span class="text-blue-700">Vaccination Records:</span>
                                    <span class="font-medium text-blue-900">89 updated</span>
                                </div>
                                <div class="flex justify-between">
                                    <span class="text-blue-700">ANC Records:</span>
                                    <span class="font-medium text-blue-900">34 updated</span>
                                </div>
                                <div class="flex justify-between">
                                    <span class="text-blue-700">Visit Logs:</span>
                                    <span class="font-medium text-blue-900">156 updated</span>
                                </div>
                            </div>
                        </div>
                        
                        <div class="bg-green-50 p-4 rounded-lg">
                            <h3 class="font-semibold text-green-800 mb-3">‚úÖ Improvements</h3>
                            <div class="space-y-2 text-sm">
                                <div class="flex justify-between">
                                    <span class="text-green-700">Immunization Coverage:</span>
                                    <span class="font-medium text-green-900">87% ‚Üí 89%</span>
                                </div>
                                <div class="flex justify-between">
                                    <span class="text-green-700">ANC Coverage:</span>
                                    <span class="font-medium text-green-900">92% ‚Üí 94%</span>
                                </div>
                                <div class="flex justify-between">
                                    <span class="text-green-700">Pending Tasks:</span>
                                    <span class="font-medium text-green-900">45 ‚Üí 23</span>
                                </div>
                                <div class="flex justify-between">
                                    <span class="text-green-700">Critical Alerts:</span>
                                    <span class="font-medium text-green-900">8 ‚Üí 5</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="bg-yellow-50 p-4 rounded-lg mb-6">
                        <h3 class="font-semibold text-yellow-800 mb-3">üèòÔ∏è Village Status Updates</h3>
                        <div class="grid grid-cols-1 md:grid-cols-3 gap-4 text-sm">
                            <div>
                                <p class="font-medium text-yellow-900">Rampur Village</p>
                                <p class="text-yellow-700">Status: Active ‚úÖ</p>
                                <p class="text-yellow-700">Coverage: 92% ‚Üí 95%</p>
                            </div>
                            <div>
                                <p class="font-medium text-yellow-900">Krishnapur Village</p>
                                <p class="text-yellow-700">Status: Improved ‚¨ÜÔ∏è</p>
                                <p class="text-yellow-700">Coverage: 76% ‚Üí 82%</p>
                            </div>
                            <div>
                                <p class="font-medium text-yellow-900">Govindpur Village</p>
                                <p class="text-yellow-700">Status: Needs Attention ‚ö†Ô∏è</p>
                                <p class="text-yellow-700">Coverage: 68% ‚Üí 74%</p>
                            </div>
                        </div>
                    </div>
                    
                    <div class="bg-purple-50 p-4 rounded-lg mb-6">
                        <h3 class="font-semibold text-purple-800 mb-3">üë©‚Äç‚öïÔ∏è ASHA Worker Performance</h3>
                        <div class="space-y-2 text-sm">
                            <div class="flex justify-between items-center">
                                <span class="text-purple-700">Sunita Devi (Rampur):</span>
                                <span class="px-2 py-1 bg-green-100 text-green-800 rounded text-xs">Excellent - 95% completion</span>
                            </div>
                            <div class="flex justify-between items-center">
                                <span class="text-purple-700">Priya Sharma (Krishnapur):</span>
                                <span class="px-2 py-1 bg-blue-100 text-blue-800 rounded text-xs">Good - 85% completion</span>
                            </div>
                            <div class="flex justify-between items-center">
                                <span class="text-purple-700">Meera Devi (Govindpur):</span>
                                <span class="px-2 py-1 bg-yellow-100 text-yellow-800 rounded text-xs">Improving - 78% completion</span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="bg-gray-50 p-4 rounded-lg">
                        <h3 class="font-semibold text-gray-800 mb-3">üìà Next Steps</h3>
                        <ul class="text-sm text-gray-700 space-y-1">
                            <li>‚Ä¢ Continue monitoring Govindpur village progress</li>
                            <li>‚Ä¢ Schedule follow-up for 5 remaining high-risk cases</li>
                            <li>‚Ä¢ Conduct refresher training for underperforming areas</li>
                            <li>‚Ä¢ Next auto-sync scheduled in 24 hours</li>
                        </ul>
                    </div>
                    
                    <div class="mt-6 flex justify-end space-x-3">
                        <button onclick="this.closest('.modal').remove()" class="px-4 py-2 bg-gray-600 text-white rounded-lg hover:bg-gray-700">Close</button>
                        <button onclick="generateSyncReport()" class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700">Generate Report</button>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
        }
        
        function generateSyncReport() {
            showNotification('Generating sync report...', 'success');
            
            setTimeout(() => {
                const reportData = `SYNC REPORT - ${new Date().toLocaleString()}
=====================================

SUMMARY:
- Total Records Synced: 247
- ASHA Workers: 18/18 synced
- Villages Updated: 12/12
- Sync Duration: 4.2 seconds

IMPROVEMENTS:
- Immunization Coverage: 87% ‚Üí 89% (+2%)
- ANC Coverage: 92% ‚Üí 94% (+2%)
- Pending Tasks Reduced: 45 ‚Üí 23 (-22)
- Critical Alerts Resolved: 8 ‚Üí 5 (-3)

VILLAGE STATUS:
- Rampur: Excellent (95% coverage)
- Krishnapur: Good (82% coverage) 
- Govindpur: Needs Attention (74% coverage)

RECOMMENDATIONS:
- Focus support on Govindpur village
- Continue monitoring high-risk pregnancies
- Schedule training for underperforming areas
`;
                
                const blob = new Blob([reportData], { type: 'text/plain' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `Sync_Report_${new Date().toISOString().split('T')[0]}.txt`;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
                
                showNotification('Sync report downloaded!', 'success');
            }, 1500);
        }

        function updateSyncCounters() {
            // Update the sync overview counters
            const syncedElement = document.querySelector('#phc-sync .text-green-600');
            const pendingElement = document.querySelector('#phc-sync .text-yellow-600');
            
            if (syncedElement) {
                const currentSynced = parseInt(syncedElement.textContent) || 0;
                syncedElement.textContent = Math.min(18, currentSynced + 1);
            }
            
            if (pendingElement) {
                const currentPending = parseInt(pendingElement.textContent) || 0;
                pendingElement.textContent = Math.max(0, currentPending - 1);
            }
        }

        function reviewAlert(alertId) {
            const button = event.target;
            const originalText = button.textContent;
            
            button.textContent = 'Reviewing...';
            button.disabled = true;
            
            showNotification(`Opening detailed review for ${alertId}...`, 'success');
            
            setTimeout(() => {
                // Create detailed alert review modal
                showAlertReviewModal(alertId);
                button.textContent = originalText;
                button.disabled = false;
            }, 1500);
        }

        function showAlertReviewModal(alertId) {
            const alertData = getAlertData(alertId);
            const modal = document.createElement('div');
            modal.className = 'modal active';
            modal.innerHTML = `
                <div class="bg-white rounded-xl p-6 max-w-4xl max-h-[80vh] overflow-y-auto m-4">
                    <div class="flex items-center justify-between mb-4">
                        <h2 class="text-xl font-bold">Alert Review: ${alertData.title}</h2>
                        <button onclick="this.closest('.modal').remove()" class="p-2 hover:bg-gray-100 rounded-lg">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                            </svg>
                        </button>
                    </div>
                    
                    <div class="space-y-4">
                        <div class="bg-${alertData.color}-50 p-4 rounded-lg border-l-4 border-${alertData.color}-500">
                            <h3 class="font-semibold text-${alertData.color}-800 mb-2">Alert Details</h3>
                            <p class="text-${alertData.color}-700">${alertData.description}</p>
                            <p class="text-sm text-${alertData.color}-600 mt-2">Priority: ${alertData.priority} ‚Ä¢ Generated: ${alertData.timestamp}</p>
                        </div>
                        
                        <div class="bg-gray-50 p-4 rounded-lg">
                            <h3 class="font-semibold text-gray-800 mb-2">Patient Information</h3>
                            <div class="grid grid-cols-2 gap-4">
                                <div>
                                    <p class="text-sm text-gray-600">Name</p>
                                    <p class="font-medium">${alertData.patientName}</p>
                                </div>
                                <div>
                                    <p class="text-sm text-gray-600">Village</p>
                                    <p class="font-medium">${alertData.village}</p>
                                </div>
                                <div>
                                    <p class="text-sm text-gray-600">Age</p>
                                    <p class="font-medium">${alertData.age}</p>
                                </div>
                                <div>
                                    <p class="text-sm text-gray-600">ASHA Worker</p>
                                    <p class="font-medium">${alertData.ashaWorker}</p>
                                </div>
                            </div>
                        </div>
                        
                        <div class="bg-blue-50 p-4 rounded-lg">
                            <h3 class="font-semibold text-blue-800 mb-2">Recommended Actions</h3>
                            <ul class="text-blue-700 space-y-1">
                                ${alertData.actions.map(action => `<li>‚Ä¢ ${action}</li>`).join('')}
                            </ul>
                        </div>
                        
                        <div class="bg-yellow-50 p-4 rounded-lg">
                            <h3 class="font-semibold text-yellow-800 mb-2">Add Review Notes</h3>
                            <textarea class="w-full p-3 border border-yellow-200 rounded-lg focus:outline-none focus:ring-2 focus:ring-yellow-500" rows="3" placeholder="Enter your review notes and action plan..."></textarea>
                        </div>
                    </div>
                    
                    <div class="mt-6 flex justify-end space-x-3">
                        <button onclick="this.closest('.modal').remove()" class="px-4 py-2 bg-gray-600 text-white rounded-lg hover:bg-gray-700">Close</button>
                        <button onclick="assignAlertFromModal('${alertId}')" class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700">Assign to ASHA</button>
                        <button onclick="resolveAlertFromModal('${alertId}')" class="px-4 py-2 bg-green-600 text-white rounded-lg hover:bg-green-700">Mark Resolved</button>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
        }

        function getAlertData(alertId) {
            const alertDatabase = {
                'sunita-risk': {
                    title: 'High-Risk Pregnancy - Sunita Devi',
                    description: 'Patient has multiple risk factors including anemia and hypertension. Requires immediate medical attention and close monitoring.',
                    patientName: 'Sunita Devi',
                    village: 'Govindpur',
                    age: '26 years',
                    ashaWorker: 'Meera Devi',
                    priority: 'CRITICAL',
                    color: 'red',
                    timestamp: '2 hours ago',
                    actions: [
                        'Schedule immediate PHC visit',
                        'Monitor blood pressure daily',
                        'Ensure iron supplementation compliance',
                        'Arrange specialist consultation if needed',
                        'Educate family about warning signs'
                    ]
                },
                'kamala-risk': {
                    title: 'Gestational Diabetes - Kamala Sharma',
                    description: 'Patient diagnosed with gestational diabetes. Blood sugar monitoring and dietary management required.',
                    patientName: 'Kamala Sharma',
                    village: 'Rampur',
                    age: '29 years',
                    ashaWorker: 'Sunita Devi',
                    priority: 'CRITICAL',
                    color: 'red',
                    timestamp: '2 hours ago',
                    actions: [
                        'Daily blood sugar monitoring',
                        'Dietary counseling and meal planning',
                        'Regular weight monitoring',
                        'Schedule frequent ANC visits',
                        'Prepare for potential complications'
                    ]
                },
                'raj-overdue': {
                    title: 'Overdue Vaccination - Baby Raj Kumar',
                    description: 'DPT-3 and OPV-3 vaccines are overdue by 5 days. Immediate vaccination required.',
                    patientName: 'Baby Raj Kumar',
                    village: 'Rampur',
                    age: '4 months',
                    ashaWorker: 'Sunita Devi',
                    priority: 'WARNING',
                    color: 'yellow',
                    timestamp: '4 hours ago',
                    actions: [
                        'Schedule vaccination session immediately',
                        'Counsel mother about importance of timely vaccination',
                        'Check for any contraindications',
                        'Update vaccination records',
                        'Schedule next vaccination reminder'
                    ]
                }
            };
            
            return alertDatabase[alertId] || {
                title: 'Alert Details',
                description: 'Alert information not available',
                patientName: 'Unknown',
                village: 'Unknown',
                age: 'Unknown',
                ashaWorker: 'Unknown',
                priority: 'INFO',
                color: 'blue',
                timestamp: 'Unknown',
                actions: ['Review alert details', 'Take appropriate action']
            };
        }

        function assignAlert(alertId) {
            const button = event.target;
            const originalText = button.textContent;
            
            button.textContent = 'Assigning...';
            button.disabled = true;
            
            showNotification(`Assigning ${alertId} to ASHA worker...`, 'success');
            
            setTimeout(() => {
                button.textContent = 'Assigned';
                button.className = 'px-3 py-1 bg-green-600 text-white rounded text-xs';
                showNotification('Alert assigned successfully!', 'success');
            }, 2000);
        }

        function assignAlertFromModal(alertId) {
            const modal = event.target.closest('.modal');
            showNotification(`Alert ${alertId} assigned to ASHA worker`, 'success');
            modal.remove();
        }

        function resolveAlertFromModal(alertId) {
            const modal = event.target.closest('.modal');
            showNotification(`Alert ${alertId} marked as resolved`, 'success');
            modal.remove();
            
            // Update the alert in the main list
            const alertElement = document.querySelector(`[data-alert-id*="${alertId.split('-')[0]}"]`);
            if (alertElement) {
                alertElement.style.opacity = '0.6';
                alertElement.querySelector('.pulse-dot').classList.remove('pulse-dot');
            }
        }

        function toggleAlertDetails(alertId) {
            const alertElement = document.querySelector(`[data-alert-id="${alertId}"]`);
            const detailsElement = alertElement.querySelector('.alert-details');
            const toggleButton = alertElement.querySelector('button[onclick*="toggleAlertDetails"]');
            const toggleIcon = toggleButton.querySelector('svg');
            
            if (detailsElement.classList.contains('hidden')) {
                detailsElement.classList.remove('hidden');
                toggleIcon.style.transform = 'rotate(180deg)';
                showNotification(`Expanded ${alertId} details`, 'success');
            } else {
                detailsElement.classList.add('hidden');
                toggleIcon.style.transform = 'rotate(0deg)';
            }
        }

        function filterAlerts(filterType) {
            // Update filter buttons
            document.querySelectorAll('.alert-filter-btn').forEach(btn => {
                btn.className = 'alert-filter-btn px-4 py-2 bg-gray-200 text-gray-700 rounded-full text-sm whitespace-nowrap';
            });
            event.target.className = 'alert-filter-btn active px-4 py-2 bg-blue-600 text-white rounded-full text-sm whitespace-nowrap';
            
            // Show/hide alerts based on filter
            const alerts = document.querySelectorAll('.alert-item');
            let visibleCount = 0;
            
            alerts.forEach(alert => {
                let shouldShow = false;
                
                if (filterType === 'all') {
                    shouldShow = true;
                } else if (filterType === 'critical') {
                    shouldShow = alert.classList.contains('critical');
                } else if (filterType === 'warning') {
                    shouldShow = alert.classList.contains('warning');
                } else if (filterType === 'info') {
                    shouldShow = alert.classList.contains('info');
                } else if (filterType === 'unread') {
                    shouldShow = !alert.classList.contains('read');
                } else if (filterType === 'resolved') {
                    shouldShow = alert.classList.contains('resolved');
                }
                
                if (shouldShow) {
                    alert.style.display = 'block';
                    alert.classList.add('fade-in');
                    visibleCount++;
                } else {
                    alert.style.display = 'none';
                }
            });
            
            // Update filter button text with count
            const filterText = filterType === 'all' ? 'All Alerts' : 
                              filterType === 'critical' ? `Critical (${visibleCount})` :
                              filterType === 'warning' ? `Warning (${visibleCount})` :
                              filterType === 'info' ? `Info (${visibleCount})` :
                              filterType === 'unread' ? `Unread (${visibleCount})` :
                              filterType === 'resolved' ? `Resolved (${visibleCount})` : filterType;
            
            event.target.textContent = filterText;
            
            showNotification(`Showing ${visibleCount} ${filterType} alerts`, 'success');
        }

        function refreshAlerts() {
            const button = event.target.closest('button');
            const icon = button.querySelector('svg');
            
            icon.classList.add('animate-spin');
            showNotification('Refreshing alerts...', 'success');
            
            setTimeout(() => {
                icon.classList.remove('animate-spin');
                
                // Simulate new alerts
                const criticalCount = document.getElementById('criticalAlertsCount');
                const warningCount = document.getElementById('warningAlertsCount');
                const infoCount = document.getElementById('infoAlertsCount');
                
                criticalCount.textContent = parseInt(criticalCount.textContent) + Math.floor(Math.random() * 3);
                warningCount.textContent = parseInt(warningCount.textContent) + Math.floor(Math.random() * 5);
                infoCount.textContent = parseInt(infoCount.textContent) + Math.floor(Math.random() * 8);
                
                showNotification('Alerts refreshed! 3 new alerts found.', 'success');
            }, 2000);
        }

        function markAllAlertsRead() {
            const button = event.target;
            const originalText = button.textContent;
            
            button.textContent = 'Marking...';
            button.disabled = true;
            
            showNotification('Marking all alerts as read...', 'success');
            
            setTimeout(() => {
                // Add read class to all alerts
                document.querySelectorAll('.alert-item').forEach(alert => {
                    alert.classList.add('read');
                    const pulseDot = alert.querySelector('.pulse-dot');
                    if (pulseDot) {
                        pulseDot.classList.remove('pulse-dot');
                        pulseDot.style.opacity = '0.5';
                    }
                });
                
                button.textContent = originalText;
                button.disabled = false;
                
                showNotification('All alerts marked as read!', 'success');
            }, 1500);
        }

        function resolveAlertCategory(categoryId) {
            const button = event.target;
            const alertElement = button.closest('.alert-item');
            
            button.textContent = 'Resolving...';
            button.disabled = true;
            
            showNotification(`Resolving ${categoryId} category...`, 'success');
            
            setTimeout(() => {
                alertElement.style.opacity = '0.6';
                alertElement.classList.add('resolved');
                
                // Update the category badge
                const badge = alertElement.querySelector('.px-2.py-1');
                badge.textContent = 'RESOLVED';
                badge.className = 'px-2 py-1 bg-green-100 text-green-800 rounded-full text-xs';
                
                // Update counters
                const resolvedCount = document.getElementById('resolvedAlertsCount');
                resolvedCount.textContent = parseInt(resolvedCount.textContent) + 1;
                
                button.textContent = 'Resolved';
                button.className = 'px-3 py-1 bg-gray-600 text-white rounded text-xs';
                
                showNotification(`${categoryId} category resolved successfully!`, 'success');
            }, 2000);
        }

        function contactASHA(ashaId) {
            const button = event.target;
            const originalText = button.textContent;
            
            button.textContent = 'Calling...';
            button.disabled = true;
            
            showNotification(`Contacting ${ashaId}...`, 'success');
            
            setTimeout(() => {
                button.textContent = 'Called';
                button.className = 'px-3 py-1 bg-green-600 text-white rounded text-xs';
                showNotification(`Call initiated to ${ashaId}`, 'success');
            }, 3000);
        }

        function scheduleTraining(ashaId) {
            const button = event.target;
            const originalText = button.textContent;
            
            button.textContent = 'Scheduling...';
            button.disabled = true;
            
            showNotification(`Scheduling training for ${ashaId}...`, 'success');
            
            setTimeout(() => {
                button.textContent = 'Scheduled';
                button.className = 'px-3 py-1 bg-green-600 text-white rounded text-xs';
                showNotification(`Training scheduled for ${ashaId}`, 'success');
            }, 2000);
        }

        function dismissAlert(alertId) {
            const button = event.target;
            const alertRow = button.closest('.py-2');
            
            alertRow.style.opacity = '0.5';
            button.textContent = 'Dismissed';
            button.disabled = true;
            
            showNotification(`Alert ${alertId} dismissed`, 'success');
        }

        function viewTrainingModule(moduleId) {
            showNotification(`Opening training module: ${moduleId}...`, 'success');
            
            setTimeout(() => {
                const modal = document.createElement('div');
                modal.className = 'modal active';
                modal.innerHTML = `
                    <div class="bg-white rounded-xl p-6 max-w-2xl m-4">
                        <div class="flex items-center justify-between mb-4">
                            <h2 class="text-xl font-bold">Training Module: Maternal Health Best Practices</h2>
                            <button onclick="this.closest('.modal').remove()" class="p-2 hover:bg-gray-100 rounded-lg">
                                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                                </svg>
                            </button>
                        </div>
                        
                        <div class="space-y-4">
                            <div class="bg-blue-50 p-4 rounded-lg">
                                <h3 class="font-semibold text-blue-800 mb-2">Module Overview</h3>
                                <p class="text-blue-700">Latest guidelines and best practices for maternal health care, including ANC protocols, risk identification, and emergency management.</p>
                            </div>
                            
                            <div class="bg-green-50 p-4 rounded-lg">
                                <h3 class="font-semibold text-green-800 mb-2">Learning Objectives</h3>
                                <ul class="text-green-700 space-y-1">
                                    <li>‚Ä¢ Identify high-risk pregnancies early</li>
                                    <li>‚Ä¢ Implement proper ANC protocols</li>
                                    <li>‚Ä¢ Manage emergency situations</li>
                                    <li>‚Ä¢ Provide effective counseling</li>
                                </ul>
                            </div>
                            
                            <div class="bg-yellow-50 p-4 rounded-lg">
                                <h3 class="font-semibold text-yellow-800 mb-2">Module Details</h3>
                                <p class="text-yellow-700">Duration: 45 minutes ‚Ä¢ Format: Interactive video ‚Ä¢ Certificate: Available upon completion</p>
                            </div>
                        </div>
                        
                        <div class="mt-6 flex justify-end space-x-3">
                            <button onclick="this.closest('.modal').remove()" class="px-4 py-2 bg-gray-600 text-white rounded-lg hover:bg-gray-700">Close</button>
                            <button onclick="startTrainingModule('${moduleId}')" class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700">Start Training</button>
                        </div>
                    </div>
                `;
                
                document.body.appendChild(modal);
            }, 1000);
        }

        function startTrainingModule(moduleId) {
            const modal = event.target.closest('.modal');
            modal.remove();
            showNotification(`Starting training module: ${moduleId}`, 'success');
        }

        function createCustomAlert() {
            const modal = document.createElement('div');
            modal.className = 'modal active';
            modal.innerHTML = `
                <div class="bg-white rounded-xl p-6 max-w-2xl m-4">
                    <div class="flex items-center justify-between mb-4">
                        <h2 class="text-xl font-bold">Create Custom Alert</h2>
                        <button onclick="this.closest('.modal').remove()" class="p-2 hover:bg-gray-100 rounded-lg">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                            </svg>
                        </button>
                    </div>
                    
                    <form onsubmit="submitCustomAlert(event)" class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Alert Title</label>
                            <input type="text" required class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="Enter alert title">
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Priority Level</label>
                            <select required class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                                <option value="">Select Priority</option>
                                <option value="critical">Critical</option>
                                <option value="warning">Warning</option>
                                <option value="info">Info</option>
                            </select>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Village</label>
                            <select required class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                                <option value="">Select Village</option>
                                <option value="rampur">Rampur</option>
                                <option value="krishnapur">Krishnapur</option>
                                <option value="govindpur">Govindpur</option>
                                <option value="all">All Villages</option>
                            </select>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Alert Description</label>
                            <textarea required rows="3" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500" placeholder="Describe the alert details..."></textarea>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-1">Assign to ASHA Worker</label>
                            <select class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                                <option value="">Select ASHA Worker (Optional)</option>
                                <option value="sunita-devi">Sunita Devi - Rampur</option>
                                <option value="priya-sharma">Priya Sharma - Krishnapur</option>
                                <option value="meera-devi">Meera Devi - Govindpur</option>
                            </select>
                        </div>
                        
                        <div class="flex justify-end space-x-3 mt-6">
                            <button type="button" onclick="this.closest('.modal').remove()" class="px-4 py-2 bg-gray-600 text-white rounded-lg hover:bg-gray-700">Cancel</button>
                            <button type="submit" class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700">Create Alert</button>
                        </div>
                    </form>
                </div>
            `;
            
            document.body.appendChild(modal);
        }

        function submitCustomAlert(event) {
            event.preventDefault();
            const form = event.target;
            const formData = new FormData(form);
            
            const submitButton = form.querySelector('button[type="submit"]');
            submitButton.textContent = 'Creating...';
            submitButton.disabled = true;
            
            showNotification('Creating custom alert...', 'success');
            
            setTimeout(() => {
                const modal = form.closest('.modal');
                modal.remove();
                showNotification('Custom alert created successfully!', 'success');
                
                // Update alert counters
                const infoCount = document.getElementById('infoAlertsCount');
                infoCount.textContent = parseInt(infoCount.textContent) + 1;
            }, 2000);
        }

        function exportAlerts() {
            const button = event.target.closest('button');
            const icon = button.querySelector('svg');
            
            icon.classList.add('animate-pulse');
            showNotification('Preparing alerts export...', 'success');
            
            setTimeout(() => {
                // Create export data
                const exportData = generateAlertsExport();
                const blob = new Blob([exportData], { type: 'text/csv' });
                const url = URL.createObjectURL(blob);
                
                const a = document.createElement('a');
                a.href = url;
                a.download = `PHC_Alerts_Export_${new Date().toISOString().split('T')[0]}.csv`;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
                
                icon.classList.remove('animate-pulse');
                showNotification('Alerts exported successfully!', 'success');
            }, 2000);
        }

        function generateAlertsExport() {
            return `Alert ID,Title,Priority,Village,ASHA Worker,Status,Generated Time
high-risk-pregnancies,High-Risk Pregnancies,Critical,Multiple,Multiple,Active,2 hours ago
overdue-immunizations,Overdue Immunizations,Warning,Multiple,Multiple,Active,4 hours ago
asha-issues,ASHA Worker Issues,Warning,Govindpur,Meera Devi,Active,6 hours ago
pending-reports,Pending Reports,Info,All,All,Active,1 day ago
system-notifications,System Notifications,Info,All,All,Active,8 hours ago`;
        }

        function showPHCNotifications() {
            showModal('phcNotificationsModal');
            populatePHCNotificationsModal();
        }

        // ASHA Functions - Make all functional
        function showPage(pageId) {
            // Hide all pages
            document.querySelectorAll('.page-content').forEach(page => {
                page.classList.add('hidden');
            });
            
            // Show selected page
            const targetPage = document.getElementById(pageId);
            if (targetPage) {
                targetPage.classList.remove('hidden');
            }
            
            // Show/hide bottom navigation and switch nav type
            const bottomNav = document.getElementById('bottomNav');
            const ashaNav = document.getElementById('ashaNav');
            const phcNav = document.getElementById('phcNav');
            
            if (pageId === 'homepage') {
                bottomNav.classList.add('hidden');
            } else {
                bottomNav.classList.remove('hidden');
                
                // Switch navigation based on page type
                if (pageId.startsWith('phc-')) {
                    ashaNav.classList.add('hidden');
                    phcNav.classList.remove('hidden');
                } else {
                    ashaNav.classList.remove('hidden');
                    phcNav.classList.add('hidden');
                }
            }
            
            // Update navigation only if not homepage
            if (pageId !== 'homepage') {
                document.querySelectorAll('.nav-item').forEach(item => {
                    item.classList.remove('active');
                });
                
                // Find and activate the corresponding nav item
                let navItems, pageIndex;
                
                if (pageId.startsWith('phc-')) {
                    navItems = phcNav.querySelectorAll('.nav-item');
                    pageIndex = ['phc-dashboard', 'phc-villages', 'phc-reports', 'phc-alerts', 'phc-sync'].indexOf(pageId);
                } else {
                    navItems = ashaNav.querySelectorAll('.nav-item');
                    pageIndex = ['dashboard', 'health-records', 'immunization', 'maternal-health', 'work-planning'].indexOf(pageId);
                }
                
                if (pageIndex !== -1 && navItems[pageIndex]) {
                    navItems[pageIndex].classList.add('active');
                }
            }
            
            currentPage = pageId;
            
            // Load page-specific content
            loadPageContent(pageId);
        }

        function loadPageContent(pageId) {
            switch(pageId) {
                case 'health-records':
                    populateHealthRecords();
                    break;
                case 'immunization':
                    populateImmunizationPage();
                    break;
                case 'maternal-health':
                    populateMaternalHealthPage();
                    break;
                case 'work-planning':
                    populateWorkPlanningPage();
                    break;
                case 'phc-reports':
                    populatePHCReportsPage();
                    break;
            }
        }

        // Modal Functions
        function showModal(modalId) {
            const modal = document.getElementById(modalId);
            if (modal) {
                modal.classList.add('active');
                document.body.style.overflow = 'hidden';
            }
        }

        function hideModal(modalId) {
            const modal = document.getElementById(modalId);
            if (modal) {
                modal.classList.remove('active');
                document.body.style.overflow = 'auto';
            }
        }

        // Modal Population Functions
        function populateTaskReviewModal() {
            // Populate the task review modal with sample tasks (replace with real data later)
            const container = document.getElementById('taskReviewContent');
            if (!container) {
                console.error('TaskReviewContent container not found');
                showNotification('Task review panel not available', 'error');
                return;
            }

            const tasksHTML = `
                <div class="space-y-3">
                    <div class="task-item bg-white rounded-xl p-3 shadow-sm border-l-4 border-red-500" data-id="raj-kumar">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="font-semibold">Baby Raj Kumar - DPT-3 overdue</p>
                                <p class="text-xs text-gray-500">Village: Rampur ‚Ä¢ Due 5 days ago</p>
                            </div>
                            <div class="flex items-center space-x-2">
                                <button onclick="completeTask('raj-kumar', event)" class="px-3 py-1 bg-green-600 text-white rounded text-xs hover:bg-green-700">Complete</button>
                                <button onclick="showTaskDetails('raj-kumar')" class="px-3 py-1 bg-yellow-600 text-white rounded text-xs hover:bg-yellow-700">Details</button>
                            </div>
                        </div>
                    </div>
                    <div class="task-item bg-white rounded-xl p-3 shadow-sm border-l-4 border-yellow-500" data-id="priya-sharma">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="font-semibold">Priya Sharma - Home visit due</p>
                                <p class="text-xs text-gray-500">Village: Krishnapur ‚Ä¢ Scheduled today</p>
                            </div>
                            <div class="flex items-center space-x-2">
                                <button onclick="completeTask('priya-sharma', event)" class="px-3 py-1 bg-green-600 text-white rounded text-xs hover:bg-green-700">Complete</button>
                                <button onclick="showTaskDetails('priya-sharma')" class="px-3 py-1 bg-yellow-600 text-white rounded text-xs hover:bg-yellow-700">Details</button>
                            </div>
                        </div>
                    </div>
                </div>
            `;

            container.innerHTML = tasksHTML;
            showNotification('Task review panel loaded', 'success');
        }

        function populateErrorLogsModal() {
            // This would populate error logs
            showNotification('Error logs loaded', 'success');
        }

        function populateAlertDetailsModal(alertId) {
            // This would show specific alert details
            showNotification(`Alert ${alertId} details loaded`, 'success');
        }

        function populatePHCNotificationsModal() {
            // This would show PHC notifications
            showNotification('PHC notifications loaded', 'success');
        }

        // Page Population Functions
        function populateHealthRecords() {
            // Create health records page content if it doesn't exist
            const healthRecordsPage = document.getElementById('health-records');
            if (!healthRecordsPage) {
                createHealthRecordsPage();
            }
        }

        function populateImmunizationPage() {
            const immunizationPage = document.getElementById('immunization');
            if (!immunizationPage) {
                createImmunizationPage();
            }
        }

        function populateMaternalHealthPage() {
            const maternalPage = document.getElementById('maternal-health');
            if (!maternalPage) {
                createMaternalHealthPage();
            }
        }

        function populateWorkPlanningPage() {
            const workPlanPage = document.getElementById('work-planning');
            if (!workPlanPage) {
                createWorkPlanningPage();
            }
        }

        function populatePHCReportsPage() {
            const reportsPage = document.getElementById('phc-reports');
            if (!reportsPage) {
                createPHCReportsPage();
            }
        }

        // Update Functions
        function updatePHCSyncStatus(status) {
            const syncStatusElement = document.getElementById('phcSyncStatus');
            if (syncStatusElement) {
                const dot = syncStatusElement.querySelector('.w-2.h-2');
                const text = syncStatusElement.querySelector('span:last-child');
                
                switch(status) {
                    case 'syncing':
                        dot.className = 'w-2 h-2 bg-yellow-400 rounded-full pulse-dot';
                        text.textContent = 'Syncing';
                        break;
                    case 'synced':
                        dot.className = 'w-2 h-2 bg-green-400 rounded-full pulse-dot';
                        text.textContent = 'Synced';
                        break;
                    case 'offline':
                        dot.className = 'w-2 h-2 bg-red-400 rounded-full';
                        text.textContent = 'Offline';
                        break;
                }
            }
        }

        // Patient Registration Function
        function showPatientRegistration() {
            showModal('patientRegistrationModal');
        }

        // OCR Scanner Function
        function showOCRScanner() {
            showModal('ocrScannerModal');
            startOCRScanning();
        }

        function startOCRScanning() {
            showNotification('OCR Scanner activated - Point camera at form', 'success');
            // Simulate OCR scanning process
            setTimeout(() => {
                showNotification('Form data captured successfully!', 'success');
                hideModal('ocrScannerModal');
            }, 3000);
        }

        // All missing functions implementation
        function viewPatientRecord(patientId) {
            showNotification(`Opening ${patientId} patient record...`, 'success');
            // Simulate opening patient record
            setTimeout(() => {
                showNotification('Patient record loaded successfully!', 'success');
            }, 1000);
        }

        function scheduleVaccination(vaccinationId) {
            showNotification(`Scheduling ${vaccinationId} vaccination...`, 'success');
            // Update UI to show scheduled
            const button = event.target;
            button.textContent = 'Scheduled';
            button.className = 'px-3 py-1 bg-green-600 text-white rounded text-sm';
            button.disabled = true;
        }

        function viewMaternalRecord(patientId) {
            showNotification(`Opening maternal record for ${patientId}...`, 'success');
            setTimeout(() => {
                showNotification('Maternal health record loaded!', 'success');
            }, 1000);
        }

        function schedulePNC(patientId) {
            showNotification(`Scheduling PNC visit for ${patientId}...`, 'success');
            const button = event.target;
            button.textContent = 'Scheduled';
            button.className = 'px-3 py-1 bg-green-600 text-white rounded text-sm';
            button.disabled = true;
        }

        function generateReport(reportType) {
            const button = event.target;
            const originalContent = button.innerHTML;
            
            button.innerHTML = `
                <div class="flex items-center justify-between">
                    <div>
                        <h3 class="font-semibold text-gray-900">Generating ${reportType} report...</h3>
                        <p class="text-sm text-gray-600">Please wait...</p>
                    </div>
                    <svg class="w-5 h-5 text-gray-400 animate-spin" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"/>
                    </svg>
                </div>
            `;
            
            showNotification(`Generating ${reportType} report...`, 'success');
            
            setTimeout(() => {
                button.innerHTML = originalContent;
                showNotification(`${reportType} report generated successfully!`, 'success');
            }, 3000);
        }

        function viewReport(reportId) {
            showNotification(`Opening ${reportId} report...`, 'success');
            setTimeout(() => {
                showNotification('Report opened successfully!', 'success');
            }, 1000);
        }

        function generatePHCReport(reportType) {
            const button = event.target.closest('.report-btn');
            const originalContent = button.innerHTML;
            
            // Disable all report buttons during generation
            document.querySelectorAll('.report-btn').forEach(btn => btn.disabled = true);
            
            // Show progress panel
            const progressPanel = document.getElementById('reportProgress');
            const progressBar = document.getElementById('progressBar');
            const progressPercentage = document.getElementById('progressPercentage');
            const progressStatus = document.getElementById('progressStatus');
            
            progressPanel.classList.remove('hidden');
            
            // Update button to show generating state
            button.innerHTML = `
                <div class="flex items-center justify-between">
                    <div>
                        <h3 class="font-semibold text-gray-900">üîÑ Generating ${getReportTitle(reportType)}...</h3>
                        <p class="text-sm text-gray-600">Please wait while we compile the data...</p>
                        <p class="text-xs text-blue-600 mt-1">This may take a few moments</p>
                    </div>
                    <svg class="w-5 h-5 text-blue-600 animate-spin" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"/>
                    </svg>
                </div>
            `;
            
            showNotification(`Generating ${getReportTitle(reportType)} report...`, 'success');
            
            // Simulate realistic report generation progress
            const progressSteps = getProgressSteps(reportType);
            let currentStep = 0;
            
            const progressInterval = setInterval(() => {
                if (currentStep < progressSteps.length) {
                    const step = progressSteps[currentStep];
                    const percentage = Math.round(((currentStep + 1) / progressSteps.length) * 100);
                    
                    progressBar.style.width = percentage + '%';
                    progressPercentage.textContent = percentage + '%';
                    progressStatus.textContent = step;
                    
                    currentStep++;
                } else {
                    clearInterval(progressInterval);
                    
                    // Complete the report generation
                    setTimeout(() => {
                        completeReportGeneration(reportType, button, originalContent, progressPanel);
                    }, 500);
                }
            }, 800);
        }

        function getReportTitle(reportType) {
            const titles = {
                'consolidated': 'Consolidated Village Report',
                'asha-performance': 'ASHA Performance Report',
                'health-indicators': 'Health Indicators Report',
                'monthly-summary': 'Monthly Summary Report'
            };
            return titles[reportType] || reportType;
        }

        function getProgressSteps(reportType) {
            const baseSteps = [
                'Initializing report generation...',
                'Collecting data from ASHA workers...',
                'Analyzing village performance metrics...',
                'Processing health indicators...',
                'Generating charts and visualizations...',
                'Compiling final report...',
                'Finalizing document...'
            ];
            
            const specificSteps = {
                'consolidated': [
                    'Gathering data from all 12 villages...',
                    'Analyzing ASHA performance across villages...',
                    'Calculating coverage rates and metrics...',
                    'Processing immunization data...',
                    'Analyzing maternal health indicators...',
                    'Generating comparative charts...',
                    'Creating executive summary...',
                    'Finalizing consolidated report...'
                ],
                'asha-performance': [
                    'Collecting individual ASHA data...',
                    'Analyzing task completion rates...',
                    'Processing visit efficiency metrics...',
                    'Evaluating training completion status...',
                    'Calculating performance scores...',
                    'Generating individual scorecards...',
                    'Creating performance rankings...',
                    'Finalizing ASHA performance report...'
                ],
                'health-indicators': [
                    'Gathering immunization coverage data...',
                    'Processing ANC and PNC statistics...',
                    'Analyzing child nutrition metrics...',
                    'Calculating disease prevention rates...',
                    'Processing maternal health outcomes...',
                    'Generating health trend analysis...',
                    'Creating indicator dashboards...',
                    'Finalizing health indicators report...'
                ],
                'monthly-summary': [
                    'Collecting monthly activity data...',
                    'Processing all health interventions...',
                    'Analyzing monthly trends and patterns...',
                    'Calculating achievement against targets...',
                    'Processing feedback and challenges...',
                    'Generating recommendations...',
                    'Creating monthly dashboard...',
                    'Finalizing comprehensive summary...'
                ]
            };
            
            return specificSteps[reportType] || baseSteps;
        }

        function completeReportGeneration(reportType, button, originalContent, progressPanel) {
            // Hide progress panel
            progressPanel.classList.add('hidden');
            
            // Restore button
            button.innerHTML = originalContent;
            
            // Re-enable all buttons
            document.querySelectorAll('.report-btn').forEach(btn => btn.disabled = false);
            
            // Add new report to recent reports list
            addToRecentReports(reportType);
            
            showNotification(`${getReportTitle(reportType)} generated successfully!`, 'success');
        }

        function addToRecentReports(reportType) {
            const reportsList = document.getElementById('recentReportsList');
            const reportTitle = getReportTitle(reportType);
            const reportIcon = getReportIcon(reportType);
            const reportSize = getReportSize(reportType);
            const reportId = `${reportType}-${Date.now()}`;
            
            const newReportHTML = `
                <div class="bg-white rounded-xl p-4 shadow-sm border-l-4 border-green-500">
                    <div class="flex items-center justify-between">
                        <div>
                            <p class="font-semibold text-gray-900">${reportIcon} ${reportTitle}</p>
                            <p class="text-sm text-gray-600">Generated: Just now ‚Ä¢ Fresh data compilation</p>
                            <p class="text-xs text-green-600">Status: Complete ‚Ä¢ Size: ${reportSize}</p>
                        </div>
                        <div class="flex space-x-2">
                            <button onclick="viewPHCReport('${reportId}')" class="px-3 py-1 bg-blue-600 text-white rounded text-sm hover:bg-blue-700">View</button>
                            <button onclick="downloadPHCReport('${reportId}')" class="px-3 py-1 bg-green-600 text-white rounded text-sm hover:bg-green-700">Download</button>
                        </div>
                    </div>
                </div>
            `;
            
            reportsList.insertAdjacentHTML('afterbegin', newReportHTML);
        }

        function getReportIcon(reportType) {
            const icons = {
                'consolidated': 'üìä',
                'asha-performance': 'üë©‚Äç‚öïÔ∏è',
                'health-indicators': 'üíâ',
                'monthly-summary': 'üìÖ'
            };
            return icons[reportType] || 'üìÑ';
        }

        function getReportSize(reportType) {
            const sizes = {
                'consolidated': '2.8 MB',
                'asha-performance': '1.9 MB',
                'health-indicators': '3.2 MB',
                'monthly-summary': '4.1 MB'
            };
            return sizes[reportType] || '2.0 MB';
        }

        function viewPHCReport(reportId) {
            showNotification('Opening report viewer...', 'success');
            
            // Simulate opening report with detailed content
            setTimeout(() => {
                const reportContent = generateReportPreview(reportId);
                showReportModal(reportContent);
                showNotification('Report opened successfully!', 'success');
            }, 1500);
        }

        function downloadPHCReport(reportId) {
            const button = event.target;
            const originalText = button.textContent;
            
            button.textContent = 'Downloading...';
            button.disabled = true;
            
            showNotification('Preparing report for download...', 'success');
            
            // Simulate download process
            setTimeout(() => {
                // Create a mock download
                const reportData = generateReportData(reportId);
                const blob = new Blob([reportData], { type: 'text/plain' });
                const url = URL.createObjectURL(blob);
                
                const a = document.createElement('a');
                a.href = url;
                a.download = `PHC_Report_${reportId}.txt`;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
                
                button.textContent = originalText;
                button.disabled = false;
                
                showNotification('Report downloaded successfully!', 'success');
            }, 2000);
        }

        function generateReportPreview(reportId) {
            return `
                <div class="space-y-6">
                    <div class="text-center border-b pb-4">
                        <h2 class="text-2xl font-bold text-gray-900">PHC Health Report</h2>
                        <p class="text-gray-600">Report ID: ${reportId}</p>
                        <p class="text-sm text-gray-500">Generated on ${new Date().toLocaleDateString()}</p>
                    </div>
                    
                    <div class="grid grid-cols-2 gap-4">
                        <div class="bg-blue-50 p-4 rounded-lg">
                            <h3 class="font-semibold text-blue-800">Total Villages</h3>
                            <p class="text-2xl font-bold text-blue-600">12</p>
                        </div>
                        <div class="bg-green-50 p-4 rounded-lg">
                            <h3 class="font-semibold text-green-800">ASHA Workers</h3>
                            <p class="text-2xl font-bold text-green-600">18</p>
                        </div>
                        <div class="bg-purple-50 p-4 rounded-lg">
                            <h3 class="font-semibold text-purple-800">Immunization Coverage</h3>
                            <p class="text-2xl font-bold text-purple-600">87%</p>
                        </div>
                        <div class="bg-orange-50 p-4 rounded-lg">
                            <h3 class="font-semibold text-orange-800">ANC Coverage</h3>
                            <p class="text-2xl font-bold text-orange-600">92%</p>
                        </div>
                    </div>
                    
                    <div class="bg-gray-50 p-4 rounded-lg">
                        <h3 class="font-semibold text-gray-800 mb-2">Key Findings</h3>
                        <ul class="text-sm text-gray-600 space-y-1">
                            <li>‚Ä¢ Rampur village shows excellent performance with 92% immunization coverage</li>
                            <li>‚Ä¢ Govindpur needs attention with only 68% coverage rate</li>
                            <li>‚Ä¢ 5 high-risk pregnancies require immediate follow-up</li>
                            <li>‚Ä¢ Overall maternal health indicators are above target</li>
                        </ul>
                    </div>
                    
                    <div class="bg-yellow-50 p-4 rounded-lg">
                        <h3 class="font-semibold text-yellow-800 mb-2">Recommendations</h3>
                        <ul class="text-sm text-yellow-700 space-y-1">
                            <li>‚Ä¢ Increase ASHA support in Govindpur village</li>
                            <li>‚Ä¢ Conduct additional immunization camps</li>
                            <li>‚Ä¢ Enhance high-risk pregnancy monitoring</li>
                            <li>‚Ä¢ Provide refresher training for underperforming areas</li>
                        </ul>
                    </div>
                </div>
            `;
        }

        function generateReportData(reportId) {
            return `PHC HEALTH REPORT
Report ID: ${reportId}
Generated: ${new Date().toLocaleString()}

EXECUTIVE SUMMARY
================
This report provides a comprehensive overview of health activities and outcomes across all villages under this PHC jurisdiction.

VILLAGE PERFORMANCE
==================
Rampur Village: 92% immunization coverage, 88% ANC coverage
Krishnapur Village: 76% immunization coverage, 82% ANC coverage  
Govindpur Village: 68% immunization coverage, 71% ANC coverage

ASHA WORKER PERFORMANCE
======================
Sunita Devi (Rampur): Excellent performance, 95% task completion
Priya Sharma (Krishnapur): Good performance, 82% task completion
Meera Devi (Govindpur): Needs improvement, 71% task completion

HEALTH INDICATORS
================
Overall Immunization Coverage: 87%
ANC Coverage: 92%
PNC Coverage: 89%
High-Risk Pregnancies: 5 active cases

RECOMMENDATIONS
==============
1. Increase support for underperforming villages
2. Conduct additional training sessions
3. Enhance monitoring of high-risk cases
4. Improve data collection and reporting

Report generated by PHC Management System
`;
        }

        function showReportModal(content) {
            // Create and show a modal with the report content as a card that appears from the top
            const backdrop = document.createElement('div');
            backdrop.className = 'modal-backdrop';

            const card = document.createElement('div');
            card.className = 'modal-card';
            card.innerHTML = `
                <div class="p-6 max-h-[80vh] overflow-y-auto">
                    <div class="flex items-center justify-between mb-4">
                        <h2 class="text-xl font-bold">Report Preview</h2>
                        <button id="closeReportBtn" class="p-2 hover:bg-gray-100 rounded-lg">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                            </svg>
                        </button>
                    </div>
                    ${content}
                    <div class="mt-6 flex justify-end space-x-3">
                        <button id="closeReportBtn2" class="px-4 py-2 bg-gray-600 text-white rounded-lg hover:bg-gray-700">Close</button>
                        <button onclick="window.print()" class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700">Print</button>
                    </div>
                </div>
            `;

            backdrop.appendChild(card);
            document.body.appendChild(backdrop);

            // trigger the entrance animation
            requestAnimationFrame(() => backdrop.classList.add('show'));

            // attach close handlers
            const closeBtn = document.getElementById('closeReportBtn');
            const closeBtn2 = document.getElementById('closeReportBtn2');
            function removeBackdrop() {
                backdrop.remove();
            }
            if (closeBtn) closeBtn.addEventListener('click', removeBackdrop);
            if (closeBtn2) closeBtn2.addEventListener('click', removeBackdrop);
            // close when clicking outside the card
            backdrop.addEventListener('click', function(e) {
                if (e.target === backdrop) removeBackdrop();
            });
        }

        function clearReportHistory() {
            if (confirm('Are you sure you want to clear all report history? This action cannot be undone.')) {
                const reportsList = document.getElementById('recentReportsList');
                reportsList.innerHTML = `
                    <div class="text-center py-8 text-gray-500">
                        <svg class="w-12 h-12 mx-auto mb-3 text-gray-300" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"/>
                        </svg>
                        <p>No reports available</p>
                        <p class="text-sm">Generate a new report to see it here</p>
                    </div>
                `;
                showNotification('Report history cleared successfully', 'success');
            }
        }

        function registerPatient(event) {
            event.preventDefault();
            const form = event.target;
            const formData = new FormData(form);
            
            // Show loading state
            const submitButton = form.querySelector('button[type="submit"]');
            const originalText = submitButton.textContent;
            submitButton.textContent = 'Registering...';
            submitButton.disabled = true;
            
            showNotification('Registering new patient...', 'success');
            
            // Simulate registration process
            setTimeout(() => {
                submitButton.textContent = originalText;
                submitButton.disabled = false;
                form.reset();
                showNotification('Patient registered successfully!', 'success');
                
                // Navigate back to health records
                setTimeout(() => {
                    showPage('health-records');
                }, 1500);
            }, 2000);
        }

        // Language switching function
        document.addEventListener('DOMContentLoaded', function() {
            const languageSelector = document.getElementById('languageSelector');
            if (languageSelector) {
                languageSelector.addEventListener('change', function() {
                    const selectedLanguage = this.value;
                    currentLanguage = selectedLanguage;
                    showNotification(`Language changed to ${selectedLanguage === 'hi' ? '‡§π‡§ø‡§Ç‡§¶‡•Ä' : selectedLanguage === 'kn' ? '‡≤ï‡≤®‡≥ç‡≤®‡≤°' : selectedLanguage === 'te' ? '‡∞§‡±Ü‡∞≤‡±Å‡∞ó‡±Å' : 'English'}`, 'success');
                });
            }
        });

        // Enhanced notification system
        function showNotifications() {
            showNotification('Opening notifications panel...', 'success');
            // Simulate notification panel
            setTimeout(() => {
                const notifications = [
                    'Baby Raj Kumar - DPT-3 vaccination overdue',
                    'Sunita Devi - High-risk pregnancy follow-up needed',
                    'Monthly report submission due tomorrow'
                ];
                
                let notificationText = 'Recent Notifications:\n';
                notifications.forEach((notif, index) => {
                    notificationText += `${index + 1}. ${notif}\n`;
                });
                
                showNotification('Notifications loaded', 'success');
            }, 1000);
        }

        // Enhanced connectivity management
        function updateConnectivityStatus() {
            const dot = document.getElementById('connectivityDot');
            const text = document.getElementById('connectivityText');
            
            if (dot && text) {
                if (isOnline) {
                    dot.className = 'w-2 h-2 bg-green-400 rounded-full pulse-dot';
                    text.textContent = 'Online';
                } else {
                    dot.className = 'w-2 h-2 bg-red-400 rounded-full';
                    text.textContent = 'Offline';
                }
            }
        }

        // Auto-sync functionality
        function autoSync() {
            if (isOnline) {
                showNotification('Auto-syncing data...', 'success');
                setTimeout(() => {
                    showNotification('Data synchronized successfully!', 'success');
                }, 2000);
            }
        }

        // Set up auto-sync every 5 minutes when online
        setInterval(() => {
            if (isOnline && currentPage !== 'homepage') {
                autoSync();
            }
        }, 300000); // 5 minutes

        // Enhanced task management
        function markTaskComplete(taskId) {
            const taskElement = document.querySelector(`[data-task-id="${taskId}"]`);
            if (taskElement) {
                taskElement.style.opacity = '0.5';
                taskElement.querySelector('.task-status').textContent = 'Completed';
                taskElement.querySelector('.task-status').className = 'task-status px-3 py-1 bg-green-100 text-green-800 rounded-full text-sm';
            }
            
            showNotification('Task marked as complete!', 'success');
            
            // Update dashboard counters
            const pendingCount = document.getElementById('pendingTasksCount');
            if (pendingCount) {
                const current = parseInt(pendingCount.textContent);
                pendingCount.textContent = Math.max(0, current - 1);
            }
        }

        // Village visit tracking
        function startVillageVisits(village) {
            showNotification(`Starting visits in ${village.charAt(0).toUpperCase() + village.slice(1)} village`, 'success');
            
            // Update work plan progress
            const progressBar = document.querySelector('.bg-white.h-2.rounded-full');
            if (progressBar) {
                let currentWidth = parseInt(progressBar.style.width) || 25;
                progressBar.style.width = Math.min(100, currentWidth + 25) + '%';
            }
            
            // Update visit counter
            const visitCounter = document.getElementById('todayVisitsCount');
            if (visitCounter) {
                const [completed, total] = visitCounter.textContent.split('/').map(Number);
                visitCounter.textContent = `${Math.min(total, completed + 1)}/${total}`;
            }
        }

        // Data validation and error handling
        function validateFormData(formData) {
            const errors = [];
            
            if (!formData.get('name') || formData.get('name').trim().length < 2) {
                errors.push('Name must be at least 2 characters long');
            }
            
            if (!formData.get('age') || formData.get('age') < 0 || formData.get('age') > 120) {
                errors.push('Please enter a valid age');
            }
            
            if (!formData.get('village')) {
                errors.push('Please select a village');
            }
            
            return errors;
        }

        // Offline data management
        function saveOfflineData(data) {
            try {
                const offlineData = JSON.parse(localStorage.getItem('offlineHealthData') || '[]');
                offlineData.push({
                    ...data,
                    timestamp: new Date().toISOString(),
                    synced: false
                });
                localStorage.setItem('offlineHealthData', JSON.stringify(offlineData));
                showNotification('Data saved offline', 'success');
            } catch (error) {
                showNotification('Error saving offline data', 'error');
            }
        }

        function syncOfflineData() {
            try {
                const offlineData = JSON.parse(localStorage.getItem('offlineHealthData') || '[]');
                const unsyncedData = offlineData.filter(item => !item.synced);
                
                if (unsyncedData.length > 0) {
                    showNotification(`Syncing ${unsyncedData.length} offline records...`, 'success');
                    
                    // Simulate sync process
                    setTimeout(() => {
                        // Mark all as synced
                        const updatedData = offlineData.map(item => ({ ...item, synced: true }));
                        localStorage.setItem('offlineHealthData', JSON.stringify(updatedData));
                        showNotification('All offline data synchronized!', 'success');
                    }, 3000);
                } else {
                    showNotification('No offline data to sync', 'success');
                }
            } catch (error) {
                showNotification('Error syncing offline data', 'error');
            }
        }

        // Village Monitoring Functions
        function refreshVillageData() {
            const button = event.target.closest('button');
            const icon = button.querySelector('svg');
            
            icon.classList.add('animate-spin');
            showNotification('Refreshing village data...', 'success');
            
            // Simulate real-time data updates
            setTimeout(() => {
                updateVillageMetrics();
                updateVillageCards();
                icon.classList.remove('animate-spin');
                showNotification('Village data refreshed! 3 updates found.', 'success');
            }, 2000);
        }

        function updateVillageMetrics() {
            // Update overview cards with random realistic changes
            const activeVillages = document.getElementById('activeVillagesCount');
            const onlineAsha = document.getElementById('onlineAshaCount');
            const todayVisits = document.getElementById('todayVisitsCount');
            const urgentAlerts = document.getElementById('urgentAlertsCount');
            
            if (activeVillages) activeVillages.textContent = Math.floor(Math.random() * 3) + 8;
            if (onlineAsha) onlineAsha.textContent = Math.floor(Math.random() * 5) + 13;
            if (todayVisits) todayVisits.textContent = Math.floor(Math.random() * 20) + 40;
            if (urgentAlerts) urgentAlerts.textContent = Math.floor(Math.random() * 5) + 1;
        }

        function updateVillageCards() {
            // Simulate real-time updates to village cards
            const villageCards = document.querySelectorAll('.village-card');
            villageCards.forEach(card => {
                const progressBars = card.querySelectorAll('.h-2.rounded-full div');
                progressBars.forEach(bar => {
                    const currentWidth = parseInt(bar.style.width) || 70;
                    const change = Math.floor(Math.random() * 6) - 3; // -3 to +3
                    const newWidth = Math.max(60, Math.min(95, currentWidth + change));
                    bar.style.width = newWidth + '%';
                    
                    // Update percentage text
                    const percentText = bar.parentElement.nextElementSibling;
                    if (percentText && percentText.textContent.includes('%')) {
                        percentText.textContent = newWidth + '%';
                    }
                });
            });
        }

        function filterVillages(filterType) {
            // Update filter buttons
            document.querySelectorAll('.village-filter-btn').forEach(btn => {
                btn.className = 'village-filter-btn px-4 py-2 bg-gray-200 text-gray-700 rounded-full text-sm whitespace-nowrap';
            });
            event.target.className = 'village-filter-btn active px-4 py-2 bg-blue-600 text-white rounded-full text-sm whitespace-nowrap';
            
            // Show/hide villages based on filter
            const villages = document.querySelectorAll('.village-card');
            let visibleCount = 0;
            
            villages.forEach(village => {
                let shouldShow = false;
                
                if (filterType === 'all') {
                    shouldShow = true;
                } else if (filterType === 'critical') {
                    shouldShow = village.classList.contains('critical');
                } else if (filterType === 'attention') {
                    shouldShow = village.classList.contains('attention');
                } else if (filterType === 'active') {
                    shouldShow = village.classList.contains('active');
                }
                
                if (shouldShow) {
                    village.style.display = 'block';
                    village.classList.add('fade-in');
                    visibleCount++;
                } else {
                    village.style.display = 'none';
                }
            });
            
            showNotification(`Showing ${visibleCount} ${filterType} villages`, 'success');
        }

        function sortVillages(sortBy) {
            const villagesList = document.getElementById('villagesList');
            const villages = Array.from(villagesList.querySelectorAll('.village-card'));
            
            villages.sort((a, b) => {
                switch(sortBy) {
                    case 'name':
                        const nameA = a.querySelector('h3').textContent.trim();
                        const nameB = b.querySelector('h3').textContent.trim();
                        return nameA.localeCompare(nameB);
                    
                    case 'coverage':
                        const coverageA = parseInt(a.querySelector('.text-sm.font-semibold').textContent);
                        const coverageB = parseInt(b.querySelector('.text-sm.font-semibold').textContent);
                        return coverageB - coverageA; // Descending order
                    
                    case 'priority':
                        const priorityOrder = { 'critical': 3, 'attention': 2, 'active': 1 };
                        const priorityA = a.classList.contains('critical') ? 3 : a.classList.contains('attention') ? 2 : 1;
                        const priorityB = b.classList.contains('critical') ? 3 : b.classList.contains('attention') ? 2 : 1;
                        return priorityB - priorityA; // Critical first
                    
                    case 'activity':
                        const activityA = parseInt(a.querySelector('.text-lg.font-bold').textContent.split('/')[0]);
                        const activityB = parseInt(b.querySelector('.text-lg.font-bold').textContent.split('/')[0]);
                        return activityB - activityA; // Most active first
                    
                    default:
                        return 0;
                }
            });
            
            // Re-append sorted villages
            villages.forEach(village => villagesList.appendChild(village));
            
            showNotification(`Villages sorted by ${sortBy}`, 'success');
        }

        function expandVillageDetails(villageId) {
            const detailsElement = document.getElementById(`${villageId}-details`);
            const isHidden = detailsElement.classList.contains('hidden');
            
            // Close all other details first
            document.querySelectorAll('.village-details').forEach(details => {
                details.classList.add('hidden');
            });
            
            if (isHidden) {
                detailsElement.classList.remove('hidden');
                detailsElement.classList.add('fade-in');
                showNotification(`Expanded ${villageId} details`, 'success');
            }
        }

        function contactVillageASHA(villageId) {
            const ashaNames = {
                'rampur': 'Sunita Devi',
                'krishnapur': 'Priya Sharma',
                'govindpur': 'Meera Devi'
            };
            
            const ashaName = ashaNames[villageId] || 'ASHA Worker';
            const button = event.target.closest('button');
            const originalContent = button.innerHTML;
            
            button.innerHTML = `
                <svg class="w-4 h-4 animate-pulse" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z"/>
                </svg>
            `;
            
            showNotification(`Calling ${ashaName}...`, 'success');
            
            setTimeout(() => {
                button.innerHTML = originalContent;
                showNotification(`Call connected to ${ashaName}`, 'success');
                
                // Simulate call result - update village status
                setTimeout(() => {
                    showNotification(`${ashaName} confirmed - will complete pending tasks today`, 'success');
                }, 3000);
            }, 2000);
        }

        function viewVillageMap(villageId) {
            showNotification(`Opening map for ${villageId} village...`, 'success');
            
            setTimeout(() => {
                // Build a top-entry modal (backdrop + card) so it rises from the top on open
                const backdrop = document.createElement('div');
                backdrop.className = 'modal-backdrop';

                const card = document.createElement('div');
                card.className = 'modal-card';
                card.innerHTML = `
                    <div class="p-6 max-h-[80vh] overflow-y-auto">
                        <div class="flex items-center justify-between mb-4">
                            <h2 class="text-xl font-bold">Village Map - ${villageId.charAt(0).toUpperCase() + villageId.slice(1)}</h2>
                            <button data-close-modal class="p-2 hover:bg-gray-100 rounded-lg">
                                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                                </svg>
                            </button>
                        </div>

                        <div class="bg-gray-100 rounded-lg p-8 text-center mb-4">
                            <div class="w-full h-64 bg-gradient-to-br from-green-200 to-blue-200 rounded-lg flex items-center justify-center">
                                <div class="text-center">
                                    <div class="w-16 h-16 bg-white rounded-full flex items-center justify-center mx-auto mb-3 shadow-md">
                                        <span class="text-2xl">üó∫Ô∏è</span>
                                    </div>
                                    <p class="text-lg font-semibold text-gray-700">${villageId.charAt(0).toUpperCase() + villageId.slice(1)} Village</p>
                                    <p class="text-sm text-gray-600">Interactive map view</p>
                                </div>
                            </div>
                        </div>

                        <div class="grid grid-cols-2 gap-4 mb-4">
                            <div class="bg-blue-50 p-4 rounded-lg">
                                <h3 class="font-semibold text-blue-800 mb-2">üìç Location Details</h3>
                                <div class="space-y-1 text-sm">
                                    <p><span class="text-blue-700">Distance from PHC:</span> ${getVillageDistance(villageId)}</p>
                                    <p><span class="text-blue-700">Road Condition:</span> ${getVillageRoadCondition(villageId)}</p>
                                    <p><span class="text-blue-700">Transport:</span> ${getVillageTransport(villageId)}</p>
                                </div>
                            </div>
                            <div class="bg-green-50 p-4 rounded-lg">
                                <h3 class="font-semibold text-green-800 mb-2">üè† Village Info</h3>
                                <div class="space-y-1 text-sm">
                                    <p><span class="text-green-700">Total Households:</span> ${getVillageHouseholds(villageId)}</p>
                                    <p><span class="text-green-700">Population:</span> ${getVillagePopulation(villageId)}</p>
                                    <p><span class="text-green-700">ASHA Coverage:</span> ${getVillageASHACoverage(villageId)}</p>
                                </div>
                            </div>
                        </div>

                        <div class="flex justify-end space-x-3">
                            <button data-close-modal class="px-4 py-2 bg-gray-600 text-white rounded-lg hover:bg-gray-700">Close</button>
                            <button id="getDirectionsBtn" class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700">Get Directions</button>
                        </div>
                    </div>
                `;

                backdrop.appendChild(card);
                document.body.appendChild(backdrop);

                // prevent background scrolling while modal is open
                document.body.style.overflow = 'hidden';

                // ensure backdrop is visible even if CSS expects .active to show
                backdrop.classList.add('active');

                // trigger the entrance animation (adds .show which animates the card)
                requestAnimationFrame(() => backdrop.classList.add('show'));

                // attach close handlers
                function removeBackdrop() {
                    // play hide animation first
                    backdrop.classList.remove('show');
                    // after transition ends remove element and restore scroll
                    setTimeout(() => {
                        if (backdrop && backdrop.parentNode) backdrop.parentNode.removeChild(backdrop);
                        document.body.style.overflow = 'auto';
                    }, 280);
                }

                backdrop.addEventListener('click', function(e) {
                    if (e.target === backdrop) removeBackdrop();
                });
                // close buttons inside the card
                backdrop.querySelectorAll('[data-close-modal]').forEach(btn => btn.addEventListener('click', removeBackdrop));
                // wire Get Directions button
                const getDirBtn = backdrop.querySelector('#getDirectionsBtn');
                if (getDirBtn) getDirBtn.addEventListener('click', function() { removeBackdrop(); getDirections(villageId); });

                showNotification('Village map loaded successfully!', 'success');
            }, 1000);
        }

        function generateVillageReport(villageId) {
            const button = event.target;
            const originalText = button.textContent;
            
            button.textContent = 'Generating...';
            button.disabled = true;
            
            showNotification(`Generating report for ${villageId} village...`, 'success');
            
            setTimeout(() => {
                const reportData = generateVillageReportData(villageId);
                const blob = new Blob([reportData], { type: 'text/plain' });
                const url = URL.createObjectURL(blob);
                
                const a = document.createElement('a');
                a.href = url;
                a.download = `${villageId}_Village_Report_${new Date().toISOString().split('T')[0]}.txt`;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
                
                button.textContent = originalText;
                button.disabled = false;
                
                showNotification(`${villageId} village report downloaded!`, 'success');
            }, 2000);
        }

        function bulkVillageAction() {
            const modal = document.createElement('div');
            modal.className = 'modal active';
            modal.innerHTML = `
                <div class="bg-white rounded-xl p-6 max-w-2xl m-4">
                    <div class="flex items-center justify-between mb-4">
                        <h2 class="text-xl font-bold">Bulk Village Actions</h2>
                        <button onclick="this.closest('.modal').remove()" class="p-2 hover:bg-gray-100 rounded-lg">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"/>
                            </svg>
                        </button>
                    </div>
                    
                    <div class="space-y-4">
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Select Villages</label>
                            <div class="space-y-2">
                                <label class="flex items-center">
                                    <input type="checkbox" value="rampur" class="mr-2"> Rampur Village
                                </label>
                                <label class="flex items-center">
                                    <input type="checkbox" value="krishnapur" class="mr-2"> Krishnapur Village
                                </label>
                                <label class="flex items-center">
                                    <input type="checkbox" value="govindpur" class="mr-2"> Govindpur Village
                                </label>
                            </div>
                        </div>
                        
                        <div>
                            <label class="block text-sm font-medium text-gray-700 mb-2">Action</label>
                            <select id="bulkAction" class="w-full px-3 py-2 border border-gray-300 rounded-lg">
                                <option value="">Select Action</option>
                                <option value="sync">Force Sync All Data</option>
                                <option value="alert">Send Priority Alert</option>
                                <option value="report">Generate Combined Report</option>
                                <option value="contact">Contact All ASHA Workers</option>
                            </select>
                        </div>
                        
                        <div class="flex justify-end space-x-3">
                            <button onclick="this.closest('.modal').remove()" class="px-4 py-2 bg-gray-600 text-white rounded-lg hover:bg-gray-700">Cancel</button>
                            <button onclick="executeBulkAction()" class="px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700">Execute Action</button>
                        </div>
                    </div>
                </div>
            `;
            
            document.body.appendChild(modal);
        }

        function executeBulkAction() {
            const selectedVillages = Array.from(document.querySelectorAll('input[type="checkbox"]:checked')).map(cb => cb.value);
            const action = document.getElementById('bulkAction').value;
            
            if (selectedVillages.length === 0 || !action) {
                showNotification('Please select villages and action', 'error');
                return;
            }
            
            const modal = event.target.closest('.modal');
            modal.remove();
            
            showNotification(`Executing ${action} for ${selectedVillages.length} villages...`, 'success');
            
            setTimeout(() => {
                showNotification(`Bulk action completed successfully for ${selectedVillages.join(', ')}!`, 'success');
            }, 3000);
        }

        function exportVillageData() {
            const button = event.target.closest('button');
            const icon = button.querySelector('svg');
            
            icon.classList.add('animate-pulse');
            showNotification('Preparing village data export...', 'success');
            
            setTimeout(() => {
                const exportData = generateVillageExportData();
                const blob = new Blob([exportData], { type: 'text/csv' });
                const url = URL.createObjectURL(blob);
                
                const a = document.createElement('a');
                a.href = url;
                a.download = `Village_Data_Export_${new Date().toISOString().split('T')[0]}.csv`;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
                
                icon.classList.remove('animate-pulse');
                showNotification('Village data exported successfully!', 'success');
            }, 2000);
        }

        // Helper functions for village data
        function getVillageDistance(villageId) {
            const distances = { 'rampur': '3.2 km', 'krishnapur': '5.8 km', 'govindpur': '8.1 km' };
            return distances[villageId] || '5.0 km';
        }

        function getVillageRoadCondition(villageId) {
            const conditions = { 'rampur': 'Good', 'krishnapur': 'Fair', 'govindpur': 'Poor' };
            return conditions[villageId] || 'Fair';
        }

        function getVillageTransport(villageId) {
            const transport = { 'rampur': 'Bus + Auto', 'krishnapur': 'Auto only', 'govindpur': 'Walking + Bike' };
            return transport[villageId] || 'Auto';
        }

        function getVillageHouseholds(villageId) {
            const households = { 'rampur': '287', 'krishnapur': '198', 'govindpur': '312' };
            return households[villageId] || '250';
        }

        function getVillagePopulation(villageId) {
            const populations = { 'rampur': '1,247', 'krishnapur': '892', 'govindpur': '1,156' };
            return populations[villageId] || '1,000';
        }

        function getVillageASHACoverage(villageId) {
            const coverage = { 'rampur': '100%', 'krishnapur': '95%', 'govindpur': '85%' };
            return coverage[villageId] || '90%';
        }

        function generateVillageReportData(villageId) {
            return `VILLAGE HEALTH REPORT - ${villageId.toUpperCase()}
Generated: ${new Date().toLocaleString()}

BASIC INFORMATION
================
Village: ${villageId.charAt(0).toUpperCase() + villageId.slice(1)}
Population: ${getVillagePopulation(villageId)}
Households: ${getVillageHouseholds(villageId)}
Distance from PHC: ${getVillageDistance(villageId)}

HEALTH INDICATORS
================
Immunization Coverage: ${Math.floor(Math.random() * 30) + 70}%
ANC Coverage: ${Math.floor(Math.random() * 25) + 75}%
Institutional Deliveries: ${Math.floor(Math.random() * 20) + 80}%
Malnutrition Rate: ${Math.floor(Math.random() * 10) + 8}%

ASHA WORKER PERFORMANCE
======================
ASHA: ${getASHAName(villageId)}
Task Completion: ${Math.floor(Math.random() * 20) + 80}%
Last Sync: ${getLastSyncTime(villageId)}
Pending Tasks: ${Math.floor(Math.random() * 10) + 3}

RECOMMENDATIONS
==============
- Continue monitoring high-risk cases
- Improve immunization coverage
- Enhance ASHA support and training
- Regular follow-up visits needed

Report generated by PHC Village Monitoring System
`;
        }

        function generateVillageExportData() {
            return `Village,ASHA Worker,Population,Immunization Coverage,ANC Coverage,Pending Tasks,Status,Last Sync
Rampur,Sunita Devi,1247,92%,88%,3,Active,15 min ago
Krishnapur,Priya Sharma,892,76%,82%,8,Needs Attention,2 hours ago
Govindpur,Meera Devi,1156,68%,71%,12,Critical,1 day ago`;
        }

        function getASHAName(villageId) {
            const names = { 'rampur': 'Sunita Devi', 'krishnapur': 'Priya Sharma', 'govindpur': 'Meera Devi' };
            return names[villageId] || 'ASHA Worker';
        }

        function getLastSyncTime(villageId) {
            const times = { 'rampur': '15 min ago', 'krishnapur': '2 hours ago', 'govindpur': '1 day ago' };
            return times[villageId] || '1 hour ago';
        }

        function getDirections(villageId) {
            showNotification(`Getting directions to ${villageId} village...`, 'success');
            setTimeout(() => {
                showNotification('Directions loaded! Estimated travel time: 25 minutes', 'success');
            }, 1500);
        }

        // Initialize app with enhanced features
        document.addEventListener('DOMContentLoaded', function() {
            // Check for offline data on startup
            const offlineData = JSON.parse(localStorage.getItem('offlineHealthData') || '[]');
            const unsyncedCount = offlineData.filter(item => !item.synced).length;
            
            if (unsyncedCount > 0) {
                showNotification(`${unsyncedCount} records pending sync`, 'warning');
            }
            
            // Set up periodic connectivity check
            setInterval(() => {
                // Simulate connectivity check
                const wasOnline = isOnline;
                // In a real app, this would check actual connectivity
                
                if (wasOnline !== isOnline) {
                    updateConnectivityStatus();
                    if (isOnline) {
                        showNotification('Connection restored', 'success');
                        syncOfflineData();
                    } else {
                        showNotification('Working offline', 'warning');
                    }
                }
            }, 30000); // Check every 30 seconds
            
            // Set up real-time village monitoring updates
            if (currentPage === 'phc-villages') {
                setInterval(() => {
                    if (currentPage === 'phc-villages' && isOnline) {
                        updateVillageMetrics();
                    }
                }, 60000); // Update every minute
            }
        });
    </script>
</body>
</html>